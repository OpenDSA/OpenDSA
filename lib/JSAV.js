(function($){"use strict";var JSAV=function(){create.apply(this,arguments)};JSAV.position=function(elem){var $el=$(elem),offset=$el.position(),translate=null;if(translate){return{left:offset.left+translate[0],top:offset.top+translate[1]}}else{return offset}};var jsavproto=JSAV.prototype;jsavproto.getSvg=function(){if(!this.svg){this.svg=Raphael(this.canvas[0]);var style=this.svg.canvas.style;style.position="absolute"}return this.svg};jsavproto.id=function(){var id=this.container[0].id;if(!id){id=JSAV.utils.createUUID();this.container[0].id=id}return id};jsavproto.clear=function(){this.container.html(this._initialHTML);this.canvas=this.container.find(".jsavcanvas")};JSAV._types={};JSAV.ext={};JSAV.init=function(f){JSAV.init.functions.push(f)};JSAV.init.functions=[];var create=function(){if(typeof arguments[0]==="string"){this.container=$(document.getElementById(arguments[0]))}else if(arguments[0]instanceof HTMLElement){this.container=$(arguments[0])}else if(arguments[0]&&typeof arguments[0]==="object"&&arguments[0].constructor===jQuery){this.container=arguments[0]}var defaultOptions=$.extend({autoresize:true,scroll:true},window.JSAV_OPTIONS);if(this.container){this.options=$.extend(true,defaultOptions,arguments[1])}else{this.options=$.extend(true,defaultOptions,arguments[0]);this.container=$(this.options.element)}var initialHTML=this.container.clone().wrap("<p/>").parent().html();this._initialHTML=this.container.html();this.container.addClass("jsavcontainer");this.canvas=this.container.find(".jsavcanvas");if(this.canvas.size()===0){this.canvas=$("<div />").addClass("jsavcanvas").appendTo(this.container)}var shutter=$("<div class='jsavshutter' />").appendTo(this.container);this._shutter=shutter;this.RECORD=true;jQuery.fx.off=true;initializations(this,this.options);extensions(this,this,JSAV.ext);this.logEvent({type:"jsav-init",initialHTML:initialHTML})};function initializations(jsav,options){var fs=JSAV.init.functions;for(var i=0;i<fs.length;i++){if($.isFunction(fs[i])){fs[i].call(jsav,options)}}}function extensions(jsav,con,add){for(var prop in add){if(add.hasOwnProperty(prop)&&!(prop in con)){switch(typeof add[prop]){case"function":(function(f){con[prop]=con===jsav?f:function(){return f.apply(jsav,arguments)}})(add[prop]);break;case"object":con[prop]=con[prop]||{};extensions(jsav,con[prop],add[prop]);break;default:con[prop]=add[prop];break}}}}JSAV.init(function(){if(this.options.autoresize){var that=this;this.container.on("jsav-updaterelative",function(){var maxTop=parseInt(that.canvas.css("minHeight"),10),maxLeft=parseInt(that.canvas.css("minWidth"),10);that.canvas.children().each(function(index,item){var $item=$(item),itemPos=$item.position();if(item.nodeName.toLowerCase()!=="svg"){maxTop=Math.max(maxTop,itemPos.top+$item.outerHeight(true));maxLeft=Math.max(maxLeft,itemPos.left+$item.outerWidth(true))}});if(that.svg){var curr=that.svg.bottom,bbox,strokeWidth;while(curr){bbox=curr.getBBox();strokeWidth=curr.attr("stroke-width");maxTop=Math.max(maxTop,bbox.y2+strokeWidth);maxLeft=Math.max(maxLeft,bbox.x2+strokeWidth);curr=curr.next}}if(that.options.scroll){var parentWidth=that.canvas.parent().width();maxLeft=Math.min(maxLeft,parentWidth)}that.canvas.css({minHeight:maxTop,minWidth:maxLeft})})}});if(window){window.JSAV=JSAV;window.JSAV_OPTIONS={narration:{enabled:false,replacements:[{searchValue:/<[^>]*>/g,replaceValue:""},{searchValue:/\$/g,replaceValue:""},{searchValue:/\\mathbf/gi,replaceValue:""},{searchValue:/\\displaystyle/gi,replaceValue:""},{searchValue:/\\mbox/gi,replaceValue:""},{searchValue:/n-/gi,replaceValue:"n minus"},{searchValue:/m-/gi,replaceValue:"m minus"},{searchValue:/%/gi,replaceValue:"remainder"}],langMap:{en:"en-US",fr:"fr-FR"}}}}})(jQuery);(function($){"use strict";if(typeof JSAV==="undefined"){return}JSAV._translations={en:{backwardButtonTitle:"Backward",forwardButtonTitle:"Forward",beginButtonTitle:"Begin",endButtonTitle:"End",resetButtonTitle:"Reset",undoButtonTitle:"Undo",modelButtonTitle:"Model Answer",gradeButtonTitle:"Grade",modelWindowTitle:"Model Answer",feedbackLabel:"Grading Mode: ",continuous:"Continuous",atend:"At end",fixLabel:"Continuous feedback behaviour",undo:"Undo incorrect step",fix:"Fix incorrect step",scoreLabel:"Score:",remainingLabel:"Points remaining:",lostLabel:"Points lost:",doneLabel:"DONE",yourScore:"Your score:",fixedSteps:"Fixed incorrect steps:",fixedPopup:"Your last step was incorrect. Your work has been replaced with the correct step so that you can continue.",fixFailedPopup:"Your last step was incorrect and I should fix your solution, but don't know how. So it was undone and you can try again.",undonePopup:"Your last step was incorrect. Things are reset to the beginning of the step so that you can try again.",settings:"Settings",animationSpeed:"Animation speed","(slowFast)":"(slow - fast)",valueBetween1And10:"Value between 1 (Slow) and 10 (Fast).",save:"Save",saved:"Saved...",questionClose:"Close",questionCheck:"Check Answer",questionCorrect:"Correct!",questionIncorrect:"Incorrect"},fi:{backwardButtonTitle:"Askel taaksepäin",forwardButtonTitle:"Askel eteenpäin",beginButtonTitle:"Kelaa alkuun",endButtonTitle:"Kelaa loppuun",resetButtonTitle:"Uudelleen",undoButtonTitle:"Kumoa",modelButtonTitle:"Mallivastaus",gradeButtonTitle:"Arvostele",modelWindowTitle:"Mallivastaus",feedbackLabel:"Arvostelumuoto: ",continuous:"Jatkuva",atend:"Lopussa",fixLabel:"Jatkuvan arvostelun asetukset",undo:"Kumoa väärin menneet askeleet",fix:"Korjaa väärin menneet askeleet",scoreLabel:"Pisteet:",remainingLabel:"Pisteitä jäljellä:",lostLabel:"Menetetyt pisteet:",doneLabel:"VALMIS",yourScore:"Sinun pisteesi:",fixedSteps:"Korjatut askeleet:",fixedPopup:"Viime askeleesi meni väärin. Se on korjattu puolestasi, niin että voit jatkaa tehtävää.",fixFailedPopup:"Viime askeleesi meni väärin ja minun tulisi korjata se. En kuitenkaan osaa korjata sitä, joten olen vain kumonnut sen.",undonePopup:"Viime askeleesi meni väärin. Askel on kumottu, niin että voit yrittää uudelleen.",settings:"Asetukset",animationSpeed:"Animointinopeus","(slowFast)":"(hidas - nopea)",valueBetween1And10:"Anna arvo 1:n (hidas) ja 10:n (nopea) välillä.",save:"Tallenna",saved:"Tallennettu...",questionClose:"Sulje",questionCheck:"Tarkista vastaus",questionCorrect:"Oikein!",questionIncorrect:"Väärin"},sv:{resetButtonTitle:"Börja om",undoButtonTitle:"Ångra",modelButtonTitle:"Visa lösning",gradeButtonTitle:"Poängsätt",modelWindowTitle:"Lösning",feedbackLabel:"Rättningsalternativ: ",continuous:"Rätta kontinuerligt",atend:"Poängsätt i slutet",fixLabel:"Alternativ för kontinuerlig rättning",undo:"Ångra felaktigt steg",fix:"Åtgärda felaktigt steg",scoreLabel:"Poäng:",remainingLabel:"Kvarvarande poäng:",lostLabel:"Förlorade poäng:",doneLabel:"FÄRDIG!",yourScore:"Din poäng:",fixedSteps:"Åtgärdade felaktiga steg:",fixedPopup:"Ditt senaste steg var felaktigt. Det har ersatts med det korrekta steget så att du kan fortsätta.",fixFailedPopup:"Ditt senaste steg var felaktigt men jag vet inte hur det bör åtgärdas. Därför har ditt steg ångrats och du kan försöka igen.",undonePopup:"Ditt senaste steg var felaktigt. Steget har ångrats så att du kan försöka igen.",settings:"Inställningar",animationSpeed:"Animationshastighet","(slowFast)":"(långsamt - snabbt)",valueBetween1And10:"Värde mellan 1 (långsamt) och 10 (snabbt).",save:"Spara",saved:"Sparat..."},fr:{resetButtonTitle:"Reinitialiser",undoButtonTitle:"Annuler",modelButtonTitle:"Solution",gradeButtonTitle:"Score",modelWindowTitle:"Solution",feedbackLabel:"Type de controle: ",continuous:"Continue",atend:"A la fin",fixLabel:"Parametres de controle continue",undo:"Annuler les étapes incorrectes",fix:"Corriger les étapes incorrectes",scoreLabel:"Score:",remainingLabel:"Points restants:",lostLabel:"Points perdus:",doneLabel:"Activite terminée",yourScore:"Votre score:",fixedSteps:"Corriger les étapes incorrectes:",fixedPopup:"Votre dernière action etait incorrecte. Votre action a été corrigée pour vous permettre de poursuivre.",fixFailedPopup:"Votre dernière action etait incorrecte et je ne sais pas comment la corriger. Votre action a ete annulée, essayez a nouveau.",undonePopup:"Votre dernière action etait incorrecte. La simulation a été reinitialisée. Essayez a nouveau.",settings:"Paramètres",animationSpeed:"Vitesse","(slowFast)":"(lent - rapide)",valueBetween1And10:"Vitesse entre 1 (Lent) et 10 (Rapide).",save:"Sauvegarder",saved:"Sauvegarde complète..."}};JSAV.init(function(options){var language=options.lang||"en";if(typeof JSAV._translations[language]==="object"){this._translate=JSAV.utils.getInterpreter(JSAV._translations,language)}else{this._translate=JSAV.utils.getInterpreter(JSAV._translations,"en")}})})(jQuery);(function($){"use strict";var DEFAULT_SPEED=300,playingCl="jsavplaying";if(typeof JSAV==="undefined"){return}var AnimatableOperation=function(opts){this.obj=opts.obj;this.effect=opts.effect;this.args=opts.args;if(opts.undo){this.undoeffect=opts.undo}if(opts.undoargs){this.undoArgs=opts.undoargs}};AnimatableOperation.prototype.apply=function(){var self=this;var obj=self.obj,state=obj.state?obj.state():null;var retVal=this.effect.apply(this.obj,this.args);if(typeof retVal==="undefined"||retVal===this.obj){if(typeof this.undoeffect==="undefined"||!$.isFunction(this.undoeffect)){this.undoeffect=function(){return function(){obj.state(state)}}()}}else{this.undoArgs=retVal}};AnimatableOperation.prototype.undo=function(){if(typeof this.undoArgs==="undefined"){this.undoeffect.apply(this.obj,this.args)}else{this.effect.apply(this.obj,this.undoArgs)}};var AnimStep=function(options){this.operations=[];this.options=options||{}};AnimStep.prototype.add=function(oper){this.operations.push(oper)};AnimStep.prototype.isEmpty=function(){return this.operations.length===0};function backward(filter){if(this._undo.length===0){return}var step=this._undo.pop();var ops=step.operations;for(var i=ops.length-1;i>=0;i--){var prev=ops[i];prev.undo()}this._redo.unshift(step);if(filter&&$.isFunction(filter)&&!filter(step)){this.backward(filter)}this.container.trigger("jsav-updatecounter",[this.currentStep()+1,this.totalSteps()+1]);return step}function forward(){if(this._redo.length===0){return}var step=this._redo.shift();var ops=step.operations;for(var i=0;i<ops.length;i++){var next=ops[i];next.apply()}this._undo.push(step);this.container.trigger("jsav-updatecounter",[this.currentStep()+1,this.totalSteps()+1]);return step}function begin(){var oldFx=$.fx.off||false;$.fx.off=true;while(this._undo.length){this.backward()}$.fx.off=oldFx;return this}function end(){var oldFx=$.fx.off||false;$.fx.off=true;while(this._redo.length){this.forward()}$.fx.off=oldFx;return this}JSAV.init(function(){this._animations=0;this._redo=[];this._undo=[];var that=this,$controls=$(".jsavcontrols",this.container);function logAnimEvent(action){var eventData={type:action,currentStep:that.currentStep(),totalSteps:that.totalSteps()};that.logEvent(eventData)}function clearPlayingTimeout(jsav,callback){var timerid;var timeouter=function(){if(!jsav.isAnimating()){jsav.container.removeClass(playingCl);jsav._animations=0;if($.isFunction(callback)){callback()}clearInterval(timerid)}};timerid=setInterval(timeouter,50)}this._clearPlaying=function clearPlaying(callback){if(this.isAnimating()){clearPlayingTimeout(this,callback)}else{this.container.removeClass(playingCl);if($.isFunction(callback)){callback()}}};var beginHandler=function(e){MathJax.Hub.Queue(["Typeset",MathJax.Hub]);e.preventDefault();e.stopPropagation();if(that.container.hasClass(playingCl)){return}that.container.addClass(playingCl);that.begin();that._clearPlaying();logAnimEvent("jsav-begin")};var backwardHandler=function(e,filter){MathJax.Hub.Queue(["Typeset",MathJax.Hub]);e.preventDefault();e.stopPropagation();e.stopPropagation();if(that.container.hasClass(playingCl)){return}that.container.addClass(playingCl);that.backward(filter);that._clearPlaying();logAnimEvent("jsav-backward")};var forwardHandler=function(e,filter){MathJax.Hub.Queue(["Typeset",MathJax.Hub]);e.preventDefault();e.stopPropagation();if(that.container.hasClass(playingCl)){return}that.container.addClass(playingCl);that.forward(filter);that._clearPlaying();logAnimEvent("jsav-forward")};var endHandler=function(e){MathJax.Hub.Queue(["Typeset",MathJax.Hub]);e.preventDefault();e.stopPropagation();if(that.container.hasClass(playingCl)){return}that.container.addClass(playingCl);that.end();that._clearPlaying();logAnimEvent("jsav-end")};if($controls.size()!==0){var tmpTranslation=this._translate("beginButtonTitle");$("<span class='jsavbegin' title='"+tmpTranslation+"'>&lt;&lt;</span>").click(beginHandler).appendTo($controls);tmpTranslation=this._translate("backwardButtonTitle");$("<span class='jsavbackward' title='"+tmpTranslation+"'>&lt;</span>").click(backwardHandler).appendTo($controls);tmpTranslation=this._translate("forwardButtonTitle");$("<span class='jsavforward' title='"+tmpTranslation+"'>&gt;</span>").click(forwardHandler).appendTo($controls);tmpTranslation=this._translate("endButtonTitle");$("<span class='jsavend' title='"+tmpTranslation+"'>&gt;&gt;</span>").click(endHandler).appendTo($controls);this._controlsContainer=$controls}this.container.bind({"jsav-forward":forwardHandler,"jsav-backward":backwardHandler,"jsav-begin":beginHandler,"jsav-end":endHandler});var counter=$(".jsavcounter",this.container);if(counter.size()>0){counter.text("0 / 0");this.container.bind("jsav-updatecounter",function(evet,current,total){counter.text(current+" / "+total)})}$(document).bind("jsav-speed-change",function(e,args){that.SPEED=args})});function anim(effect,undo){return function(){var jsav=this;var args=$.makeArray(arguments),norecord=false;if(args.length>0&&args[args.length-1]&&typeof args[args.length-1]==="object"&&args[args.length-1].record===false){norecord=true}if(!jsav.hasOwnProperty("_redo")){jsav=this.jsav}if(jsav.options.animationMode==="none"||norecord){effect.apply(this,arguments)}else{var stackTop=jsav._undo[jsav._undo.length-1];if(!stackTop){stackTop=new AnimStep;jsav._undo.push(stackTop)}var oper=new AnimatableOperation({obj:this,effect:effect,args:arguments,undo:undo});stackTop.add(oper);if(jsav._shouldAnimate()){jsav.container.addClass(playingCl)}oper.apply();if(jsav._shouldAnimate()){jsav._clearPlaying()}}return this}}function moveWrapper(func,filter){var origStep=this.currentStep(),step=func.call(this);if(!step){return false}if(filter){if($.isFunction(filter)){var filterMatch=filter(step),matched=filterMatch;while(!filterMatch&&this.currentStep()<this.totalSteps()){step=func.call(this);if(!step){break}filterMatch=filter(step);matched=matched||filterMatch}if(!matched){this.jumpToStep(origStep);return false}}}return true}JSAV.anim=anim;if(typeof localStorage!=="undefined"&&localStorage){var spd=localStorage.getItem("jsav-speed");if(spd){spd=parseInt(spd,10);if(isNaN(spd)){spd=DEFAULT_SPEED}}else{spd=DEFAULT_SPEED}JSAV.ext.SPEED=spd}else{JSAV.ext.SPEED=DEFAULT_SPEED}JSAV.ext.begin=begin;JSAV.ext.end=end;JSAV.ext.forward=function(filter){return moveWrapper.call(this,forward,filter)};JSAV.ext.backward=function(filter){return moveWrapper.call(this,backward,filter)};JSAV.ext.currentStep=function(){return this._undo.length};JSAV.ext.totalSteps=function(){return this._undo.length+this._redo.length};JSAV.ext.animInfo=function(){var info={steps:this.totalSteps()},i,effects=0;for(i=this._undo.length;i--;){effects+=this._undo[i].operations.length}for(i=this._redo.length;i--;){effects+=this._redo[i].operations.length}info.effects=effects;return info};JSAV.ext.step=function(options){var updateRelative=options&&options.updateRelative===false?false:true;if(updateRelative){this.container.trigger("jsav-updaterelative")}if(this.options.animationMode!=="none"){this._undo.push(new AnimStep(options));if(options&&this.message&&options.message){this.message(options.message)}}return this};JSAV.ext.clearAnimation=function(options){var opts=$.extend({undo:true,redo:true},options);if(opts.undo){this._undo=[]}if(opts.redo){this._redo=[]}};JSAV.ext.displayInit=function(){this.container.trigger("jsav-updaterelative");this.clearAnimation({redo:false});return this};JSAV.ext.jumpToStep=function(step){var stepCount=this.totalSteps(),jsav=this,stepFunction=function(stp){return jsav.currentStep()===step};var oldFx=$.fx.off||false;$.fx.off=true;if(step>=stepCount){this.end()}else if(step<0){this.begin()}else if(step<this.currentStep()){this.backward(stepFunction)}else{this.forward(stepFunction)}$.fx.off=oldFx;return this};JSAV.ext.stepOption=function(name,value){var step=this._undo[this._undo.length-1];if(value!==undefined){if(step){step.options[name]=value}}else if(typeof name==="string"){if(step){return step.options[name]}else{return undefined}}else{for(var item in name){if(name.hasOwnProperty(item)){this.stepOption(item,name[item])}}}};JSAV.ext.recorded=function(){if(this._undo.length>1&&this._undo[this._undo.length-1].isEmpty()){this._undo.pop()}else{this.container.trigger("jsav-updaterelative")}this.begin();this.RECORD=false;$.fx.off=false;this.logEvent({type:"jsav-recorded"});return this};JSAV.ext.isAnimating=function(){return!!this.container.find(":animated").size()||this._animations>0};JSAV.ext._shouldAnimate=function(){return!this.RECORD&&!$.fx.off&&this.SPEED>50};JSAV.ext.disableControls=function(){if(this._controlsContainer){this._controlsContainer.addClass("jsavdisabled")}};JSAV.ext.enableControls=function(){if(this._controlsContainer){this._controlsContainer.removeClass("jsavdisabled")}}})(jQuery);jQuery.cssHooks.borderColor={get:function(elem){return jQuery(elem).css("border-top-color")}};jQuery.cssHooks.borderWidth={get:function(elem){return jQuery(elem).css("border-top-width")}};(function($){"use strict";if(typeof JSAV==="undefined"){return}var inp=$("<input type='range' />");$.support.inputTypeRange=inp.prop("type")==="range";var ObjCommons=function(){},objproto=ObjCommons.prototype;objproto.id=function(newId){if(newId){this.element[0].id=newId;return this}else{var id=this.element[0].id;if(!id){id=JSAV.utils.createUUID();this.element[0].id=id}return id}};objproto.bounds=function(recalculate,options){if(recalculate&&$.isFunction(this.layout)){return this.layout($.extend({boundsOnly:true},options))}else{var pos=this.position();return $.extend({width:this.element.width(),height:this.element.height()},pos)}};objproto.position=function(){return JSAV.position(this.element)};objproto.isVisible=function(){return this.element.filter(":visible").size()>0};objproto.clear=function(){if(this.element){this.element.remove()}};objproto._animateTranslate=JSAV.anim(function(dx,dy,options){var leftie=this.element.css("left")==="auto"?dx:"+="+dx,toppie=this.element.css("top")==="auto"?dy:"+="+dy;this.element.css({left:leftie+"px",top:toppie+"px"});if(this.jsav._shouldAnimate()){this.element.css({x:-dx,y:-dy,z:1});this.jsav.effects.transition(this.element,{x:0,y:0,z:1},options)}return[-dx,-dy,options]});objproto.translate=function(dx,dy,options){var val=this._animateTranslate(dx,dy,options);if(this._moveListeners){this.element.trigger("jsav-object-move",[dx,dy])}return val};objproto.translateX=function(dx,options){return this.translate(dx,0,options)};objproto.translateY=function(dy,options){return this.translate(0,dy,options)};objproto.moveTo=function(newLeft,newTop,options){var curPos=this.element.position(),dx=newLeft-curPos.left,dy=newTop-curPos.top;var val=this._animateTranslate(dx,dy,options);if(this._moveListeners){this.element.trigger("jsav-object-move",[dx,dy])}};objproto._registerMoveListener=function(callback){if(!$.isFunction(callback)){return}this._moveListeners=(this._moveListeners||0)+1;this.element.on("jsav-object-move",callback);if(this.container){this.container._registerMoveListener(callback)}};objproto._unregisterMoveListener=function(callback){this.element.off("jsav-object-move",callback);this._moveListeners--;if(this.container){this.container._unregisterMoveListener(callback)}};JSAV._types.JSAVObject=ObjCommons;JSAV.utils={};var u=JSAV.utils;u.getQueryParameter=function(name){var params=window.location.search,vars={},i,pair;if(params){params=params.slice(1).split("&");for(i=params.length;i--;){pair=params[i].split("=");vars[pair[0]]=decodeURIComponent(pair[1]);if(name&&pair[0]===name){return pair[1]}}}if(name){return}return vars};u.createUUID=function(){var s=[],i=0;for(;i<32;i++){s[i]=(~~(Math.random()*16)).toString(16)}s[12]=4;s[16]=(s[16]&3|8).toString(16);return"jsav-"+s.join("")};u.iterable=function(array){var i=0,array_clone=array.slice(0);array_clone.next=function(){return this[i++]};array_clone.hasNext=function(){return i<this.length};array_clone.reset=function(){i=0};return array_clone};u.isGraphicalPrimitive=function(jsavobj){if(!jsavobj){return false}return!!jsavobj.rObj};JSAV.ext.logEvent=function(eventData){if(typeof eventData==="object"){if(!eventData.hasOwnProperty("tstamp")){eventData.tstamp=(new Date).toISOString()}if(!eventData.hasOwnProperty("av")){eventData.av=this.id()}eventData.currentStep=this.currentStep()}if($.isFunction(this.options.logEvent)){this.options.logEvent(eventData)}else{$("body").trigger("jsav-log-event",[eventData])}};var dialogBase='<div class="jsavdialog"></div>',$modalElem=null;var centerDialog=function($dialog){var $doc=$(document),$win=$(window),winHeight=$win.height(),winWidth=$win.width(),scrollLeft=$doc.scrollLeft(),scrollTop=$doc.scrollTop();$dialog.css({top:Math.max(scrollTop+(winHeight-$dialog.outerHeight())/2,0),left:scrollLeft+(winWidth-$dialog.outerWidth())/2})};u.dialog=function(html,options){options=$.extend({},{modal:true,closeOnClick:true},options);var modal=options.modal,$dialog=$(options.dialogBase||dialogBase),i,l,attr,attrOptions=["width","height","minWidth","minHeight","maxWidth","maxHeight"];if(typeof html==="string"){$dialog.html(html)}else if($.isFunction(html)){$dialog.html(html())}else{$dialog.append(html)}if("title"in options){$dialog.prepend("<h2>"+options.title+"<a href='#' class='jsavdialogclose'>&times;</a></h2>")}if("dialogClass"in options){$dialog.addClass(options.dialogClass)}for(i=0,l=attrOptions.length;i<l;i++){attr=attrOptions[i];if(options[attr]!==undefined){$dialog.css(attr,options[attr])}}var winWidth=$(window).width();if(!("width"in options)){$dialog.css("width",Math.max(500,winWidth*.7))}var close=function(e){if(e){e.preventDefault()}if($modalElem){$modalElem.detach()}$dialog.remove();if($.isFunction(options.closeCallback)){options.closeCallback()}};if(modal){$modalElem=$modalElem||$('<div class="jsavmodal" />');$modalElem.appendTo($("body"));if(options.closeOnClick){$modalElem.click(close)}}$dialog.find(".jsavdialogclose").click(close);if("closeText"in options){var closeButton=$('<button type="button" class="jsavrow">'+options.closeText+"</button>").click(close);$dialog.append(closeButton)}var $dial=$dialog.appendTo(options.dialogRootElement||$("body"));$dial.draggable();var position=options.positionCallback||centerDialog;position($dialog);$dial.show=function(){position($dialog);$dial.fadeIn()};$dial.close=close;return $dial};u.value2type=function(val,valtype){if(valtype==="number"){return Number(val)}else if(valtype==="boolean"){if(typeof val==="boolean"){return val}else if(typeof val==="string"){return val==="true"}return!!val}else{return val}};var dummyTestFunction=function(dataArr){return true};u.rand={random:Math.random,numKey:function(min,max){return Math.floor(this.random()*(max-min)+min)},numKeys:function(min,max,num,options){var opts=$.extend(true,{sorted:false,test:dummyTestFunction,tries:10},options);var keys,tries=opts.tries,size=num;do{keys=[];for(size=num;size--;){keys.push(this.numKey(min,max))}}while(tries--&&!opts.test(keys));if(opts.sorted){keys.sort(opts.sortfunc||function(a,b){return a-b})}return keys},sample:function(collection,num,options){var opts=$.extend(true,{test:dummyTestFunction,tries:10},options);var min=0,max=collection.length,result=[],dupl,tmp,rnd,tries=opts.tries;if(max<num||num<0){return undefined}do{dupl=collection.slice(0);for(var i=0;i<num;i++){tmp=dupl[i];rnd=this.numKey(i,max);dupl[i]=dupl[rnd];dupl[rnd]=tmp}}while(tries--&&!opts.test(dupl));return dupl.slice(0,num)}};u.extend=function(constructor,superConstructor){function surrogateConstructor(){}surrogateConstructor.prototype=superConstructor.prototype;var prototypeObject=new surrogateConstructor;prototypeObject.constructor=constructor;constructor.prototype=prototypeObject};u.getInterpreter=function(langJSON,selectedLanguage){var trans;if(typeof langJSON==="string"){if(langJSON.indexOf("{lang}")!==-1){langJSON=langJSON.replace("{lang}",selectedLanguage);selectedLanguage=undefined}$.ajax({url:langJSON,async:false,dataType:"json",success:function(data){if(selectedLanguage){trans=data[selectedLanguage]}else{trans=data}}})}else if(typeof langJSON==="object"){if(selectedLanguage){trans=langJSON[selectedLanguage]}else{trans=langJSON}}if(typeof trans!=="object"){console.warn("Language not found ("+selectedLanguage+")");return function(label){return"["+label+"]"}}return function(label){if(typeof trans[label]==="undefined"){console.warn("Cannot find label: "+label);return"["+label+"]"}return trans[label]}};u.replaceLabels=function(string,replacementObject){if(!replacementObject||typeof replacementObject!=="object"){return string}var result=string;for(var label in replacementObject){if(replacementObject.hasOwnProperty(label)){var reg=new RegExp("{"+label+"}","g");result=result.replace(reg,replacementObject[label])}}return result};u.getUndoableFunction=function(jsav,func,undoFunc){var f=JSAV.anim(func,undoFunc);return function(){f.apply(jsav,arguments)}};(function(pool,math,width,chunks,significance,overflow,startdenom){math.seedrandom=function seedrandom(seed,use_entropy){var key=[];var arc4;seed=mixkey(flatten(use_entropy?[seed,pool]:arguments.length?seed:[(new Date).getTime(),pool,window],3),key);arc4=new ARC4(key);mixkey(arc4.S,pool);math.random=function random(){var n=arc4.g(chunks);var d=startdenom;var x=0;while(n<significance){n=(n+x)*width;d*=width;x=arc4.g(1)}while(n>=overflow){n/=2;d/=2;x>>>=1}return(n+x)/d};return seed};function ARC4(key){var t,u,me=this,keylen=key.length;var i=0,j=me.i=me.j=me.m=0;me.S=[];me.c=[];if(!keylen){key=[keylen++]}while(i<width){me.S[i]=i++}for(i=0;i<width;i++){t=me.S[i];j=lowbits(j+t+key[i%keylen]);u=me.S[j];me.S[i]=u;me.S[j]=t}me.g=function getnext(count){var s=me.S;var i=lowbits(me.i+1);var t=s[i];var j=lowbits(me.j+t);var u=s[j];s[i]=u;s[j]=t;var r=s[lowbits(t+u)];while(--count){i=lowbits(i+1);t=s[i];j=lowbits(j+t);u=s[j];s[i]=u;s[j]=t;r=r*width+s[lowbits(t+u)]}me.i=i;me.j=j;return r};me.g(width)}function flatten(obj,depth,result,prop,typ){result=[];typ=typeof obj;if(depth&&typ=="object"){for(prop in obj){if(prop.indexOf("S")<5){try{result.push(flatten(obj[prop],depth-1))}catch(e){}}}}return result.length?result:obj+(typ!="string"?"\0":"")}function mixkey(seed,key,smear,j){seed+="";smear=0;for(j=0;j<seed.length;j++){key[lowbits(j)]=lowbits((smear^=key[lowbits(j)]*19)+seed.charCodeAt(j))}seed="";for(j in key){seed+=String.fromCharCode(key[j])}return seed}function lowbits(n){return n&width-1}startdenom=Math.pow(width,chunks);significance=Math.pow(2,significance);overflow=significance*2;mixkey(math.random(),pool)})([],u.rand,256,6,52);var _helpers={};u._helpers=_helpers;var JSAV_CLASS_NAMES=["jsavarray","jsavhorizontalarray","jsavverticalarray","jsavbararray","jsavindexed","jsavnode","jsavindex","jsavcommontree","jsavtree","jsavbinarytree","jsavbinarynode","jsavtreenode","jsavlistnode","jsavlist","jsavverticallist","jsavhorizontallist","jsavmatrix","jsavgraphnode","jsavvariable","jsavedge"];_helpers.setElementClasses=function(element,cls){var elem=element[0],clsList,curCls,c,i;if(elem instanceof SVGElement&&typeof elem.classList==="object"){clsList=elem.classList;curCls=Array.prototype.slice.call(elem.classList,0);for(i=curCls.length;i--;){c=curCls[i];if(JSAV_CLASS_NAMES.indexOf(c)===-1&&cls.indexOf(c)===-1){clsList.remove(c)}}for(i=cls.length;i--;){c=cls[i];if(!clsList.contains(c)){clsList.add(c)}}}else{clsList=element.first().attr("class").split(" ");curCls=clsList.slice(0);for(i=curCls.length;i--;){c=curCls[i];if(JSAV_CLASS_NAMES.indexOf(c)===-1&&cls.indexOf(c)===-1){clsList.splice(clsList.indexOf(c),1)}}for(i=cls.length;i--;){c=cls[i];if(clsList.indexOf(c)===-1){clsList.push(c)}}element.first().attr("class",clsList.join(" "))}};_helpers.elementClasses=function(element){var elem=element[0],cls,customCls=[],i;if(elem instanceof SVGElement&&typeof elem.classList==="object"){cls=Array.prototype.slice.call(element[0].classList,0)}else{cls=element.first().attr("class").split(" ")}for(i=cls.length;i--;){if(JSAV_CLASS_NAMES.indexOf(cls[i])===-1){customCls.push(cls[i])}}return customCls};_helpers.css=function(cssprop,value,options){if(typeof cssprop==="string"&&typeof value==="undefined"){return this.element.css(cssprop)}else{return this._setcss(cssprop,value,options)}};_helpers._setcss=function(cssprop,value,options){var oldProps,el=this.element,newprops,opts=options;if(typeof cssprop==="string"&&typeof value!=="undefined"){oldProps={};oldProps[cssprop]=el.css(cssprop);newprops={};newprops[cssprop]=value;value=undefined}else{oldProps=$.extend(true,{},cssprop);for(var i in cssprop){if(cssprop.hasOwnProperty(i)){oldProps[i]=el.css(i)}}opts=value;newprops=cssprop}if(this.jsav._shouldAnimate()){this.jsav.effects.transition(this.element,newprops,opts)}else{this.element.css(newprops)}return[oldProps,value,options]};_helpers.getIndices=function($elems,indices){if(typeof indices==="undefined"){return $elems}if($.isFunction(indices)){return $elems.filter(indices)}else if($.isArray(indices)){return $elems.filter(function(index,item){for(var i=0;i<indices.length;i++){if(indices[i]===index){return true}}return false})}else if(typeof indices==="number"){return $elems.eq(indices)}else if(typeof indices==="boolean"){return indices?$elems:$({})}else{try{return $elems.eq(parseInt(indices,10))}catch(err){return $({})}}};_helpers.normalizeIndices=function($elems,indices,test){var normIndices=[],$normElems=this.getIndices($elems,indices),i,l;if(typeof test!=="undefined"){$normElems=$normElems.filter(test)}for(i=0,l=$normElems.size();i<l;i++){normIndices.push($elems.index($normElems.get(i)))}return normIndices};_helpers.cssEquals=function(jsavObj1,jsavObj2,cssProps){var cssprop,i;if($.isArray(cssProps)){for(i=0;i<cssProps.length;i++){cssprop=cssProps[i];if(jsavObj1.css(cssprop)!==jsavObj2.css(cssprop)){return false}}}else{cssprop=cssProps;if(jsavObj1.css(cssprop)!==jsavObj2.css(cssprop)){return false}}return true};_helpers.classEquals=function(jsavObj1,jsavObj2,classNames){var clazzname,i,l;if($.isArray(classNames)){for(i=0,l=classNames.length;i<l;i++){clazzname=classNames[i];if(jsavObj1.hasClass(clazzname)!==jsavObj2.hasClass(clazzname)){return false}}}else{clazzname=classNames;if(jsavObj1.hasClass(clazzname)!==jsavObj2.hasClass(clazzname)){return false}}return true};var rhorizontal=/left|center|right/,rvertical=/top|center|bottom/;var combineAnchorAndOffsets=function(anchor,offsetLeft,offsetTop){var pos=(anchor||"").split(" ");if(pos.length===1){pos=rhorizontal.test(pos[0])?pos.concat(["center"]):rvertical.test(pos[0])?["center"].concat(pos):["center","center"]}pos[0]=rhorizontal.test(pos[0])?pos[0]:"center";pos[1]=rvertical.test(pos[1])?pos[1]:"center";return pos[0]+(offsetLeft>=0?"+"+offsetLeft:offsetLeft)+" "+pos[1]+(offsetTop>=0?"+"+offsetTop:offsetTop)};var animateToNewRelativePosition=function(jsavobj,relElem,offsetLeft,offsetTop,anchor,myAnchor){var el=jsavobj.element,elemCurPos=el.position();el.position({my:combineAnchorAndOffsets(myAnchor,offsetLeft,offsetTop),at:anchor,of:relElem,collision:"none"});var elemPos=el.position();var elemLeft=elemPos.left;var elemTop=elemPos.top;if(elemLeft===elemCurPos.left&&elemTop===elemCurPos.top){return{left:0,top:0}}else{el.css({left:elemCurPos.left,top:elemCurPos.top});jsavobj.moveTo(elemLeft,elemTop)}return{left:elemLeft-elemCurPos.left,top:elemTop-elemCurPos.top}};_helpers._setRelativeFollowUpdater=function(jsavobj,target,options){
if(jsavobj._relativehandle){jsavobj._relativetarget._unregisterMoveListener(jsavobj._relativehandle);jsavobj.jsav.container.off("jsav-updaterelative",jsavobj._updaterelativehandle)}var leftSum=0,topSum=0,callbackFunc=options&&$.isFunction(options.callback);var updaterelativehandle=function(){if(leftSum!==0||topSum!==0){jsavobj.translate(leftSum,topSum);leftSum=0;topSum=0}};var relativehandle=function(evt,dleft,dtop){evt.stopPropagation();if(callbackFunc){options.callback(dleft,dtop)}leftSum+=dleft;topSum+=dtop};if(!options||options.autotranslate){jsavobj.jsav.container.on("jsav-updaterelative",updaterelativehandle)}jsavobj._relativetarget=target;jsavobj._relativehandle=relativehandle;jsavobj._updaterelativehandle=updaterelativehandle;target._registerMoveListener(relativehandle)};_helpers.setRelativePositioning=function(jsavobj,options){var el=jsavobj.element,relElem=options.relativeTo,anchor=options.anchor||"center",myAnchor=options.myAnchor||"center",follow=!!options.follow;if(!(relElem instanceof jQuery)){if(relElem.nodeType===Node.ELEMENT_NODE){relElem=$(relElem)}else if(relElem.constructor===JSAV._types.ds.AVArray&&"relativeIndex"in options){relElem=relElem.index(options.relativeIndex).element}else if(JSAV.utils.isGraphicalPrimitive(relElem)){relElem=$(relElem.rObj.node)}else{relElem=relElem.element||relElem}}el.css({position:"absolute"});var offsetLeft=parseInt(options.left||0,10),offsetTop=parseInt(options.top||0,10);if(jsavobj._relativehandle){var move=animateToNewRelativePosition(jsavobj,relElem,offsetLeft,offsetTop,anchor,myAnchor);if($.isFunction(options.callback)){options.callback(move.left,move.top)}}else{el.position({my:combineAnchorAndOffsets(myAnchor,offsetLeft,offsetTop),at:anchor,of:relElem,collision:"none"})}if(follow){this._setRelativeFollowUpdater(jsavobj,options.relativeTo,$.extend({autotranslate:true},options))}};_helpers.handlePosition=function(jsavobj){var el=jsavobj.element,options=jsavobj.options;if("relativeTo"in options||"left"in options||"top"in options||"bottom"in options||"right"in options){var positions=["right","bottom","top","left"],posProps={position:"absolute"},pos;options.center=false;if("relativeTo"in options&&options.relativeTo){this.setRelativePositioning(jsavobj,options)}else{for(var i=positions.length;i--;){pos=positions[i];if(options.hasOwnProperty(pos)){posProps[positions[i]]=options[pos]}el.css(posProps)}}}};_helpers.handleVisibility=function(jsavobj,options){jsavobj.element.css("display","none");var visible=typeof options.visible==="boolean"&&options.visible===true;if(visible){jsavobj.show(options)}};_helpers._toggleClass=function(className,options){var opts=$.extend({animate:true},options);if(this.jsav._shouldAnimate()&&opts.animate){this.jsav.effects._toggleClass(this.element,className,options)}else{this.element.toggleClass(className)}return[className,options]};_helpers.addClass=function(className,options){if(!this.element.hasClass(className)){return this.toggleClass(className,options)}else{return this}};_helpers.removeClass=function(className,options){if(this.element.hasClass(className)){return this.toggleClass(className,options)}else{return this}};_helpers.hasClass=function(className){return this.element.hasClass(className)}})(jQuery);(function($){"use strict";if(typeof JSAV==="undefined"){return}var MessageHandler=function(jsav,output){this.jsav=jsav;this.output=output;if(this.output&&"title"in jsav.options){this.output.html("<div class='jsavtitle'>"+jsav.options.title+"</div>")}};MessageHandler.prototype.umsg=JSAV.anim(function(msg,options){if(options&&options.fill&&typeof options.fill==="object"){msg=JSAV.utils.replaceLabels(msg,options.fill)}var opts=$.extend({color:"black",preserve:false},options);if(this.output){if(this.output.hasClass("jsavline")&&opts.preserve){var el=this.output.find("div:last"),newmsg="<span style='color:"+opts.color+";'>"+msg+"</span>";if(el.size()>0){el.append(newmsg)}else{this.output.html("<div style='color:"+opts.color+";'>"+msg+"</div>")}}else if(this.output.hasClass("jsavline")){this.output.html("<div style='color:"+opts.color+";'>"+msg+"</div>")}else{this.output.append("<div style='color:"+opts.color+";'>"+msg+"</div>");if(this.output[0]){this.output[0].scrollTop=this.output[0].scrollHeight}}}if($(this.jsav.container).attr("voice")==="true"){this.jsav.textToSpeech(msg,this.jsav.options.narration)}if(!this.jsav.RECORD){this.jsav.container.trigger("jsav-message",[msg,options])}return this});MessageHandler.prototype.clear=JSAV.anim(function(){if(this.output){this.output.html("")}});MessageHandler.prototype.state=function(newValue){if(newValue){this.output.html(newValue);this.jsav.container.trigger("jsav-message",[newValue,this.options]);if($(this.jsav.container).attr("voice")==="true"){this.jsav.textToSpeech(newValue,this.jsav.options.narration)}}else{return this.output.html()||"<span/>"}};JSAV.ext.umsg=function(msg,options){this._msg.umsg(msg,options)};JSAV.ext.clearumsg=function(msg,options){this._msg.clear()};JSAV.ext.textToSpeech=function(speechText,options){var synth=window.speechSynthesis;if(typeof synth==="undefined"){return}var modifiedMsg=speechText;var replacements=options.overrideReplacements||options.replacements||[];if(options.appendReplacements){replacements=replacements.concat(options.appendReplacements)}for(var i=0;i<replacements.length;i++){var replacement=replacements[i];modifiedMsg=modifiedMsg.replace(replacement.searchValue,replacement.replaceValue)}var u=new SpeechSynthesisUtterance;var amISpeaking=synth.speaking;u.lang=options.lang||"en";u.rate=1;u.text=modifiedMsg;if(amISpeaking===true){synth.cancel()}synth.speak(u)};var soundSettings=function(jsav){var $elem=$("<button class='jsavsound soundOff'></button>");$elem.click(function(){for(var j=0;j<window.length;j++){$(".sound",window.frames[j].document).not(this).each(function(){$(this.offsetParent).parent().find(".jsavcontainer").attr("voice","false");$(this).removeClass("sound").addClass("soundOff")})}$(".sound",window.document).not(this).each(function(){$(this.offsetParent).parent().find(".jsavcontainer").attr("voice","false");$(this).removeClass("sounds").addClass("soundOff")});var synth=window.speechSynthesis;var amISpeaking=synth.speaking;if($(this.offsetParent).attr("voice")!==undefined){if($(this.offsetParent).attr("voice")==="true"){$(this.offsetParent).attr("voice","false");if(amISpeaking===true){synth.cancel()}}else{$(this.offsetParent).attr("voice","true")}}else if($(this.offsetParent).parent().find(".jsavcontainer").attr("voice")==="true"){$(this.offsetParent).parent().find(".jsavcontainer").attr("voice","false");if(amISpeaking===true){synth.cancel()}}else{$(this.offsetParent).parent().find(".jsavcontainer").attr("voice","true")}if($(this).hasClass("sound")){$(this).removeClass("sound").addClass("soundOff");jsav.logEvent({type:"jsav-narration-off",currentStep:jsav.currentStep(),totalSteps:jsav.totalSteps()})}else{var txt=$(this.offsetParent).find(".jsavoutput").clone().find(".MathJax").remove().end().text();jsav.textToSpeech(txt,jsav.options.narration);$(this).removeClass("soundOff").addClass("sound");jsav.logEvent({type:"jsav-narration-on",currentStep:jsav.currentStep(),totalSteps:jsav.totalSteps()})}});return $elem};JSAV.init(function(options){var output=options.output?$(options.output):$(this.container).find(".jsavoutput");this._msg=new MessageHandler(this,output);var supportsSpeech=typeof window.speechSynthesis!=="undefined";if(supportsSpeech&&options.narration&&options.narration.enabled){var langMap=this.options.narration.langMap||{};var lang=this.options.lang||"en";options.narration.lang=langMap[lang]||lang;if($(this.container).parent().find(".new").length===0&&$(this.container).find(".jsavcontrols").length!==0&&$(this.container).parent().find(".jsavsettings").length!==0){$(this.container).parent().find(".jsavsettings").wrap("<span class='new'></span>");$(this.container).parent().find(".new").append(soundSettings(this))}$(this.container).attr("voice","false")}});$(window).unload(function(){var synth=window.speechSynthesis;synth.cancel()})})(jQuery);(function($){"use strict";function callOrQueue(self,queue,fn){if(queue===true){self.queue(fn)}else if(queue){self.queue(queue,fn)}else{fn()}}$.fn.extend({jsavToggleClass:function(classNames,opts){var self=this;var opt=$.extend({queue:true,easing:"linear",delay:0},opts);opt.duration=jQuery.fx.off?0:typeof opt.duration==="number"?opt.duration:opt.duration in jQuery.fx.speeds?jQuery.fx.speeds[opt.duration]:jQuery.fx.speeds._default;if($.cssEase[opt.easing]){opt.easing=$.cssEase[opt.easing]}var transitionValue="all "+opt.duration+"ms "+opt.easing;if(opt.delay){transitionValue+=" "+opt.delay+"ms"}if(opt.duration===0){return this.toggleClass(this,arguments)}var RUN_DONE=false;var run=function(nextCall){var bound=false;var called=false;var cb=function(){if(called){return}called=true;if(bound){self.unbind($.support.transitionEnd,cb)}self.each(function(){this.style[$.support.transition]=null});if(typeof opt.complete==="function"){opt.complete.apply(self)}if(typeof nextCall==="function"){nextCall()}};if(opt.duration>0&&$.support.transitionEnd&&$.transit.useTransitionEnd){bound=true;self.bind($.support.transitionEnd,cb)}window.setTimeout(cb,opt.duration);if(!RUN_DONE){self.each(function(){if(opt.duration>0){this.style[$.support.transition]=transitionValue}$(this).toggleClass(classNames)})}RUN_DONE=true};var deferredRun=function(next){this.offsetWidth;run(next)};callOrQueue(self,opt.queue,deferredRun);return this}});var parseValueEffectParameters=function(){var params={args1:[],args2:[],from:arguments[0]};var secondstrPos=1;if(typeof arguments[1]==="number"){params.args1=[arguments[1]];secondstrPos=2}params.to=arguments[secondstrPos];if(typeof arguments[secondstrPos+1]==="number"){params.args2=[arguments[secondstrPos+1]]}return params};var doValueEffect=function(opts){var from=opts.from,to=opts.to,val=from.value.apply(from,opts.args1),oldValue=to.value.apply(to,opts.args2),$fromValElem,$toValElem,toPos;if(opts.mode==="swap"){from.value.apply(from,opts.args1.concat([oldValue,{record:false}]))}else if(opts.mode==="move"||typeof opts.old!=="undefined"){from.value.apply(from,opts.args1.concat([typeof opts.old!=="undefined"?opts.old:"",{record:false}]))}to.value.apply(to,opts.args2.concat([val,{record:false}]));if(from.constructor===JSAV._types.ds.AVArray){$fromValElem=from.element.find("li:eq("+opts.args1[0]+") .jsavvaluelabel")}else if(from.element.hasClass("jsavlabel")){$fromValElem=from.element}else{$fromValElem=from.element.find(".jsavvaluelabel")}if(to.constructor===JSAV._types.ds.AVArray){$toValElem=to.element.find("li:eq("+opts.args2[0]+") .jsavvaluelabel")}else if(to.element.hasClass("jsavlabel")){$toValElem=to.element}else{$toValElem=to.element.find(".jsavvaluelabel")}if(this._shouldAnimate()){var toValElemHeight=$toValElem.height();var fromValElemHeight=$fromValElem.height();$toValElem.position({of:$fromValElem});if(opts.mode==="swap"){toPos=$.extend({},$toValElem.position());if(to.options.layout!=="bar"){$toValElem.css({left:0,top:0})}else{$toValElem.css({left:0,bottom:0,top:""})}$fromValElem.position({of:$toValElem});$toValElem.css(toPos);if(from.options.layout!=="bar"){$fromValElem.transition({left:0,top:0},this.SPEED,"linear")}else{var bottom=$fromValElem.parent().height()-$fromValElem.position().top-fromValElemHeight;$fromValElem.css({top:"",bottom:bottom});$fromValElem.transition({left:0,bottom:0},this.SPEED,"linear")}}if(to.options.layout!=="bar"){$toValElem.transition({left:0,top:0},this.SPEED,"linear")}else{var bottom=$toValElem.parent().height()-$toValElem.position().top-toValElemHeight;$toValElem.css({top:"",bottom:bottom});$toValElem.transition({left:0,bottom:0},this.SPEED,"linear")}}return[{from:to,args1:opts.args2,to:from,args2:opts.args1,old:oldValue,mode:opts.mode}]};JSAV.ext.effects={_toggleClass:function($elems,clazz,options){this._animations+=$elems.length;var that=this;$elems.jsavToggleClass(clazz,{duration:options&&options.duration||this.SPEED,delay:options&&options.delay||0,complete:function(){that._animations--}})},transition:function($elems,cssProps,options){this._animations+=$elems.length;var that=this;$elems.transition(cssProps,{duration:options&&options.duration||this.SPEED,delay:options&&options.delay||0,complete:function(){that._animations--}})},_toggleVisible:function(){if(this.jsav._shouldAnimate()){this.element.fadeToggle(this.jsav.SPEED)}else{this.element.toggle()}return[]},show:function(options){if(this.element.filter(":visible").size()===0){this._toggleVisible(options)}return this},hide:function(options){if(this.element.filter(":visible").size()>0){this._toggleVisible(options)}return this},copyValue:function(){var params=parseValueEffectParameters.apply(null,arguments);JSAV.anim(doValueEffect).call(this,params)},moveValue:function(){var params=parseValueEffectParameters.apply(null,arguments);params.mode="move";JSAV.anim(doValueEffect).call(this,params)},swapValues:function(){var params=parseValueEffectParameters.apply(null,arguments);params.mode="swap";JSAV.anim(doValueEffect).call(this,params)},swap:function($str1,$str2,options){var opts=$.extend({translateY:true,arrow:true,highlight:true,swapClasses:false},options),$val1=$str1.find("span.jsavvalue"),$val2=$str2.find("span.jsavvalue"),classes1=$str1.attr("class"),classes2=$str2.attr("class"),posdiffX=JSAV.position($str1).left-JSAV.position($str2).left,posdiffY=opts.translateY?JSAV.position($str1).top-JSAV.position($str2).top:0,$both=$($str1).add($str2),speed=this.SPEED/5;var val1=$val1[0],val2=$val2[0],aparent=val1.parentNode,asibling=val1.nextSibling===val2?val1:val1.nextSibling;val2.parentNode.insertBefore(val1,val2);aparent.insertBefore(val2,asibling);if(opts.swapClasses){$str1.attr("class",classes2);$str2.attr("class",classes1)}if(this._shouldAnimate()){if("Raphael"in window&&opts.arrow){var off1=$val1.offset(),off2=$val2.offset(),coff=this.canvas.offset(),x1=off1.left-coff.left+$val1.outerWidth()/2,x2=off2.left-coff.left+$val2.outerWidth()/2,y1=off1.top-coff.top+$val1.outerHeight()+5,y2=y1,curve=20,cx1=x1,cx2=x2,cy1=y2+curve,cy2=y2+curve,arrowStyle="classic-wide-long";if(posdiffY>1||posdiffY<1){y2=off2.top-coff.top+$val2.outerHeight()+5;var angle=(y2-y1)/(x2-x1),c1=Math.pow(y1,2)-curve*curve/(1+angle*angle),c2=Math.pow(y2,2)-curve*curve/(1+angle*angle);cy1=y1+Math.sqrt(y1*y1-c1);cx1=x1-angle*Math.sqrt(y1*y1-c1);cy2=y2+Math.sqrt(y2*y2-c2);cx2=x2-angle*Math.sqrt(y2*y2-c2)}var arr=this.getSvg().path("M"+x1+","+y1+"C"+cx1+","+cy1+" "+cx2+","+cy2+" "+x2+","+y2).attr({"arrow-start":arrowStyle,"arrow-end":arrowStyle,"stroke-width":5,stroke:"lightGray"})}$val2.css({x:-posdiffX,y:-posdiffY,z:1});$val1.css({x:posdiffX,y:posdiffY,z:1});this._animations+=1;var jsav=this;if(opts.highlight){$both.addClass("jsavswap",3*speed)}$val1.transition({x:0,y:0,z:0},7*speed,"linear");$val2.transition({x:0,y:0,z:0},7*speed,"linear",function(){if(arr){arr.remove()}if(opts.highlight){$both.removeClass("jsavswap",3*speed)}jsav._animations-=1})}}}})(jQuery);(function($){"use strict";var events=["click","dblclick","mousedown","mousemove","mouseup","mouseenter","mouseleave"];var eventhandler=function(eventType,eventOpts){return function(data,handler,options){var defaultopts={edge:false},jsav=this.jsav,opts=defaultopts;if(typeof options==="object"){opts=$.extend(defaultopts,options)}else if(typeof handler==="object"){opts=$.extend(defaultopts,handler)}if(!opts.edge||opts.node){this.element.on(eventType,eventOpts.selector,function(e){var $curr=$(this),elem=$curr.data(eventOpts.dataField);while(!elem){$curr=$curr.parent();elem=$curr.data(eventOpts.dataField)}jsav.logEvent({type:eventOpts.logEventPrefix+eventType,objid:elem.id(),objvalue:elem.value()});if($.isFunction(data)){data.call(elem,e)}else if($.isFunction(handler)){var params=$.isArray(data)?data.slice(0):[data];params.push(e);handler.apply(elem,params)}})}if(opts.edge){this.jsav.canvas.on(eventType,'.jsavedge[data-container="'+this.id()+'"]',function(e){var edge=$(this).data("edge");jsav.logEvent({type:"jsav-edge-"+eventType,startvalue:edge.start().value(),endvalue:edge.end().value(),startid:edge.start().id(),endid:edge.end().id()});if($.isFunction(data)){data.call(edge,e)}else if($.isFunction(handler)){var params=$.isArray(data)?data.slice(0):[data];params.push(e);handler.apply(edge,params)}})}return this}};var on=function(eventOpts){return function(eventName,data,handler,options){eventhandler(eventName,eventOpts).call(this,data,handler,options);return this}};JSAV.utils._events={_addEventSupport:function(proto,options){var opts=$.extend({selector:".jsavnode",logEventPrefix:"jsav-node-",dataField:"node"},options);for(var i=events.length;i--;){proto[events[i]]=eventhandler(events[i],opts)}proto.on=on(opts)}}})(jQuery);if(typeof Raphael!=="undefined"){(function($,R){"use strict";if(typeof JSAV==="undefined"){return}var JSAVGraphical=function(){};JSAVGraphical.prototype={show:function(options){if(this.css("opacity")!==1){this.css({opacity:1},options)}},hide:function(options){if(this.css("opacity")!==0){this.css({opacity:0},options)}},isVisible:function(options){return this.css("opacity")!==0},transform:function(transform,options){var oldTrans=this.rObj.transform();if(this.jsav._shouldAnimate()){this.rObj.animate({transform:transform},this.jsav.SPEED)}else{this.rObj.transform(transform,options)}return oldTrans},rotate:JSAV.anim(function(deg){this.transform("...r"+deg);return[0-deg]}),scale:JSAV.anim(function(sx,sy){this.transform("...S"+sx+","+sy);return[1/sx,1/sy]}),scaleX:function(sx,options){return this.scale(sx,1,options)},scaleY:function(sy,options){return this.scale(1,sy,options)},translate:JSAV.anim(function(dx,dy,options){this.transform("...T"+dx+","+dy);return[0-dx,0-dy]}),translateX:function(dx,options){return this.translate(dx,0,options)},translateY:function(dy,options){return this.translate(0,dy,options)},_setattrs:JSAV.anim(function(props,options){var oldProps=$.extend(true,{},props);for(var i in props){if(props.hasOwnProperty(i)){oldProps[i]=this.rObj.attr(i)}}if(this.jsav._shouldAnimate()&&(!options||!options.dontAnimate)){this.rObj.animate(props,this.jsav.SPEED)}else{for(i in props){if(props.hasOwnProperty(i)){this.rObj.attr(i,props[i])}}}return[oldProps]}),css:function(props,options){if(typeof props==="string"){return this.rObj.attr(props)}else{return this._setattrs(props,options)}},state:function(newState){if(typeof newState!=="undefined"){for(var i in newState){if(newState.hasOwnProperty(i)){this.rObj.attr(i,newState[i])}}return this}else{var attrs=$.extend(true,{},this.rObj.attrs);return attrs}},bounds:function(){var bbox=this.rObj.getBBox();return{left:bbox.x,top:bbox.y,width:bbox.width,height:bbox.height}},id:JSAV._types.JSAVObject.prototype.id,clear:function(){this.rObj.remove()},equals:function(otherObj,options){if(!otherObj||!(otherObj instanceof JSAVGraphical)){return false}if(options&&"class"in options){var classEquals=JSAV.utils._helpers.classEquals(this,otherObj,options["class"]);if(!classEquals){return false}}return true}};var graphicalproto=JSAVGraphical.prototype;graphicalproto.addClass=JSAV.utils._helpers.addClass;graphicalproto.removeClass=JSAV.utils._helpers.removeClass;graphicalproto.hasClass=JSAV.utils._helpers.hasClass;graphicalproto.toggleClass=JSAV.anim(JSAV.utils._helpers._toggleClass);var events=["click","dblclick","mousedown","mousemove","mouseup","mouseenter","mouseleave"];var eventhandler=function(eventType){return function(data,handler){var self=this;this.element.on(eventType,function(e){self.jsav.logEvent({type:"jsav-graphical-"+eventType,objid:self.id()});if($.isFunction(data)){data.call(self,e)}else if($.isFunction(handler)){var params=$.isArray(data)?data.slice(0):[data];params.push(e);handler.apply(self,params)}});return this}};for(var i=events.length;i--;){graphicalproto[events[i]]=eventhandler(events[i])}graphicalproto.on=function(eventName,data,handler){eventhandler(eventName).call(this,data,handler);return this};var init=function(obj,jsav,props){obj.jsav=jsav;obj.element=$(obj.rObj.node).data("svgelem",obj.rObj);var prop=$.extend({visible:true},props);for(var i in prop){if(prop.hasOwnProperty(i)){obj.rObj.attr(i,prop[i])}}if(!("opacity"in prop)){obj.rObj.attr("opacity",0);var visible=typeof prop.visible==="boolean"&&prop.visible===true;if(visible){obj.show(prop)}}};var translatePoint=function(point,dx,dy,options){var currPath=this.rObj.attrs.path,newPath="",pathElem;if(point>currPath.length){return this}for(var i=0,l=currPath.length;i<l;i++){pathElem=currPath[i];if(i===point){newPath+=pathElem[0]+" "+(+pathElem[1]+dx)+" "+(+pathElem[2]+dy)}else{newPath+=pathElem.join(" ")}}this._setattrs({path:newPath},options);return this};var movePoints=function(points,options){var currPath=this.rObj.attrs.path,newPath=currPath.slice(),newPoints=this.points(),pathElem,i,l;for(i=0,l=points.length;i<l;i++){var p=points[i];pathElem=currPath[p[0]];newPath[p[0]]=[pathElem[0],p[1],p[2]];newPoints[p[0]]=p.slice(1)}var np="";for(i=0,l=newPath.length;i<l;i++){pathElem=newPath[i];np+=pathElem.join(" ")}this._setpoints(newPoints);this._setattrs({path:np},$.extend({dontAnimate:""+currPath==="M-1,-1L-1,-1"},options));return this};var _setpoints=JSAV.anim(function(newPoints){var oldPoints=$.extend(true,[],this._points);this._points=newPoints;return[oldPoints]});var points=function(){return $.extend(true,[],this._points)};var Circle=function(jsav,raphael,x,y,r,props){this.rObj=raphael.circle(x,y,r);init(this,jsav,props);return this};JSAV.utils.extend(Circle,JSAVGraphical);var cproto=Circle.prototype;cproto.center=function(x,y,options){if(typeof x==="undefined"){return this.rObj.attr(["cx","cy"])}else if($.isArray(x)&&x.length===2){this._setattrs({cx:x[0],cy:x[1]},options)}else if(typeof y!=="undefined"){this._setattrs({cx:x,cy:y},options)}else if("cx"in x&&"cy"in x){this._setattrs(x,options)}return this};cproto.radius=function(r,options){if(typeof r==="undefined"){return this.rObj.attr("r")}else{this._setattrs({r:r},options);return this}};var Rect=function(jsav,raphael,x,y,w,h,r,props){this.rObj=raphael.rect(x,y,w,h,r);init(this,jsav,props);return this};JSAV.utils.extend(Rect,JSAVGraphical);var rectproto=Rect.prototype;rectproto.width=function(w,options){if(typeof w==="undefined"){return this.rObj.attr("width")}else{this._setattrs({width:w},options);return this}};rectproto.height=function(h,options){if(typeof h==="undefined"){return this.rObj.attr("height")}else{this._setattrs({height:h},options);return this}};var Line=function(jsav,raphael,x1,y1,x2,y2,props){this.rObj=raphael.path("M"+x1+" "+y1+"L"+x2+" "+y2);init(this,jsav,props);this._points=[[x1,y1],[x2,y2]];return this};JSAV.utils.extend(Line,JSAVGraphical);Line.prototype.translatePoint=translatePoint;Line.prototype._polylineMovePoints=movePoints;Line.prototype.movePoints=function(newx1,newy1,newx2,newy2){if($.isArray(newx1)){return this._polylineMovePoints(newx1)}else{return this._polylineMovePoints([[0,newx1,newy1],[1,newx2,newy2]])}};Line.prototype.points=points;Line.prototype._setpoints=_setpoints;var Ellipse=function(jsav,raphael,x,y,rx,ry,props){this.rObj=raphael.ellipse(x,y,rx,ry);init(this,jsav,props);return this};JSAV.utils.extend(Ellipse,JSAVGraphical);var ellproto=Ellipse.prototype;ellproto.center=cproto.center;ellproto.radius=function(x,y,options){if(typeof x==="undefined"){return this.rObj.attr(["rx","ry"])}else if($.isArray(x)&&x.length===2){this._setattrs({rx:x[0],ry:x[1]},options)}else if(typeof y!=="undefined"){this._setattrs({rx:x,ry:y},options)}else if("rx"in x&&"ry"in x){this._setattrs(x,options)}return this};var Polyline=function(jsav,raphael,points,close,props){var path="M ";for(var i=0,l=points.length;i<l;i++){if(i){path+="L"}path+=points[i][0]+" "+points[i][1]}if(close){path+="Z"}this.rObj=raphael.path(path);init(this,jsav,props);this._points=points;return this};JSAV.utils.extend(Polyline,JSAVGraphical);Polyline.prototype.translatePoint=translatePoint;Polyline.prototype.movePoints=movePoints;Polyline.prototype.points=points;Polyline.prototype._setpoints=_setpoints;var Path=function(jsav,raphael,path,props){this.rObj=raphael.path(path);init(this,jsav,props);return this};JSAV.utils.extend(Path,JSAVGraphical);Path.prototype.path=function(newPath,options){if(typeof newPath==="undefined"){return this.rObj.attr("path")}else{return this._setattrs({path:newPath},options)}};var Set=function(jsav,raphael,props){this.rObj=raphael.set();init(this,jsav,props);return this};JSAV.utils.extend(Set,JSAVGraphical);var setproto=Set.prototype;setproto.push=function(g){this.rObj.push(g.rObj);return this};var getSvgCanvas=function(jsav,props){if(typeof props==="undefined"||!props.container){return jsav.getSvg()}else{return props.container.getSvg()}};JSAV.ext.g={circle:function(x,y,r,props){var svgCanvas=getSvgCanvas(this,props);return new Circle(this,svgCanvas,x,y,r,props)},rect:function(x,y,w,h,r,props){if(typeof r==="object"){props=r;r=0}var svgCanvas=getSvgCanvas(this,props);return new Rect(this,svgCanvas,x,y,w,h,r,props)},line:function(x1,y1,x2,y2,props){var svgCanvas=getSvgCanvas(this,props);return new Line(this,svgCanvas,x1,y1,x2,y2,props)},ellipse:function(x,y,rx,ry,props){var svgCanvas=getSvgCanvas(this,props);return new Ellipse(this,svgCanvas,x,y,rx,ry,props)},polyline:function(points,props){var svgCanvas=getSvgCanvas(this,props);return new Polyline(this,svgCanvas,points,false,props)},polygon:function(points,props){var svgCanvas=getSvgCanvas(this,props);return new Polyline(this,svgCanvas,points,true,props)},path:function(path,props){var svgCanvas=getSvgCanvas(this,props);return new Path(this,svgCanvas,path,props)},set:function(props){var svgCanvas=getSvgCanvas(this,props);return new Set(this,svgCanvas)}};var gTypes={JSAVGraphical:JSAVGraphical,Circle:Circle,Rect:Rect,Line:Line,Ellipse:Ellipse,Polyline:Polyline,Path:Path,Set:Set};JSAV._types.g=gTypes;var svgElements=["circle","path","rect","ellipse","line","polyline","polygon"],origWidthHook=$.cssHooks.width,origHeightHook=$.cssHooks.height;$.cssHooks.width={get:function(elem,computed,extra){if(svgElements.indexOf(elem.nodeName)!==-1){return elem.getBoundingClientRect().width}return origWidthHook.get(elem,computed,extra)},set:origWidthHook.set};$.cssHooks.height={get:function(elem,computed,extra){if(svgElements.indexOf(elem.nodeName)!==-1){return elem.getBoundingClientRect().height}return origHeightHook.get(elem,computed,extra)},set:origHeightHook.set};$.svg={isSVGElem:function(node){return node.nodeType==1&&node.namespaceURI=="http://www.w3.org/2000/svg"}};$.fn.addClass=function(origAddClass){return function(classNames){classNames=classNames||"";return this.each(function(){if($.svg.isSVGElem(this)){var node=this;$.each(classNames.split(/\s+/),function(i,className){var classes=node.className?node.className.baseVal:node.getAttribute("class");if($.inArray(className,classes.split(/\s+/))==-1){classes+=(classes?" ":"")+className;node.className?node.className.baseVal=classes:node.setAttribute("class",classes)}})}else{origAddClass.apply($(this),[classNames])}})}}($.fn.addClass);$.fn.removeClass=function(origRemoveClass){return function(classNames){classNames=classNames||"";return this.each(function(){if($.svg.isSVGElem(this)){var node=this;$.each(classNames.split(/\s+/),function(i,className){var classes=node.className?node.className.baseVal:node.getAttribute("class");classes=$.grep(classes.split(/\s+/),function(n,i){return n!=className}).join(" ");node.className?node.className.baseVal=classes:node.setAttribute("class",classes)})}else{origRemoveClass.apply($(this),[classNames])}})}}($.fn.removeClass);$.fn.toggleClass=function(origToggleClass){return function(className,state){return this.each(function(){if($.svg.isSVGElem(this)){if(typeof state!=="boolean"){state=!$(this).hasClass(className)}$(this)[(state?"add":"remove")+"Class"](className)}else{origToggleClass.apply($(this),[className,state])}})}}($.fn.toggleClass);$.fn.hasClass=function(origHasClass){return function(className){className=className||"";var found=false;this.each(function(){if($.svg.isSVGElem(this)){var classes=(this.className?this.className.baseVal:this.getAttribute("class")).split(/\s+/);found=$.inArray(className,classes)>-1}else{found=origHasClass.apply($(this),[className])}return!found});return found}}($.fn.hasClass)})(jQuery,Raphael)}else{var error=function(){console.error("You are trying to use graphical primitives but forgot to load Raphael.js.")};var g={};var names=["circle","rect","line","ellipse","polyline","polygon","path","set"];for(var i=names.length;i--;){g[names[i]]=error}JSAV.ext.g=g}(function($){"use strict";if(typeof JSAV==="undefined"){return}var Label=function(jsav,text,options){this.jsav=jsav;this.options=$.extend({visible:true},options);this.element=$('<div class="jsavlabel">'+text+"</div>");if(this.options.before){this.element.insertBefore(this.options.before.element)}else if(this.options.after){this.element.insertAfter(this.options.after.element)}else if(this.options.container){this.options.container.append(this.element)}else{$(this.jsav.canvas).append(this.element)}JSAV.utils._helpers.handlePosition(this);JSAV.utils._helpers.handleVisibility(this,this.options)};JSAV.utils.extend(Label,JSAV._types.JSAVObject);var labelproto=Label.prototype;labelproto._toggleVisible=JSAV.anim(JSAV.ext.effects._toggleVisible);labelproto.show=JSAV.ext.effects.show;labelproto.hide=JSAV.ext.effects.hide;labelproto._setText=JSAV.anim(function(newText){this.element.html(newText)});labelproto.text=function(newValue,options){if(typeof newValue==="undefined"){return this.element.html()}else{this._setText(newValue,options);return this}};labelproto.value=labelproto.text;labelproto.state=function(newState){if(typeof newState!=="undefined"){this.text(newState.t,{record:false});JSAV.utils._helpers.setElementClasses(this.element,newState.cls||[]);this.element.attr("style",newState.css||"")}else{var state={t:this.text()},style=this.element.attr("style");var cls=JSAV.utils._helpers.elementClasses(this.element);if(cls.length>0){state.cls=cls}if(style){state.css=style}return state}};labelproto.equals=function(otherLabel,options){if(!otherLabel||!(otherLabel instanceof Label)||this.text()!==otherLabel.text()){return false}if(options&&"css"in options){var cssEquals=JSAV.utils._helpers.cssEquals(this,otherLabel,options.css);if(!cssEquals){return false}}if(options&&"class"in options){var classEquals=JSAV.utils._helpers.classEquals(this,otherLabel,options["class"]);if(!classEquals){return false}}return true};labelproto.css=JSAV.utils._helpers.css;labelproto._setcss=JSAV.anim(JSAV.utils._helpers._setcss);labelproto.addClass=JSAV.utils._helpers.addClass;labelproto.removeClass=JSAV.utils._helpers.removeClass;labelproto.hasClass=JSAV.utils._helpers.hasClass;labelproto.toggleClass=JSAV.anim(JSAV.utils._helpers._toggleClass);JSAV._types.Label=Label;JSAV.ext.label=function(text,options){return new Label(this,text,options)}})(jQuery);(function($){"use strict";if(typeof JSAV==="undefined"){return}$.fn.getstyles=function(){var res={},arg;for(var i=0;i<arguments.length;i++){arg=arguments[i];if($.isArray(arg)){for(var j=0;j<arg.length;j++){res[arg[j]]=this.css(arg[j])}}else{res[arg]=this.css(arg)}}return res};var JSAVDataStructure=function(){};JSAV.utils.extend(JSAVDataStructure,JSAV._types.JSAVObject);var dsproto=JSAVDataStructure.prototype;dsproto.getSvg=function(){if(!this.svg){this.svg=new Raphael(this.element[0]);this.svg.renderfix();var style=this.svg.canvas.style;style.position="absolute"}return this.svg};dsproto._toggleVisible=JSAV.anim(JSAV.ext.effects._toggleVisible);dsproto.show=JSAV.ext.effects.show;dsproto.hide=JSAV.ext.effects.hide;dsproto.addClass=JSAV.utils._helpers.addClass;dsproto.removeClass=JSAV.utils._helpers.removeClass;dsproto.hasClass=JSAV.utils._helpers.hasClass;dsproto.toggleClass=JSAV.anim(JSAV.utils._helpers._toggleClass);dsproto.initialize=function(){};dsproto.initializeFromElement=function(){};dsproto.clone=function(){};var Edge=function(jsav,start,end,options){this.jsav=jsav;
this.startnode=start;this.endnode=end;this.options=$.extend(true,{display:true},options);this.container=start.container;var startPos=start?start.element.position():{left:0,top:0},endPos=end?end.element.position():{left:0,top:0};if(startPos.left===endPos.left&&startPos.top===endPos.top){this.g=this.jsav.g.line(-1,-1,-1,-1,$.extend({container:this.container},this.options))}else{if(end){endPos.left+=end.element.outerWidth()/2;endPos.top+=end.element.outerHeight()}if(!startPos.left&&!startPos.top){startPos=endPos}this.g=this.jsav.g.line(startPos.left,startPos.top,endPos.left,endPos.top,$.extend({container:this.container},this.options))}this.element=$(this.g.rObj.node);var visible=typeof this.options.display==="boolean"&&this.options.display===true;this.g.rObj.attr({opacity:0});this.element.addClass("jsavedge");if(start){this.element[0].setAttribute("data-startnode",this.startnode.id())}if(end){this.element[0].setAttribute("data-endnode",this.endnode.id())}this.element[0].setAttribute("data-container",this.container.id());this.element.data("edge",this);if(typeof this.options.weight!=="undefined"){this._weight=this.options.weight;this.label(this._weight)}if(visible){this.g.show()}};JSAV.utils.extend(Edge,JSAVDataStructure);var edgeproto=Edge.prototype;edgeproto.start=function(node,options){if(typeof node==="undefined"){return this.startnode}else{this.startnode=node;this.g.rObj.node.setAttribute("data-startnode",this.startnode?this.startnode.id():"");return this}};edgeproto.end=function(node,options){if(typeof node==="undefined"){return this.endnode}else{this.endnode=node;this.g.rObj.node.setAttribute("data-endnode",this.endnode?this.endnode.id():"");return this}};edgeproto._setweight=JSAV.anim(function(newWeight){var oldWeight=this._weight;this._weight=newWeight;return[oldWeight]});edgeproto.weight=function(newWeight){if(typeof newWeight==="undefined"){return this._weight}else{this._setweight(newWeight);this.label(newWeight)}};edgeproto.clear=function(){this.g.rObj.remove()};edgeproto.hide=function(options){if(this.g.isVisible()){this.g.hide(options);if(this._label){this._label.hide(options)}}};edgeproto.show=function(options){if(!this.g.isVisible()){this.g.show(options);if(this._label){this._label.show(options)}}};edgeproto.isVisible=function(){return this.g.isVisible()};edgeproto.label=function(newLabel,options){if(typeof newLabel==="undefined"){if(this._label&&this._label.element.filter(":visible").size()>0){return this._label.text()}else{return undefined}}else{if(!this._label){var self=this;var _labelPositionUpdate=function(options){if(!self._label){return}var bbox=options&&options.bbox?options.bbox:self.g.bounds(),lbbox=self._label.bounds(),newTop=bbox.top+(bbox.height-lbbox.height)/2,newLeft=bbox.left+(bbox.width-lbbox.width)/2;if(newTop!==lbbox.top||newLeft||lbbox.left){self._label.css({top:newTop,left:newLeft},options)}};this._labelPositionUpdate=_labelPositionUpdate;this._label=this.jsav.label(newLabel,{container:this.container.element});this._label.element.addClass("jsavedgelabel")}else{this._label.text(newLabel,options)}}};edgeproto.equals=function(otherEdge,options){if(!otherEdge||!otherEdge instanceof Edge){return false}if(options&&!options.dontCheckNodes){if(!this.startnode.equals(otherEdge.startnode)||!this.endnode.equals(otherEdge.endnode)){return false}}if(this._weight!==otherEdge._weight){return false}if(options&&"css"in options){var cssEquals=JSAV.utils._helpers.cssEquals(this,otherEdge,options.css);if(!cssEquals){return false}}if(options&&"class"in options){var classEquals=JSAV.utils._helpers.classEquals(this,otherEdge,options["class"]);if(!classEquals){return false}}return true};edgeproto._setcss=JSAV.anim(function(cssprop,value){var oldProps=$.extend(true,{},cssprop),el=this.g.rObj,newprops;if(typeof cssprop==="string"&&typeof value!=="undefined"){oldProps[cssprop]=el.attr(cssprop);newprops={};newprops[cssprop]=value}else{for(var i in cssprop){if(cssprop.hasOwnProperty(i)){oldProps[i]=el.attr(i)}}newprops=cssprop}if(this.jsav._shouldAnimate()){el.animate(newprops,this.jsav.SPEED)}else{el.attr(newprops)}return[oldProps]});edgeproto.css=function(cssprop,value,options){if(typeof cssprop==="string"&&typeof value==="undefined"){return this.g.rObj.attr(cssprop)}else{return this._setcss(cssprop,value,options)}};edgeproto.state=function(newState){if(typeof newState!=="undefined"){this.g.css(newState.a);JSAV.utils._helpers.setElementClasses(this.element,newState.cls||[]);if(newState.l){this.label(newState.l,{record:false})}else if(this.label()){this.label("")}if(newState.w){this.weight(newState.w)}else if(this.weight()){this.weight("")}}else{var state={a:this.g.rObj.attrs},cls=JSAV.utils._helpers.elementClasses(this.element);if(cls.length>0){state.cls=cls}if(this.label()){state.l=this.label()}if(this._weight){state.w=this.weight()}return state}};edgeproto.position=function(){var bbox=this.g.bounds();return{left:bbox.left,top:bbox.top}};edgeproto.addClass=function(className,options){if(!this.element.hasClass(className)){return this.toggleClass(className,options)}else{return this}};edgeproto.removeClass=function(className,options){if(this.element.hasClass(className)){return this.toggleClass(className,options)}else{return this}};edgeproto.hasClass=function(className){return this.element.hasClass(className)};edgeproto.toggleClass=JSAV.anim(function(className,options){this.element.toggleClass(className);return[className,options]});edgeproto.highlight=function(options){this.addClass("jsavhighlight",options)};edgeproto.unhighlight=function(options){this.removeClass("jsavhighlight",options)};edgeproto.layout=function(options){var sElem=this.start().element,eElem=this.end().element,start=options&&options.start?options.start:this.start().position(),end=options&&options.end?options.end:this.end().position(),sWidth=sElem.outerWidth()/2,sHeight=sElem.outerHeight()/2,eWidth=eElem.outerWidth()/2,eHeight=eElem.outerHeight()/2,fromX=options&&options.fromPoint?options.fromPoint[0]:Math.round(start.left+sWidth),fromY=options&&options.fromPoint?options.fromPoint[1]:Math.round(start.top+sHeight),toX=Math.round(end.left+eWidth),toY=Math.round(end.top+eHeight),fromAngle=normalizeAngle(2*Math.PI-Math.atan2(toY-fromY,toX-fromX)),toAngle=normalizeAngle(2*Math.PI-Math.atan2(fromY-toY,fromX-toX)),startRadius=parseInt(sElem.css("borderBottomRightRadius"),10)||0,ADJUSTMENT_MAGIC=2.2,strokeWidth=parseInt(this.g.element.css("stroke-width"),10),startStrokeAdjust=this.options["arrow-begin"]?strokeWidth*ADJUSTMENT_MAGIC:0,fromPoint=options&&options.fromPoint?options.fromPoint:getNodeBorderAtAngle({width:sWidth+startStrokeAdjust,height:sHeight+startStrokeAdjust,x:fromX,y:fromY},{x:toX,y:toY},fromAngle,startRadius),endRadius=parseInt(eElem.css("borderBottomRightRadius"),10)||0,endStrokeAdjust=this.options["arrow-end"]?strokeWidth*ADJUSTMENT_MAGIC:0,toPoint=getNodeBorderAtAngle({width:eWidth+endStrokeAdjust,height:eHeight+endStrokeAdjust,x:toX,y:toY},{x:fromX,y:fromY},toAngle,endRadius);this.g.movePoints([[0].concat(fromPoint),[1].concat(toPoint)],options);if($.isFunction(this._labelPositionUpdate)){var bbtop=Math.min(fromPoint[1],toPoint[1]),bbleft=Math.min(fromPoint[0],toPoint[0]),bbwidth=Math.abs(fromPoint[0]-toPoint[0]),bbheight=Math.abs(fromPoint[1]-toPoint[1]),bbox={top:bbtop,left:bbleft,width:bbwidth,height:bbheight};this._labelPositionUpdate($.extend({bbox:bbox},options))}if(this.start().value()==="jsavnull"||this.end().value()==="jsavnull"){this.addClass("jsavedge",options).addClass("jsavnulledge",options)}else{this.addClass("jsavedge",options).removeClass("jsavnulledge")}};function normalizeAngle(angle){var pi=Math.PI;while(angle<0){angle+=2*pi}while(angle>=2*pi){angle-=2*pi}return angle}function lineIntersectCircle(pointa,pointb,center,radius){var result={};var a=(pointb.x-pointa.x)*(pointb.x-pointa.x)+(pointb.y-pointa.y)*(pointb.y-pointa.y);var b=2*((pointb.x-pointa.x)*(pointa.x-center.x)+(pointb.y-pointa.y)*(pointa.y-center.y));var cc=center.x*center.x+center.y*center.y+pointa.x*pointa.x+pointa.y*pointa.y-2*(center.x*pointa.x+center.y*pointa.y)-radius*radius;var deter=b*b-4*a*cc;function interpolate(p1,p2,d){return{x:p1.x+(p2.x-p1.x)*d,y:p1.y+(p2.y-p1.y)*d}}if(deter<=0){result.inside=false}else{var e=Math.sqrt(deter);var u1=(-b+e)/(2*a);var u2=(-b-e)/(2*a);if((u1<0||u1>1)&&(u2<0||u2>1)){if(u1<0&&u2<0||u1>1&&u2>1){result.inside=false}else{result.inside=true}}else{if(0<=u2&&u2<=1){result.enter=interpolate(pointa,pointb,u2)}if(0<=u1&&u1<=1){result.exit=interpolate(pointa,pointb,u1)}result.intersects=true}}return result}function getNodeBorderAtAngle(dim,targetNodeCenter,angle,radius){dim.width=Math.max(dim.width,1);dim.height=Math.max(dim.height,1);var x,y,pi=Math.PI,urCornerA=Math.atan2(dim.height*2,dim.width*2),ulCornerA=pi-urCornerA,lrCornerA=2*pi-urCornerA,llCornerA=urCornerA+pi,intersect,topAngle,bottomAngle,leftAngle,rightAngle;radius=Math.min(radius,dim.width,dim.height);if(angle<urCornerA||angle>lrCornerA){topAngle=Math.atan2(dim.height-radius,dim.width);bottomAngle=2*pi-topAngle;x=dim.x+dim.width;y=dim.y-dim.width*Math.tan(angle);if(radius>0&&angle>topAngle&&angle<bottomAngle){if(angle<bottomAngle&&angle>pi){intersect=lineIntersectCircle({x:dim.x,y:dim.y},targetNodeCenter,{x:dim.x+dim.width-radius,y:dim.y+dim.height-radius},radius)}else{intersect=lineIntersectCircle({x:dim.x,y:dim.y},targetNodeCenter,{x:dim.x+dim.width-radius,y:dim.y-dim.height+radius},radius)}}}else if(angle>ulCornerA&&angle<llCornerA){topAngle=pi-Math.atan2(dim.height-radius,dim.width);bottomAngle=2*pi-topAngle;x=dim.x-dim.width;y=dim.y+dim.width*Math.tan(angle);if(radius>0&&(angle<topAngle||angle>bottomAngle)){if(topAngle>angle){intersect=lineIntersectCircle({x:dim.x,y:dim.y},targetNodeCenter,{x:dim.x-dim.width+radius,y:dim.y-dim.height+radius},radius)}else{intersect=lineIntersectCircle({x:dim.x,y:dim.y},targetNodeCenter,{x:dim.x-dim.width+radius,y:dim.y+dim.height-radius},radius)}}}else if(angle<=ulCornerA){rightAngle=Math.atan2(dim.height,dim.width-radius);leftAngle=pi-rightAngle;y=dim.y-dim.height;x=dim.x+dim.height/Math.tan(angle);if(radius>0&&(angle>leftAngle||angle<rightAngle)){if(angle>leftAngle){intersect=lineIntersectCircle({x:dim.x,y:dim.y},targetNodeCenter,{x:dim.x-dim.width+radius,y:dim.y-dim.height+radius},radius)}else{intersect=lineIntersectCircle({x:dim.x,y:dim.y},targetNodeCenter,{x:dim.x+dim.width-radius,y:dim.y-dim.height+radius},radius)}}}else{leftAngle=pi+Math.atan2(dim.height,dim.width-radius);rightAngle=2*pi-Math.atan2(dim.height,dim.width-radius);y=dim.y+dim.height;x=dim.x-dim.height/Math.tan(angle);if(radius>0&&(angle<leftAngle||angle>rightAngle)){if(angle>rightAngle){intersect=lineIntersectCircle({x:dim.x,y:dim.y},targetNodeCenter,{x:dim.x+dim.width-radius,y:dim.y+dim.height-radius},radius)}else{intersect=lineIntersectCircle({x:dim.x,y:dim.y},targetNodeCenter,{x:dim.x-dim.width+radius,y:dim.y+dim.height-radius},radius)}}}if(intersect&&intersect.exit){x=intersect.exit.x;y=intersect.exit.y}return[Math.round(x),Math.round(y)]}var Node=function(){};JSAV.utils.extend(Node,JSAVDataStructure);var nodeproto=Node.prototype;nodeproto.value=function(newVal,options){if(typeof newVal==="undefined"){return JSAV.utils.value2type(this.element.attr("data-value"),this.element.attr("data-value-type"))}else{this._setvalue(newVal,options)}return this};nodeproto._setvalue=JSAV.anim(function(newValue){var oldVal=this.value(),valtype=typeof newValue;if(typeof oldVal==="undefined"){oldVal=""}if(valtype==="object"){valtype="string"}this.element.find(".jsavvalue").html(this._valstring(newValue)).end().attr({"data-value":newValue,"data-value-type":valtype});return[oldVal]});nodeproto._valstring=function(value){return"<span class='jsavvaluelabel'>"+value+"</span>"};nodeproto.highlight=function(options){return this.addClass("jsavhighlight")};nodeproto.unhighlight=function(options){return this.removeClass("jsavhighlight")};nodeproto.isHighlight=function(){return this.hasClass("jsavhighlight")};nodeproto.state=function(newState){if(typeof newState!=="undefined"){this.value(newState.v,{record:false});JSAV.utils._helpers.setElementClasses(this.element,newState.cls||[]);this.element.attr("style",newState.css||"")}else{var state={v:this.value()},style=this.element.attr("style");var cls=JSAV.utils._helpers.elementClasses(this.element);if(cls.length>0){state.cls=cls}if(style){state.css=style}return state}};nodeproto.css=JSAV.utils._helpers.css;nodeproto._setcss=JSAV.anim(JSAV.utils._helpers._setcss);JSAV._types.ds={JSAVDataStructure:JSAVDataStructure,Edge:Edge,Node:Node};JSAV.ext.ds={layout:{}}})(jQuery);(function($){"use strict";if(typeof JSAV==="undefined"){return}var getIndices=JSAV.utils._helpers.getIndices;var templates={};templates.array='<span class="jsavvalue">'+'<span class="jsavvaluelabel">{{value}}</span>'+"</span>";templates["array-indexed"]=templates.array+'<span class="jsavindexlabel">{{index}}</span>';templates.vertical=templates.array;templates["vertical-indexed"]=templates["array-indexed"];templates.bar='<span class="jsavvaluebar"></span>'+templates.array;templates["bar-indexed"]=templates.bar+'<span class="jsavindexlabel">{{index}}</span>';var ArrayIndex=function(container,value,index,options){this.jsav=container.jsav;this.container=container;this.index=index;this.options=$.extend(true,{},options,{visible:true});var indHtml=container.options.template.replace("{{value}}",value).replace("{{index}}",index);var ind=$("<li class='jsavnode jsavindex'>"+indHtml+"</li>");this.element=ind;if(this.options.autoResize){ind.addClass("jsavautoresize")}this.container.element.append(ind)};JSAV.utils.extend(ArrayIndex,JSAV._types.ds.Node);var indexproto=ArrayIndex.prototype;indexproto.value=function(newValue,options){return this.container.value(this.index,newValue,options)};indexproto._setvalue=indexproto.value;indexproto.show=function(){};indexproto.hide=function(){};indexproto.equals=function(otherIndex,options){if(!otherIndex||this.value()!==otherIndex.value()||!otherIndex instanceof ArrayIndex){return false}if(options&&"css"in options){var cssEquals=JSAV.utils._helpers.cssEquals(this,otherIndex,options.css);if(!cssEquals){return false}}if(options&&"class"in options){var classEquals=JSAV.utils._helpers.classEquals(this,otherIndex,options["class"]);if(!classEquals){return false}}return true};var AVArray=function(jsav,element,options){this.jsav=jsav;this.options=$.extend(true,{autoresize:true,center:true,layout:"array"},options);if(!this.options.template){this.options.template=templates[this.options.layout+(this.options.indexed?"-indexed":"")]}this._indices=[];if($.isArray(element)){this.initialize(element)}else if(element){this.element=$(element);this.initializeFromElement()}};JSAV.utils.extend(AVArray,JSAV._types.ds.JSAVDataStructure);AVArray._templates=templates;var arrproto=AVArray.prototype;arrproto.isHighlight=function(index,options){return this.hasClass(index,"jsavhighlight")};arrproto.highlight=function(indices,options){this.addClass(indices,"jsavhighlight",options);return this};arrproto.unhighlight=function(indices,options){this.removeClass(indices,"jsavhighlight",options);return this};arrproto._setarraycss=JSAV.anim(function(cssprops,options){var oldProps=$.extend(true,{},cssprops),el=this.element;if(typeof cssprops!=="object"){return[cssprops]}else{for(var i in cssprops){if(cssprops.hasOwnProperty(i)){oldProps[i]=el.css(i)}}}if(this.jsav._shouldAnimate()){this.jsav.effects.transition(this.element,cssprops,options)}else{this.element.css(cssprops)}return[oldProps]});arrproto.css=function(indices,cssprop,options){var $elems;if(typeof cssprop==="string"){$elems=getIndices($(this.element).find("li"),indices);return $elems.css(cssprop)}else if(typeof indices==="string"){return this.element.css(indices)}else if(!$.isArray(indices)&&typeof indices==="object"){return this._setarraycss(indices,options)}else{var indArray=JSAV.utils._helpers.normalizeIndices($(this.element).find("li.jsavindex"),indices);for(var i=0,l=indArray.length;i<l;i++){this._indices[indArray[i]].css(cssprop,options)}return this}};arrproto.index=function(index){return this._indices[index]};arrproto.swap=JSAV.anim(function(index1,index2,options){var $pi1=$(this.element).find("li:eq("+index1+")"),$pi2=$(this.element).find("li:eq("+index2+")"),tmp=this._values[index1];this._values[index1]=this._values[index2];this._values[index2]=tmp;this.jsav.effects.swap($pi1,$pi2,options);return[index1,index2,options]});arrproto.clone=function(){var vals=this._values;var newArray=new AVArray(this.jsav,vals,$.extend(true,{},this.options,{visible:false}));newArray.state(this.state());return newArray};arrproto.size=function(){return this.element.find("li").size()};arrproto.value=function(index,newValue,options){if(typeof newValue==="undefined"){return this._values[index]}else{return this._setvalue(index,newValue,options)}};arrproto._newindex=function(value,index){if(typeof value==="undefined"){value=""}if(typeof index==="undefined"){index=""}var ind=new ArrayIndex(this,value,index,this.options);this._indices[index]=ind;return ind};arrproto._setvalue=JSAV.anim(function(index,newValue){var size=this.size(),oldval=this.value(index);while(index>size-1){var newli=this._newindex("",size);this._values[size]="";size=this.size()}var $index=this.element.find("li:eq("+index+")");this._values[index]=newValue;$index.find(".jsavvaluelabel").html(""+newValue);return[index,oldval]});arrproto._initOptionClasses=function(){if(this.options.autoresize){this.element.addClass("jsavautoresize")}if(this.options.center){this.element.addClass("jsavcenter")}if(this.options.indexed){this.element.addClass("jsavindexed")}};arrproto.initialize=function(data){var el=this.options.element||$("<ol/>"),key,val,i;if(!this.options.element){$(this.jsav.canvas).append(el)}this.element=el;this._initOptionClasses();this._values=data.slice(0);for(i=0;i<data.length;i++){if(data[i]===null||data[i]===undefined){this._values[i]=""}}el.addClass("jsavarray");this.options=jQuery.extend({visible:true},this.options);for(key in this.options){if(this.options.hasOwnProperty(key)){val=this.options[key];if(typeof val==="string"||typeof val==="number"||typeof val==="boolean"){el.attr("data-"+key,val)}}}for(i=0;i<data.length;i++){this._newindex(data[i],i)}JSAV.utils._helpers.handlePosition(this);this.layout();el.css("display","none");JSAV.utils._helpers.handleVisibility(this,this.options)};arrproto.initializeFromElement=function(){if(!this.element){return}var $elem=this.element,$elems=$elem.find("li"),data=$elem.data(),that=this;for(var key in data){if(data.hasOwnProperty(key)){this.options[key]=data[key]}}$elem.addClass("jsavarray");this._initOptionClasses();this._values=[];$elems.each(function(index){var $this=$(this),value=JSAV.utils.value2type($this.attr("data-value")||$this.html(),$this.attr("data-value-type")||"string"),$newElem=that._newindex(value,index);that._values[index]=value;$this.remove()});this.layout()};arrproto.layout=function(options){var layoutAlg=this.options.layout||"_default";this.element.removeClass("jsavbararray");return this.jsav.ds.layout.array[layoutAlg](this,options)};arrproto.state=function(newstate){if(newstate){this.element.attr("style",newstate.style||"");JSAV.utils._helpers.setElementClasses(this.element,newstate.classes||[]);var currIndices=this._indices,newIndices=newstate.ind,i=0,curr=currIndices.length,newl=newIndices.length;for(;i<curr&&i<newl;i++){currIndices[i].state(newIndices[i])}while(i<curr){var lastInd=currIndices.length-1;currIndices[lastInd].element.remove();currIndices.splice(lastInd);this._values.splice(lastInd);i++}while(i<newl){var newInd=this._newindex("",i);newInd.state(newIndices[i]);i++}}else{var state={ind:[]};var indices=state.ind;for(var i=0,l=this._indices.length;i<l;i++){indices.push(this._indices[i].state())}var style=this.element.attr("style");if(style){state.style=style}var cls=JSAV.utils._helpers.elementClasses(this.element);if(cls.length>0){state.classes=cls}return state}};arrproto.equals=function(otherArray,options){var opts=options||{},i,j,equal,cssprop,clazzname,len;if($.isArray(otherArray)){if(!options){len=otherArray.length;if(this.size()!==len){return false}for(i=0;i<len;i++){equal=this.value(i)==otherArray[i];if(!equal){return false}}return true}else{if("css"in opts){cssprop=opts.css;for(i=0;i<len;i++){equal=this.css(i,cssprop)===otherArray[i];if(!equal){return false}}return true}}}else{len=otherArray.size();if(this.size()!==len){return false}if(!("value"in opts)||opts.value){for(i=0;i<len;i++){equal=this.value(i)==otherArray.value(i);if(!equal){return false}}}if("css"in opts){if($.isArray(opts.css)){for(i=0;i<opts.css.length;i++){cssprop=opts.css[i];for(j=0;j<len;j++){equal=this.css(j,cssprop)===otherArray.css(j,cssprop);if(!equal){return false}}}}else{cssprop=opts.css;for(i=0;i<len;i++){equal=this.css(i,cssprop)===otherArray.css(i,cssprop);if(!equal){return false}}}}if("class"in opts){if($.isArray(opts["class"])){for(i=0;i<opts["class"].length;i++){clazzname=opts["class"][i];for(j=0;j<len;j++){equal=this.hasClass(j,clazzname)===otherArray.hasClass(j,clazzname);if(!equal){return false}}}}else{clazzname=opts["class"];for(i=0;i<len;i++){equal=this.hasClass(i,clazzname)===otherArray.hasClass(i,clazzname);if(!equal){return false}}}}return true}return false};arrproto.toggleClass=JSAV.anim(function(index,className,options){var $elems=getIndices($(this.element).find("li.jsavindex"),index);if(this.jsav._shouldAnimate()){this.jsav.effects._toggleClass($elems,className,options)}else{$elems.toggleClass(className)}return[index,className,options]});arrproto.addClass=function(index,className,options){var indices=JSAV.utils._helpers.normalizeIndices($(this.element).find("li.jsavindex"),index,":not(."+className+")");if(indices.length>0){return this.toggleClass(indices,className,options)}else{return this}};arrproto.removeClass=function(index,className,options){var indices=JSAV.utils._helpers.normalizeIndices($(this.element).find("li.jsavindex"),index,"."+className);if(indices.length>0){return this.toggleClass(indices,className,options)}else{return this}};arrproto.hasClass=function(index,className){var $elems=getIndices($(this.element).find("li.jsavindex"),index);return $elems.hasClass(className)};arrproto.isEmpty=function(){for(var i=0;i<this.size();i++){if(this.value(i)!==""){return false}}return true};var events=["click","dblclick","mousedown","mousemove","mouseup","mouseenter","mouseleave"];var eventhandler=function(eventType){return function(data,handler){var self=this;this.element.on(eventType,".jsavindex",function(e){var index=self.element.find(".jsavindex").index(this);self.jsav.logEvent({type:"jsav-array-"+eventType,arrayid:self.id(),index:index});if($.isFunction(data)){data.call(self,index,e)}else if($.isFunction(handler)){var params=$.isArray(data)?data.slice(0):[data];params.unshift(index);params.push(e);handler.apply(self,params)}});return this}};for(var i=events.length;i--;){arrproto[events[i]]=eventhandler(events[i])}arrproto.on=function(eventName,data,handler){eventhandler(eventName).call(this,data,handler);return this};arrproto.toggleArrow=function(indices,options){this.toggleClass(indices,"jsavarrow",options)};arrproto.toggleLine=JSAV.anim(function(index,options){if(this.options.layout!=="bar"){return}var valelem=this.element.find("li .jsavvalue").eq(index),lielem=valelem.parent();if(valelem.size()===0){return}var opts=$.extend({startIndex:0,endIndex:this.size()-1},options);var $mark=lielem.find(".jsavmark"),$markline=lielem.find(".jsavmarkline");if($markline.size()===0&&$mark.size()===0){if(opts.markStyle!==null){$mark=$("<div class='jsavmark' />");lielem.prepend($mark);if(opts.markStyle){$mark.css(opts.markStyle)}$mark.css({bottom:valelem.height()-$mark.outerHeight()/2,left:valelem.position().left+valelem.width()/2-$mark.outerWidth()/2,display:"block"})}if(opts.lineStyle!==null){$markline=$("<div class='jsavmarkline' />");lielem.prepend($markline);if(opts.lineStyle){$markline.css(opts.lineStyle)}var startelem=this.element.find("li:eq("+opts.startIndex+")"),endelem=this.element.find("li:eq("+opts.endIndex+")");$markline.css({width:endelem.position().left-startelem.position().left+endelem.width(),left:startelem.position().left-lielem.position().left,bottom:valelem.height()-$markline.outerHeight()/2,display:"block"})}}else{$mark.remove();$markline.remove()}return[index,opts]});JSAV._types.ds.AVArray=AVArray;JSAV._types.ds.ArrayIndex=ArrayIndex;JSAV.ext.ds.array=function(element,options){return new AVArray(this,element,options)}})(jQuery);(function($){"use strict";function setArrayWidth(array,$lastItem,options){var width=0;array.element.find("li").each(function(index,item){width+=$(this).outerWidth(true)});if(width!==array.element.width()){array.css({width:width+1+"px"})}}function horizontalArray(array,options){var $arr=$(array.element).addClass("jsavhorizontalarray"),$items=$arr.find("li"),maxHeight=-1;$items.each(function(index,item){var $i=$(this);maxHeight=Math.max(maxHeight,$i.outerHeight())});$arr.height(maxHeight+(array.options.indexed?30:0));setArrayWidth(array,$items.last(),options);var arrPos=$arr.position();return{width:$arr.outerWidth(),height:$arr.outerHeight(),left:arrPos.left,top:arrPos.top}}function verticalArray(array,options){var $arr=$(array.element).addClass("jsavverticalarray"),$items=$arr.find("li"),maxWidth=-1,indexed=!!array.options.indexed;if(indexed){var indexMaxWidth=-1;$items.each(function(index,item){var $i=$(this);var $indexLabel=$i.find(".jsavindexlabel");indexMaxWidth=Math.max(indexMaxWidth,$indexLabel.innerWidth());$indexLabel.css({top:$i.innerHeight()/2-$indexLabel.outerHeight()/2})});$items.css("margin-left",indexMaxWidth)}$items.each(function(index,item){maxWidth=Math.max(maxWidth,$(item).outerWidth())});if(maxWidth!==array.element.width()){array.css({width:maxWidth+1+"px"})}var arrPos=$arr.position();return{width:$arr.outerWidth(),height:$arr.outerHeight(),left:arrPos.left,top:arrPos.top}}function barArray(array,options){var $arr=$(array.element).addClass("jsavbararray"),$items=$arr.find("li.jsavindex"),maxValue=Number.MIN_VALUE,width=$items.first().outerWidth(),size=array.size();for(var i=0;i<size;i++){maxValue=Math.max(maxValue,array.value(i))}maxValue*=1.15;var setBarHeight=JSAV.anim(function(elem,newHeight,options){var oldHeight=elem.height();if(this.jsav._shouldAnimate()){this.jsav.effects.transition(elem,{height:newHeight},options)}else{elem.css({height:newHeight})}return[elem,oldHeight]});$items.each(function(index,item){var $i=$(this);var $valueBar=$i.find(".jsavvaluebar"),$value=$i.find(".jsavvalue"),valueBarHeight=$valueBar.height(),newBarHeight=Math.round(valueBarHeight*(array.value(index)/maxValue));if(newBarHeight!==$value.height()){setBarHeight.call(array,$value,newBarHeight)}});setArrayWidth(array,$items.last(),options);return{width:array.element.outerWidth(),height:array.element.outerHeight(),left:array.position().left,top:array.position().top}}JSAV.ext.ds.layout.array={_default:horizontalArray,bar:barArray,array:horizontalArray,vertical:verticalArray}})(jQuery);(function($){"use strict";if(typeof JSAV==="undefined"){return}var Edge=JSAV._types.ds.Edge;var Tree=function(jsav,options){this.init(jsav,options)};JSAV.utils.extend(Tree,JSAV._types.ds.JSAVDataStructure);var treeproto=Tree.prototype;treeproto.init=function(jsav,options){this._layoutDone=false;this.jsav=jsav;this.options=options;var el=this.options.element||$("<div/>");el.addClass("jsavtree jsavcommontree");for(var key in this.options){var val=this.options[key];if(this.options.hasOwnProperty(key)&&typeof val==="string"||typeof val==="number"||typeof val==="boolean"){el.attr("data-"+key,val)}}if(!this.options.element){$(this.jsav.canvas).append(el)}this.element=el;if(this.options.autoresize){this.element.addClass("jsavautoresize")}JSAV.utils._helpers.handlePosition(this);this.constructors=$.extend({Tree:Tree,Node:TreeNode,Edge:Edge},this.options.constructors);this.rootnode=this.newNode("",null);this.element.attr({"data-root":this.rootnode.id(),id:this.id()});this.rootnode.element.attr("data-child-role","root");JSAV.utils._helpers.handleVisibility(this,this.options)};treeproto._setrootnode=JSAV.anim(function(node){var oldroot=this.rootnode;this.rootnode=node;this.element.attr("data-root",node.id());node.element.attr("data-child-role","root");node.element.removeAttr("data-parent data-binchildrole data-child-pos");if(oldroot){oldroot.element.removeAttr("data-child-role")}return[oldroot]});treeproto.root=function(newRoot,options){var opts=$.extend({hide:true},options);if(typeof newRoot==="undefined"){return this.rootnode}else if(newRoot instanceof this.constructors.Node){var oldroot=this.rootnode;this._setrootnode(newRoot,options);this.rootnode.edgeToParent(null);if(opts.hide&&oldroot){oldroot.hide()}}else{if(this.rootnode){this.rootnode.value(newRoot,options)}else{this._setrootnode(this.newNode(newRoot,null,options),options)}}return this.rootnode};treeproto.clear=function(){this.root().clear();this.element.remove()};treeproto.newNode=function(value,parent,options){return new this.constructors.Node(this,value,parent,options)};treeproto.height=function(){return this.rootnode.height()};treeproto.layout=function(options){var layoutAlg=this.options.layout||"_default";return this.jsav.ds.layout.tree[layoutAlg](this,options)};treeproto.equals=function(otherTree,options){if(!otherTree instanceof this.constructors.Tree){return false}return this.root().equals(otherTree.root(),options)};treeproto.css=JSAV.utils._helpers.css;treeproto._setcss=JSAV.anim(JSAV.utils._helpers._setcss);treeproto.show=function(options){if(this.element.filter(":visible").size()===0){this._toggleVisible(options)}var opts=$.extend({recursive:true},options);if(opts.recursive){this.root().show(options)}return this};treeproto.hide=function(options){if(this.element.filter(":visible").size()>0){this._toggleVisible(options)}var opts=$.extend({recursive:true},options);if(opts.recursive){this.root().hide(options)}return this};treeproto.state=function(newState){if(typeof newState!=="undefined"){var tree=this;var setNodeState=function(node,newState){node.state(newState);var newChildren=newState.children||[],children=node.children(),pos=0;var newChildState=newChildren[pos],child=children[pos];while(newChildState&&child){setNodeState(child,newChildState);pos++;newChildState=newChildren[pos];child=children[pos]}if(newChildren.length>children.length){while(pos<newChildren.length){var newChildNode=tree.newNode("",node,{record:false});node.addChild(newChildNode);setNodeState(newChildNode,newChildren[pos]);pos++}}else{while(pos<children.length){node.child(pos).remove({record:false});children=node.children()}}};setNodeState(this.root(),newState)}else{var nodeState=function(node){if(!node){return null}var state=node.state(),children=node.children();if(children.length>0){state.children=[];for(var i=0;i<children.length;i++){state.children.push(nodeState(node.child(i)))}}return state};return nodeState(this.root())}};JSAV.utils._events._addEventSupport(treeproto);var TreeNode=function(container,value,parent,options){this.init(container,value,parent,options)};JSAV.utils.extend(TreeNode,JSAV._types.ds.Node);var nodeproto=TreeNode.prototype;nodeproto.init=function(container,value,parent,options){this.jsav=container.jsav;this.container=container;this.parentnode=parent;this.options=$.extend(true,{visible:true},parent?parent.options:{},options);this.constructors=$.extend({},container.constructors,this.options.constructors);var el=this.options.nodeelement||$("<div><span class='jsavvalue'>"+this._valstring(value)+"</span></div>"),valtype=typeof value;if(valtype==="object"){valtype="string"}this.element=el;el.addClass("jsavnode jsavtreenode").attr({"data-value":value,id:this.id(),"data-value-type":valtype}).data("node",this);if(parent){el.attr("data-parent",parent.id())}if(this.options.autoResize){el.addClass("jsavautoresize")}this.container.element.append(el);JSAV.utils._helpers.handleVisibility(this,this.options);if(parent){this._edgetoparent=new this.constructors.Edge(this.jsav,this,parent);
if(this.options.edgeLabel){this._edgetoparent.label(this.options.edgeLabel)}}this.childnodes=[]};nodeproto._valstring=function(value){var valstr="<span class='jsavvaluelabel'>";if(value==="jsavnull"){return valstr+"</span>"}return valstr+value+"</span>"};nodeproto._setparent=JSAV.anim(function(newParent,options){var oldParent=this.parentnode;this._edgetoparent.end(newParent,options);if(options&&options.edgeLabel){this._edgetoparent.label(options.edgeLabel,options)}this.element.attr("data-parent",newParent?newParent.id():"");this.parentnode=newParent;return[oldParent,options]});nodeproto.parent=function(newParent,options){if(typeof newParent==="undefined"){return this.parentnode}else{if(!this._edgetoparent){this._setEdgeToParent(new this.constructors.Edge(this.jsav,this,newParent,options))}this._setparent(newParent,options);if(this.isVisible()&&newParent&&newParent.isVisible()&&!this._edgetoparent.isVisible()){this._edgetoparent.show()}else if((!this.isVisible()||!newParent||!newParent.isVisible())&&this._edgetoparent.isVisible()){if(!options||typeof options.hide==="undefined"||options.hide){this._edgetoparent.hide()}}return this}};nodeproto._setEdgeToParent=JSAV.anim(function(edge,options){var oldEdge=this._edgetoparent;this._edgetoparent=edge;return[oldEdge,options]});nodeproto.edgeToParent=function(edge,options){if(typeof edge==="undefined"){return this._edgetoparent}else{if(!edge&&this._edgetoparent){this._edgetoparent.hide()}return this._setEdgeToParent(edge,options)}};nodeproto.edgeToChild=function(pos){var child=this.child(pos);if(child){return child.edgeToParent()}else{return undefined}};nodeproto.clear=function(){if(this.edgeToParent()){this.edgeToParent().clear()}var ch=this.children();for(var i=ch.length;i--;){if(ch[i]){ch[i].clear()}}this.childnodes=[];this.element.remove()};nodeproto.addChild=function(node,options){var pos=this.childnodes.length;return this.child(pos,node,options)};nodeproto._setchildnodes=JSAV.anim(function(newchildren,options){var oldChildren=this.childnodes;this.childnodes=newchildren;$.each(newchildren,function(index,n){n.element.attr("data-child-pos",index)});return[oldChildren,options]});var setchildhelper=function(self,pos,node,options){var oldval=self.childnodes[pos],opts=$.extend({hide:true},options);if(oldval){if(opts.hide){oldval.hide()}oldval.parent(null,opts)}if(node){var newchildnodes=self.childnodes.slice(0);newchildnodes[pos]=node;if(node.parent()&&node.parent()!==self){node.remove({hide:false})}node.parent(self);self._setchildnodes(newchildnodes,opts)}else{self._setchildnodes($.map(self.childnodes,function(item,index){if(index!==pos){return item}else{return null}}),opts)}return self};nodeproto.child=function(pos,node,options){if(typeof node==="undefined"){return this.childnodes[pos]}else{if(node!==null&&!(node instanceof this.constructors.Node)){node=this.container.newNode(node,this,options)}return setchildhelper(this,pos,node,options)}};nodeproto.remove=function(options){if(this===this.container.rootnode){this.container.root(this.container.newNode("",null),options);return this}var parent=this.parent(),children=parent.children();for(var i=0,l=children.length;i<l;i++){if(children[i]===this){return parent.child(i,null,options)}}return this};nodeproto.height=function(){var chs=this.children(),maxheight=0,max=Math.max;for(var i=0,l=chs.length;i<l;i++){if(chs[i]){maxheight=max(maxheight,chs[i].height())}}return maxheight+1};nodeproto.equals=function(otherNode,options){if(!otherNode||this.value()!==otherNode.value()){return false}if(options&&"css"in options){var cssEquals=JSAV.utils._helpers.cssEquals(this,otherNode,options.css);if(!cssEquals){return false}}if(options&&"class"in options){var classEquals=JSAV.utils._helpers.classEquals(this,otherNode,options["class"]);if(!classEquals){return false}}if(this.edgeToParent()){var edgeEquals=this.edgeToParent().equals(otherNode.edgeToParent(),$.extend({},options,{dontCheckNodes:true}));if(!edgeEquals){return false}}var ch=this.children(),och=otherNode.children();if(ch.length!==och.length){return false}for(var j=0,l=ch.length;j<l;j++){if(ch[j]&&och[j]&&!ch[j].equals(och[j],options)){return false}}return true};nodeproto.children=function(){return this.childnodes};nodeproto.show=function(options){if(this.element.filter(":visible").size()===0){this._toggleVisible(options)}var opts=$.extend({recursive:true},options);if(this._edgetoparent){this._edgetoparent.show()}if(opts.recursive){var ch=this.children();if(ch){for(var i=0,l=ch.length;i<l;i++){ch[i].show(options)}}}return this};nodeproto.hide=function(options){var opts=$.extend({recursive:true},options),ch,i,l;if(this.element.filter(":visible").size()>0){this._toggleVisible(options)}if(this._edgetoparent){this._edgetoparent.hide(options)}if(opts.recursive){ch=this.children();if(ch){for(i=0,l=ch.length;i<l;i++){ch[i].hide(options)}}}else{ch=this.children();if(ch){for(i=0,l=ch.length;i<l;i++){ch[i].edgeToParent().hide(options)}}}return this};var BinaryTree=function(jsav,options){var opts=$.extend({constructors:{Tree:BinaryTree,Node:BinaryTreeNode,Edge:Edge}},options);this.init(jsav,opts);this.element.addClass("jsavbinarytree")};JSAV.utils.extend(BinaryTree,Tree);var bintreeproto=BinaryTree.prototype;bintreeproto.state=function(newState){if(typeof newState!=="undefined"){var tree=this;var setNodeState=function(node,state){node.state(state);var setChild=function(childName){var child=node[childName]();if(!child&&!state[childName]){return}else if(child&&state[childName]){setNodeState(child,state[childName])}else if(child){node[childName](null,{record:false})}else{var newNode=tree.newNode("",node,{record:false});node[childName](newNode,{record:false});setNodeState(newNode,state[childName])}};setChild("left");setChild("right")};setNodeState(this.root(),newState)}else{var nodeState=function(node){if(!node){return null}var state=node.state();if(node.left()){state.left=nodeState(node.left())}if(node.right()){state.right=nodeState(node.right())}return state};return nodeState(this.root())}};var BinaryTreeNode=function(container,value,parent,options){this.init(container,value,parent,options);this.element.addClass("jsavbinarynode")};JSAV.utils.extend(BinaryTreeNode,TreeNode);var binnodeproto=BinaryTreeNode.prototype;function setchild(self,pos,node,options){var oPos=pos?0:1,other,newchildnodes,child=self.child(pos),oChild=self.child(oPos),opts=$.extend({hide:true},options);if(typeof node==="undefined"){if(child&&child.value()!=="jsavnull"){return child}else{return undefined}}else{var nullopts=$.extend({},opts);nullopts.edgeLabel=undefined;if(node===null){if(child&&child.value()!=="jsavnull"){child.parent(null,opts);if(!oChild||oChild.value()==="jsavnull"){if(opts.hide){child.hide()}if(oChild){oChild.hide()}self._setchildnodes([])}else{other=self.container.newNode("jsavnull",self,nullopts);other.element.addClass("jsavnullnode").attr("data-binchildrole",pos?"right":"left");if(opts.hide){child.hide()}newchildnodes=[];newchildnodes[pos]=other;newchildnodes[oPos]=oChild;self._setchildnodes(newchildnodes,opts)}}}else{if(!(node instanceof self.constructors.Node)){if(child&&(typeof node==="number"||typeof node==="string")){return child.value(node,opts)}else{node=self.container.newNode(node,self,opts)}}else{if(node.parent()&&node.parent()!==self){node.remove({hide:false})}node.parent(self)}node.element.attr("data-binchildrole",pos?"right":"left");newchildnodes=[];newchildnodes[pos]=node;if(child){if(opts.hide){child.hide()}}if(!oChild){other=self.container.newNode("jsavnull",self,nullopts);other.element.addClass("jsavnullnode").attr("data-binchildrole",oPos?"right":"left");newchildnodes[oPos]=other}else{newchildnodes[oPos]=oChild}self._setchildnodes(newchildnodes,opts);return node}}return child}binnodeproto.addChild=function(node,options){var pos=-1;if(!this.left()){pos=0}else if(!this.right()){pos=1}else{console.error("Binarytree node already has two children, cannot add more");return}return this.child(pos,node,options)};binnodeproto.left=function(node,options){return setchild(this,0,node,options)};binnodeproto.right=function(node,options){return setchild(this,1,node,options)};binnodeproto.child=function(pos,node,options){if(typeof node==="undefined"){return this.childnodes[pos]}else{if(typeof node==="string"||typeof node==="number"){node=this.container.newNode(node,this,options)}return setchild(this,pos,node,options)}};binnodeproto.remove=function(options){if(this===this.container.rootnode){this.container.root(this.container.newNode("",null),options);return this}var parent=this.parent();if(parent.left()===this){return setchild(parent,0,null,options)}else if(parent.right()===this){return setchild(parent,1,null,options)}};binnodeproto.edgeToLeft=function(){return this.edgeToChild(0)};binnodeproto.edgeToRight=function(){return this.edgeToChild(1)};binnodeproto._setvalue=JSAV.anim(function(newValue){var oldVal=this.value(),valtype=typeof newValue;if(typeof oldVal==="undefined"){oldVal=""}if(valtype==="object"){valtype="string"}this.element.removeClass("jsavnullnode").find(".jsavvalue").html(this._valstring(newValue)).end().attr({"data-value":newValue,"data-value-type":valtype});if(newValue==="jsavnull"){this.element.addClass("jsavnullnode")}return[oldVal]});var dstypes=JSAV._types.ds;dstypes.Tree=Tree;dstypes.TreeNode=TreeNode;dstypes.BinaryTree=BinaryTree;dstypes.BinaryTreeNode=BinaryTreeNode;JSAV.ext.ds.tree=function(options){return new Tree(this,$.extend(true,{visible:true,autoresize:true},options))};JSAV.ext.ds.binarytree=function(options){return new BinaryTree(this,$.extend(true,{visible:true,autoresize:true},options))};JSAV.ext.ds.edge=function(options){return new Edge(this,$.extend(true,{},options))}})(jQuery);(function($){"use strict";function treeLayout(tree,options){var opts=$.extend({},tree.options,options),NODEGAP=opts.nodegap||40,results={};var compactArray=function(arr){return $.map(arr,function(item){return item||null})};var calculateLayout=function(node){var ch=compactArray(node.children());for(var i=0,l=ch.length;i<l;i++){if(ch[i]){calculateLayout(ch[i])}}results[node.id()]={cachedTranslation:{width:0,height:0},translation:{width:0,height:0},node:node};calculateContours(node)},calculateContours=function(node){var children=compactArray(node.children()),resnode=results[node.id()];var nodeWidth=node.element.outerWidth()/2,nodeHeight=node.element.outerHeight();if(children.length===0){resnode.contours=new TreeContours((-nodeWidth),nodeWidth+(nodeWidth%2===0?0:1),nodeHeight,node.value());translateThisNode(node,-nodeWidth,0)}else{var transSum=0;var firstChild=children[0];resnode.contours=results[firstChild.id()].contours;results[firstChild.id()].contours=null;translateNodes(firstChild,0,NODEGAP+nodeHeight);for(var i=1,l=children.length;i<l;i++){var child=children[i];if(!child){continue}var childC=results[child.id()].contours;var trans=resnode.contours.calcTranslation(childC,NODEGAP);transSum+=trans;results[child.id()].contours=null;resnode.contours.joinWith(childC,trans);translateNodes(child,getXTranslation(firstChild)+trans-getXTranslation(child),NODEGAP+nodeHeight)}var rootTrans=transSum/children.length;resnode.contours.addOnTop(-nodeWidth,nodeWidth+(nodeWidth%2===0?0:1),nodeHeight,NODEGAP,rootTrans);translateThisNode(node,getXTranslation(firstChild)+rootTrans,0)}},translateThisNode=function(node,x,y){var restrans=results[node.id()].translation;restrans.width+=x;restrans.height+=y},translateNodes=function(node,x,y){if(!node){return}var restrans=results[node.id()].cachedTranslation;if(!restrans){restrans={width:0,height:0};results[node.id()].cachedTranslation=restrans}restrans.width+=x;restrans.height+=y},getXTranslation=function(node){var restrans=results[node.id()].cachedTranslation;return results[node.id()].translation.width+(!restrans?0:restrans.width)},propagateTranslations=function(node){if(!node){return}var noderes=results[node.id()];if(noderes.cachedTranslation){var ch=compactArray(node.children());for(var i=0,l=ch.length;i<l;i++){var child=ch[i];translateNodes(child,noderes.cachedTranslation.width,noderes.cachedTranslation.height);propagateTranslations(child)}noderes.translation.width+=noderes.cachedTranslation.width;noderes.translation.height+=noderes.cachedTranslation.height;noderes.cachedTranslation=null}},root=tree.root();calculateLayout(root);translateNodes(root,20,10+NODEGAP);propagateTranslations(root);var maxX=-Number.MAX_VALUE,maxY=-Number.MAX_VALUE,minX=Number.MAX_VALUE,minY=Number.MAX_VALUE,max=Math.max,min=Math.min;$.each(results,function(key,value){maxX=max(maxX,value.translation.width+value.node.element.outerWidth());maxY=max(maxY,value.translation.height+value.node.element.outerHeight());minX=min(minX,value.translation.width);minY=min(minY,value.translation.height)});if(!opts.boundsOnly){$.each(results,function(key,value){var oldPos=value.node.element.position();if(!value.node._layoutDone&&oldPos.left===0&&oldPos.top===0){value.node.element.css({left:value.translation.width-minX+"px",top:value.translation.height-minY+"px"});value.node._layoutDone=true}else{value.node.moveTo(value.translation.width-minX,value.translation.height-minY)}})}var centerTree=function(tree,width){if(opts.hasOwnProperty("center")&&!opts.center){return 0}var containerWidth=$(tree.jsav.canvas).width(),treeLeft=parseInt(tree.element.css("left"),10)||0;return Math.max(0,(containerWidth-width)/2)-treeLeft};var treeDims={width:maxX-minX,height:maxY-minY},left=centerTree(tree,maxX-minX);if(!opts.boundsOnly){if(!tree._layoutDone){tree._layoutDone=true;tree.element.css(treeDims);if(left){tree.element.css("left",left)}}else{tree.css(treeDims,opts);if(left){tree.translateX(left)}}$.each(results,function(key,value){var node=value.node;if(node._edgetoparent){var start={left:value.translation.width-minX,top:value.translation.height-minY},endnode=results[node.parent().id()].translation,end={left:endnode.width-minX,top:endnode.height-minY};node._edgetoparent.layout($.extend({start:start,end:end},opts))}})}return $.extend({top:tree.position().top},treeDims)}var layouts=JSAV.ext.ds.layout;layouts.tree={_default:treeLayout};var TreeContours=function(left,right,height,data){this.cHeight=height;this.leftCDims=[];this.leftCDims[this.leftCDims.length]={width:-left,height:height};this.cLeftExtent=left;this.rightCDims=[];this.rightCDims[this.rightCDims.length]={width:-right,height:height};this.cRightExtent=right};TreeContours.prototype={addOnTop:function(left,right,height,addHeight,originTrans){var lCD=this.leftCDims,rCD=this.rightCDims;lCD[lCD.length-1].height+=addHeight;lCD[lCD.length-1].width+=originTrans+left;rCD[rCD.length-1].height+=addHeight;rCD[rCD.length-1].width+=originTrans+right;lCD.push({width:-left,height:height});rCD.push({width:-right,height:height});this.cHeight+=height+addHeight;this.cLeftExtent-=originTrans;this.cRightExtent-=originTrans;if(left<this.cLeftExtent){this.cLeftExtent=left}if(right>this.cRightExtent){this.cRightExtent=right}},joinWith:function(other,hDist){var thisCDisp,otherCDisp,middle;if(other.cHeight>this.cHeight){var newLeftC=[];var otherLeft=other.cHeight-this.cHeight;thisCDisp=0;otherCDisp=0;$.each(other.leftCDims,function(index,item){if(otherLeft>0){var dim={width:item.width,height:item.height};otherLeft-=item.height;if(otherLeft<0){dim.height+=otherLeft}newLeftC[newLeftC.length]=dim}else{otherCDisp+=item.width}});middle=newLeftC[newLeftC.length-1];$.each(this.leftCDims,function(index,item){thisCDisp+=item.width;newLeftC[newLeftC.length]={width:item.width,height:item.height}});middle.width-=thisCDisp-otherCDisp;middle.width-=hDist;this.leftCDims=newLeftC}if(other.cHeight>=this.cHeight){this.rightCDims=other.rightCDims.slice()}else{var thisLeft=this.cHeight-other.cHeight;var nextIndex=0;thisCDisp=0;otherCDisp=0;$.each(this.rightCDims,function(index,item){if(thisLeft>0){nextIndex++;thisLeft-=item.height;if(thisLeft<0){item.height+=thisLeft}}else{thisCDisp+=item.width}});for(var i=nextIndex+1,l=this.rightCDims.length;i<l;i++){this.rightCDims[i]=null}this.rightCDims=$.map(this.rightCDims,function(item){return item});middle=this.rightCDims[nextIndex];for(i=0,l=other.rightCDims.length;i<l;i++){var item=other.rightCDims[i];otherCDisp+=item.width;this.rightCDims[this.rightCDims.length]={width:item.width,height:item.height}}middle.width+=thisCDisp-otherCDisp;middle.width+=hDist}this.rightCDims[this.rightCDims.length-1].width-=hDist;if(other.cHeight>this.cHeight){this.cHeight=other.cHeight}if(other.cLeftExtent+hDist<this.cLeftExtent){this.cLeftExtent=other.cLeftExtent+hDist}if(other.cRightExtent+hDist>this.cRightExtent){this.cRightExtent=other.cRightExtent+hDist}},calcTranslation:function(other,wantedDist){var lc=this.rightCDims,rc=other.leftCDims,li=lc.length-1,ri=rc.length-1,lCumD={width:0,height:0},rCumD={width:0,height:0},displacement=wantedDist,ld,rd;while(true){if(li<0){if(ri<0||rCumD.height>=lCumD.height){break}rd=rc[ri];rCumD.height+=rd.height;rCumD.width+=rd.width;ri--}else if(ri<0){if(lCumD.height>=rCumD.height){break}ld=lc[li];lCumD.height+=ld.height;lCumD.width+=ld.width;li--}else{ld=lc[li];rd=rc[ri];var leftNewHeight=lCumD.height,rightNewHeight=rCumD.height;if(leftNewHeight<=rightNewHeight){lCumD.height+=ld.height;lCumD.width+=ld.width;li--}if(rightNewHeight<=leftNewHeight){rCumD.height+=rd.height;rCumD.width+=rd.width;ri--}}if(displacement<rCumD.width-lCumD.width+wantedDist){displacement=rCumD.width-lCumD.width+wantedDist}}return displacement}}})(jQuery);(function($){"use strict";if(typeof JSAV==="undefined"){return}var Edge=JSAV._types.ds.Edge;var List=function(jsav,options){this.jsav=jsav;this.options=$.extend({visible:true,nodegap:40,autoresize:true},options);var el=this.options.element||$("<div/>");el.addClass("jsavlist");for(var key in this.options){var val=this.options[key];if(this.options.hasOwnProperty(key)&&typeof val==="string"||typeof val==="number"||typeof val==="boolean"){el.attr("data-"+key,val)}}if(!this.options.element){$(jsav.canvas).append(el)}this.element=el;this.element.attr({id:this.id()});if(this.options.autoresize){el.addClass("jsavautoresize")}JSAV.utils._helpers.handlePosition(this);JSAV.utils._helpers.handleVisibility(this,this.options)};JSAV.utils.extend(List,JSAV._types.ds.JSAVDataStructure);var listproto=List.prototype;listproto.first=function(newFirst,options){if(typeof newFirst==="undefined"){return this._first}else{return this.addFirst(newFirst,options)}};listproto._setfirst=JSAV.anim(function(newFirst){var oldFirst=this._first;this._first=newFirst;return[oldFirst]});listproto.add=function(index,newValue,options){if(index<0||index>this.size()){return this}if(index===0){return this.addFirst(newValue,options)}var node=this.get(index-1),newNode;if(newValue instanceof ListNode){newNode=newValue}else{newNode=this.newNode(newValue)}if(node){newNode.next(node.next(),options);node.next(newNode,options)}return this};listproto.addFirst=function(newValue,options){if(newValue instanceof ListNode){newValue.next(this._first,options);this._setfirst(newValue,options)}else{this._setfirst(this.newNode(newValue,$.extend({},options,{first:true,next:this._first})),options)}return this};listproto.last=function(newLast,options){if(typeof newLast==="undefined"){var curNode=this.first();while(curNode&&curNode.next()){curNode=curNode.next()}return curNode}else{this.addLast(newLast,options)}};listproto.addLast=function(newValue,options){var last=this.last(),newNode;if(typeof last==="undefined"){this.first(newValue);return this}if(newValue instanceof ListNode){newNode=newValue}else{newNode=this.newNode(newValue)}last.next(newNode,options);return this};listproto.get=function(index){if(typeof index!=="number"||index<0){return}var curNode=this.first(),pos=0;while(curNode.next()&&pos<index){curNode=curNode.next();pos++}if(pos===index){return curNode}else{return undefined}};listproto.newNode=function(value,options){return new ListNode(this,value,$.extend({first:false},this.options,options))};listproto.remove=function(index,options){var opts=$.extend({hide:true},options);if(index===0){return this.removeFirst(options)}else if(index===this.size()-1){return this.removeLast(options)}var prev=this.get(index-1),next=this.get(index+1),oldNode=prev.next();prev.next(next,options);if(opts.hide){oldNode.hide();oldNode.edgeToNext().hide()}return oldNode};listproto.removeFirst=function(options){if(this.size()<=0){return}var opts=$.extend({hide:true},options),oldFirst=this.first();this._setfirst(oldFirst.next(),options);if(opts.hide){oldFirst.hide();if(oldFirst.edgeToNext()){oldFirst.edgeToNext().hide()}}return oldFirst};listproto.removeLast=function(options){if(this.size()<=1){return this.removeFirst()}var opts=$.extend({hide:true},options),newLast=this.get(this.size()-2),oldLast=this.last();newLast.next(null,options);if(opts.hide){oldLast.hide();newLast.edgeToNext().hide()}return oldLast};listproto.layout=function(options){var layoutAlg=$.extend({},this.options,options).layout||"_default";return this.jsav.ds.layout.list[layoutAlg](this,options)};listproto.state=function(newState){if(typeof newState!=="undefined"){if(newState.n.length===0){while(this.first()){this.removeFirst({record:false})}return}var currNode=this.first(),i=0,newCurrState=newState.n[i];while(newCurrState&&currNode){currNode.state(newCurrState);currNode=currNode.next();newCurrState=++i<newState.n.length?newState.n[i]:null}if(!currNode){currNode=this.last();for(;i<newState.n.length;i++){var newNode=this.newNode("",{record:false});if(!currNode){this.first(newNode);currNode=this.first()}newNode.state(newState.n[i]);currNode.next(newNode,{record:false});currNode=newNode}}else{while(currNode!==this.last()){this.removeLast({record:false})}}currNode=this.first();var edge=currNode.edgeToNext(),edges=newState.e;for(i=0;i<edges.length;i++){this.get(i).edgeToNext().state(edges[i])}}else{var state={},node=this.first(),edge,nodes=[],edges=[];while(node){nodes.push(node.state());edge=node.edgeToNext();if(edge){edges.push(edge.state())}node=node.next()}state.n=nodes;state.e=edges;return state}};listproto.clear=function(){this.element.remove()};listproto.size=function(){var curNode=this.first(),size=0;while(curNode){size++;curNode=curNode.next()}return size};listproto.equals=function(otherList,options){if(!this.first()&&!otherList.first()){return true}else if(!this.first()){return false}else{return this.first().equals(otherList.first(),options)}};listproto.css=JSAV.utils._helpers.css;listproto._setcss=JSAV.anim(JSAV.utils._helpers._setcss);JSAV.utils._events._addEventSupport(listproto);var ListNode=function(container,value,options){this.jsav=container.jsav;this.container=container;this._next=options.next;this._value=value;this.options=$.extend(true,{visible:true},options);var el=$("<div><span class='jsavvalue'>"+this._valstring(value)+"</span><span class='jsavpointerarea'></span></div>"),valtype=typeof value;if(valtype==="object"){valtype="string"}this.element=el;el.addClass("jsavnode jsavlistnode"+(this._next?"":" jsavnonext")).attr({"data-value":value,id:this.id(),"data-value-type":valtype}).data("node",this);if("first"in options&&options.first){this.container.element.prepend(el)}else{this.container.element.append(el)}if(this._next){this._edgetonext=new Edge(this.jsav,this,this._next,{"arrow-end":"classic-wide-long"});if(this.options.edgeLabel){this._edgetonext.label(this.options.edgeLabel)}}JSAV.utils._helpers.handleVisibility(this,this.options)};JSAV.utils.extend(ListNode,JSAV._types.ds.Node);var listnodeproto=ListNode.prototype;listnodeproto.next=function(newNext,options){if(typeof newNext==="undefined"){return this._next}else{if(this._edgetonext){this._edgetonext.show()}return this._setnext(newNext,options)}};listnodeproto._setnext=JSAV.anim(function(newNext,options){var oldNext=this._next;this._next=newNext;if(newNext&&this._edgetonext){this._edgetonext.end(newNext)}else if(newNext){this._edgetonext=new Edge(this.jsav,this,this._next,{"arrow-end":"classic-wide-long"})}if(options&&options.edgeLabel){this._edgetonext.label(options.edgeLabel)}if(!oldNext&&newNext){this.element.removeClass("jsavnonext")}else if(oldNext&&!newNext){this.element.addClass("jsavnonext")}return[oldNext]});listnodeproto.edgeToNext=function(){return this._edgetonext};listnodeproto.equals=function(otherNode,options){if(!otherNode||this.value()!==otherNode.value()){return false}if(options&&"css"in options){var cssEquals=JSAV.utils._helpers.cssEquals(this,otherNode,options.css);if(!cssEquals){return false}}if(options&&"class"in options){var classEquals=JSAV.utils._helpers.classEquals(this,otherNode,options["class"]);if(!classEquals){return false}}if(this.next()&&this.edgeToNext()){var edgeEquals=this.edgeToNext().equals(otherNode.edgeToNext(),$.extend({},options,{dontCheckNodes:true}));if(!edgeEquals){return false}}if(this.next()){return this.next().equals(otherNode.next(),options)}else if(otherNode.next()){return false}else{return true}};var dstypes=JSAV._types.ds;dstypes.List=List;dstypes.ListNode=ListNode;function centerList(list,width,options){if(list.options.hasOwnProperty("center")&&!list.options.center){return 0}var containerWidth=$(list.jsav.canvas).width();return(containerWidth-width)/2-list.position().left}var horizontalNodePosUpdate=function(node,prevNode,prevPos,opts){var nodePos=node.element.position(),newPos={left:nodePos.left,top:nodePos.top},result={node:node,nodePos:newPos};if(opts.updateLeft){newPos.left=prevNode?prevPos.left+prevNode.element.outerWidth()+opts.nodegap:0}if(opts.updateTop){newPos.top=0}var edge=prevNode?prevNode._edgetonext:undefined;if(edge&&opts.updateEdges){result.edge=edge;result.edgeFromPoint=[prevPos.left+prevNode.element.outerWidth()-5,prevPos.top+Math.round(prevNode.element.outerHeight()/2)]}return result};var verticalNodePosUpdate=function(node,prevNode,prevPos,opts){var nodePos=node.element.position(),newPos={left:nodePos.left,top:nodePos.top},result={node:node,nodePos:newPos};if(opts.updateLeft){newPos.left=0}if(opts.updateTop){newPos.top=prevNode?prevPos.top+prevNode.element.outerHeight()+opts.nodegap:0}var edge=prevNode?prevNode._edgetonext:undefined;if(edge&&opts.updateEdges){result.edge=edge;result.edgeFromPoint=[prevPos.left+Math.round(prevNode.element.outerWidth()/2),prevPos.top+prevNode.element.outerHeight()-5]}return result};var listLayout=function(list,options,updateFunc){var curNode=list.first(),prevNode,opts=$.extend({updateLeft:true,updateTop:true,updateEdges:true},list.options,options),curPos,prevPos={},minLeft=Number.MAX_VALUE,minTop=Number.MAX_VALUE,maxLeft=Number.MIN_VALUE,maxTop=Number.MIN_VALUE,width,height,left,posData=[],curPosData;while(curNode){curPosData=updateFunc(curNode,prevNode,prevPos,opts);curPos=curPosData.nodePos;minLeft=typeof curPos.left!=="undefined"?Math.min(curPos.left,minLeft):minLeft;minTop=typeof curPos.top!=="undefined"?Math.min(curPos.top,minTop):minTop;maxLeft=typeof curPos.left!=="undefined"?Math.max(curPos.left+curNode.element.outerWidth(),maxLeft):maxLeft;maxTop=typeof curPos.top!=="undefined"?Math.max(curPos.top+curNode.element.outerHeight(),maxTop):maxTop;posData.unshift(curPosData);prevNode=curNode;prevPos=curPos;curNode=curNode.next()}if(list.size()){width=maxLeft-minLeft;height=maxTop-minTop}else{var tmpNode=list.newNode("");width=tmpNode.element.outerWidth();height=tmpNode.element.outerHeight();tmpNode.clear()}left=centerList(list,width,opts);if(!opts.boundsOnly){list.css({width:width,height:height});if(left){list.translateX(left)}for(var i=posData.length-1;i>=0;i--){var posItem=posData[i];posItem.node.moveTo(posItem.nodePos.left,posItem.nodePos.top);if(posItem.edge){posItem.edge.layout({fromPoint:posItem.edgeFromPoint,end:posItem.nodePos})}}}return{width:width,height:height,left:left,top:list.element.position().top}};var verticalList=function(list,options){list.element.addClass("jsavverticallist");return listLayout(list,options,verticalNodePosUpdate)};var horizontalList=function(list,options){list.element.addClass("jsavhorizontallist");return listLayout(list,options,horizontalNodePosUpdate)};JSAV.ext.ds.layout.list={_default:horizontalList,horizontal:horizontalList,vertical:verticalList};JSAV.ext.ds.list=function(options){return new List(this,options)}})(jQuery);(function($){"use strict";if(typeof JSAV==="undefined"){return}var Edge=JSAV._types.ds.Edge;var Graph=function(jsav,options){this._nodes=[];this._edges=[];this._alledges=null;this.jsav=jsav;this.options=$.extend({visible:true,nodegap:40,autoresize:true,width:400,height:200,directed:false,center:true},options);var el=this.options.element||$("<div/>");el.addClass("jsavgraph");for(var key in this.options){var val=this.options[key];if(this.options.hasOwnProperty(key)&&typeof val==="string"||typeof val==="number"||typeof val==="boolean"){el.attr("data-"+key,val)}}if(!this.options.element){$(jsav.canvas).append(el)}this.element=el;el.attr({id:this.id()}).width(this.options.width).height(this.options.height);if(this.options.autoresize){el.addClass("jsavautoresize")}if(this.options.center){el.addClass("jsavcenter")}JSAV.utils._helpers.handlePosition(this);JSAV.utils._helpers.handleVisibility(this,this.options)};Graph._nodeSortFunction=function(a,b){return a.value()-b.value()};JSAV.utils.extend(Graph,JSAV._types.ds.JSAVDataStructure);var graphproto=Graph.prototype;graphproto.css=JSAV.utils._helpers.css;graphproto._setcss=JSAV.anim(JSAV.utils._helpers._setcss);graphproto._setnodes=JSAV.anim(function(newnodes,options){var oldnodes=this._nodes;this._nodes=newnodes;return[oldnodes,options]});graphproto._setadjs=JSAV.anim(function(newadjs,options){var oldadjs=this._edges;this._edges=newadjs;this._alledges=null;return[oldadjs,options]});graphproto._setadjlist=JSAV.anim(function(newadj,index,options){var oldadj=this._edges[index];this._edges[index]=newadj;this._alledges=null;return[oldadj,index,options]});graphproto.newNode=function(value,options){var newNode=new GraphNode(this,value,options),newNodes=this._nodes.slice(0);newNodes.push(newNode);this._setnodes(newNodes,options);var newAdjs=this._edges.slice(0);newAdjs.push([]);this._setadjs(newAdjs,options);return newNode};graphproto.addNode=function(value,options){return this.newNode(value,options)};graphproto.removeNode=function(node,options){var nodeIndex=this._nodes.indexOf(node);if(nodeIndex===-1){return}var allEdges=this.edges();for(var i=allEdges.length;i--;){var edge=allEdges[i];if(edge.start().id()===node.id()||edge.end().id()===node.id()){this.removeEdge(edge,options)}}var firstAdjs=this._edges.slice(0,nodeIndex),newAdjs=firstAdjs.concat(this._edges.slice(nodeIndex+1));this._setadjs(newAdjs,options);var firstNodes=this._nodes.slice(0,nodeIndex),newNodes=firstNodes.concat(this._nodes.slice(nodeIndex+1));this._setnodes(newNodes,options);node.hide(options);return this};graphproto.addEdge=function(fromNode,toNode,options){if(this.hasEdge(fromNode,toNode)){return}var opts=$.extend({},this.options,options);if(opts.directed&&!opts["arrow-end"]){opts["arrow-end"]="classic-wide-long"}var fromIndex=this._nodes.indexOf(fromNode),toIndex=this._nodes.indexOf(toNode);if(fromIndex===-1||toIndex===-1){return}var edge=new Edge(this.jsav,fromNode,toNode,opts),adjlist=this._edges[fromIndex].slice(0);adjlist.push(edge);this._setadjlist(adjlist,fromIndex,opts);return edge};graphproto.removeEdge=function(fNode,tNode,options){var edge,fromNode,toNode,opts;if(fNode.constructor===JSAV._types.ds.Edge){edge=fNode;fromNode=edge.start();toNode=edge.end();opts=tNode}else{fromNode=fNode;toNode=tNode;edge=this.getEdge(fromNode,toNode);opts=options}if(!edge){return}var fromIndex=this._nodes.indexOf(fromNode),toIndex=this._nodes.indexOf(toNode),adjlist=this._edges[fromIndex],edgeIndex=adjlist.indexOf(edge),newAdjlist=adjlist.slice(0,edgeIndex).concat(adjlist.slice(edgeIndex+1));this._setadjlist(newAdjlist,fromIndex,options);edge.hide()};graphproto.hasEdge=function(fromNode,toNode){return this.getEdge(fromNode,toNode)};graphproto.getEdge=function(fromNode,toNode){var edges=this.edges();for(var i=0,l=edges.length;i<l;i++){var edge=edges[i];if(edge.start()===fromNode&&edge.end()===toNode){
return edge}else if(!this.options.directed&&edge.end()===fromNode&&edge.start()===toNode){return edge}}return undefined};graphproto.nodes=function(){return JSAV.utils.iterable(this._nodes)};graphproto.nodeCount=function(){return this._nodes.length};var collectAllEdges=function(graph){var alledges=[];for(var i=0,l=graph._edges.length;i<l;i++){for(var j=0,ll=graph._edges[i].length;j<ll;j++){var edge=graph._edges[i][j];if(alledges.indexOf(edge)===-1){alledges.push(edge)}}}return alledges};graphproto.edges=function(){if(!this._alledges){this._alledges=collectAllEdges(this)}return JSAV.utils.iterable(this._alledges)};graphproto.edgeCount=function(){if(!this._alledges){this._alledges=collectAllEdges(this)}return this._alledges.length};graphproto.equals=function(other,options){if(!other instanceof Graph){return false}if(this.nodeCount()!==other.nodeCount()||this.edgeCount()!==other.edgeCount()){return false}var myNodes=this.nodes().sort(Graph._nodeSortFunction),otherNodes=other.nodes().sort(Graph._nodeSortFunction);for(var i=myNodes.length;i--;){if(!myNodes[i].equals(otherNodes[i],options)){return false}}return true};graphproto.clone=function(opts){var cloneOpts=$.extend(this.options,{visible:false},opts);if("element"in cloneOpts){delete cloneOpts.element}var cloneGraph=this.jsav.ds.graph(cloneOpts),nodes=this.nodes(Graph._nodeSortFunction),cloneNode,cloneNodes,edges=this.edges(),n,e,i,fromInd,toInd,edgeOpts;for(i=0;i<nodes.length;i++){n=nodes[i];cloneNode=cloneGraph.addNode(n.value(),cloneOpts);cloneNode.element.attr("style",n.element.attr("style"));cloneNode.element.attr("class",n.element.attr("class"))}cloneNodes=cloneGraph.nodes(Graph._nodeSortFunction);for(i=0;i<edges.length;i++){e=edges[i];fromInd=nodes.indexOf(e.start());toInd=nodes.indexOf(e.end());if(typeof e.weight()!=="undefined"){edgeOpts={weight:e.weight()}}else{edgeOpts={}}cloneGraph.addEdge(cloneNodes[fromInd],cloneNodes[toInd],$.extend({},cloneOpts,edgeOpts))}return cloneGraph};graphproto.state=function(newState){if(typeof newState!=="undefined"){var edges=this.edges(),nodes=this.nodes(Graph._nodeSortFunction),newNodes=newState.n,newEdges=newState.e,i,l,e,newE;for(i=0,l=edges.length;i<l;i++){e=edges[i];this.removeEdge(e.start(),e.end(),{record:false})}for(i=0;i<nodes.length&&i<newNodes.length;i++){nodes[i].state(newNodes[i])}while(i<nodes.length){this.removeNode(nodes[nodes.length-1]);i++}while(i<newNodes.length){var newNode=this.newNode("",{record:false});newNode.state(newNodes[nodes.length]);nodes.push(newNode);i++}for(i=0,l=newEdges.length;i<l;i++){e=newEdges[i];newE=this.addEdge(nodes[e[0]],nodes[e[1]],{record:false});newE.state(e[2])}}else{var state={},nodes=[],edges=[],nodelist=this.nodes(Graph._nodeSortFunction),edgelist=this.edges(),i,e;for(i=0;i<nodelist.length;i++){nodes.push(nodelist[i].state())}for(i=0;i<edgelist.length;i++){e=edgelist[i];edges.push([nodelist.indexOf(e.start()),nodelist.indexOf(e.end()),e.state()])}state.n=nodes;state.e=edges;return state}};JSAV.utils._events._addEventSupport(graphproto);graphproto.layout=function(options){var layoutAlg=this.options.layout||"_default";return this.jsav.ds.layout.graph[layoutAlg](this,options)};var SpringLayout=function(graph,options){this.graph=graph;this.iterations=2e3;this.maxRepulsiveForceDistance=6;this.k=2;this.c=.01;this.maxVertexMovement=.5;this.results={};this.nodes=graph.nodes();this.edges=graph.edges();this.layout();var factorX=(graph.element.width()-this.maxNodeWidth)/(this.layoutMaxX-this.layoutMinX),factorY=(graph.element.height()-this.maxNodeHeight)/(this.layoutMaxY-this.layoutMinY),node,edge,res;for(var i=0,l=this.nodes.length;i<l;i++){node=this.nodes[i];res=this.results[node.id()];node.moveTo((res.layoutPosX-this.layoutMinX)*factorX,Math.max(0,(res.layoutPosY-this.layoutMinY)*factorY-node.element.outerHeight()))}for(i=0,l=this.edges.length;i<l;i++){edge=this.edges[i];edge.layout(options)}};SpringLayout.prototype={layout:function(){this.layoutPrepare();for(var i=0;i<this.iterations;i++){this.layoutIteration()}this.layoutCalcBounds()},layoutPrepare:function(){for(var i=0,l=this.nodes.length;i<l;i++){var node={};node.layoutPosX=0;node.layoutPosY=0;node.layoutForceX=0;node.layoutForceY=0;this.results[this.nodes[i].id()]=node}},layoutCalcBounds:function(){var minx=Infinity,maxx=-Infinity,miny=Infinity,maxy=-Infinity,nodes=this.nodes,maxNodeWidth=-Infinity,maxNodeHeight=-Infinity,i,x,y,l,n;for(i=0,l=nodes.length;i<l;i++){n=nodes[i];x=this.results[n.id()].layoutPosX;y=this.results[n.id()].layoutPosY;if(x>maxx){maxx=x}if(x<minx){minx=x}if(y>maxy){maxy=y}if(y<miny){miny=y}maxNodeWidth=Math.max(maxNodeWidth,n.element.outerWidth());maxNodeHeight=Math.max(maxNodeHeight,n.element.outerHeight())}this.layoutMinX=minx;this.layoutMaxX=maxx;this.layoutMinY=miny;this.layoutMaxY=maxy;this.maxNodeWidth=maxNodeWidth;this.maxNodeHeight=maxNodeHeight},layoutIteration:function(){var prev=[],nodes,edges,i,l,j,k;nodes=this.nodes;for(i=0,l=nodes.length;i<l;i++){var node1=nodes[i];for(j=0,k=prev.length;j<k;j++){var node2=nodes[prev[j]];this.layoutRepulsive(node1,node2)}prev.push(i)}edges=this.edges;for(i=0,l=edges.length;i<l;i++){var edge=edges[i];this.layoutAttractive(edge)}nodes=this.nodes;for(i=0,l=nodes.length;i<l;i++){var node=this.results[nodes[i].id()];var xmove=this.c*node.layoutForceX;var ymove=this.c*node.layoutForceY;var max=this.maxVertexMovement;if(xmove>max){xmove=max}if(xmove<-max){xmove=-max}if(ymove>max){ymove=max}if(ymove<-max){ymove=-max}node.layoutPosX+=xmove;node.layoutPosY+=ymove;node.layoutForceX=0;node.layoutForceY=0}},layoutRepulsive:function(node1,node2){if(typeof node1==="undefined"||typeof node2==="undefined"){return}var lay1=this.results[node1.id()],lay2=this.results[node2.id()];var dx=lay2.layoutPosX-lay1.layoutPosX;var dy=lay2.layoutPosY-lay1.layoutPosY;var d2=dx*dx+dy*dy;if(d2<.01){dx=.1*Math.random()+.1;dy=.1*Math.random()+.1;d2=dx*dx+dy*dy}var d=Math.sqrt(d2);if(d<this.maxRepulsiveForceDistance){var repulsiveForce=this.k*this.k/d;lay2.layoutForceX+=repulsiveForce*dx/d;lay2.layoutForceY+=repulsiveForce*dy/d;lay1.layoutForceX-=repulsiveForce*dx/d;lay1.layoutForceY-=repulsiveForce*dy/d}},layoutAttractive:function(edge){var node1=edge.start();var node2=edge.end();var lay1=this.results[node1.id()],lay2=this.results[node2.id()];var dx=lay2.layoutPosX-lay1.layoutPosX;var dy=lay2.layoutPosY-lay1.layoutPosY;var d2=dx*dx+dy*dy;if(d2<.01){dx=.1*Math.random()+.1;dy=.1*Math.random()+.1;d2=dx*dx+dy*dy}var d=Math.sqrt(d2);if(d>this.maxRepulsiveForceDistance){d=this.maxRepulsiveForceDistance;d2=d*d}var attractiveForce=(d2-this.k*this.k)/this.k;if(edge.attraction===undefined){edge.attraction=1}attractiveForce*=Math.log(edge.attraction)*.5+1;lay2.layoutForceX-=attractiveForce*dx/d;lay2.layoutForceY-=attractiveForce*dy/d;lay1.layoutForceX+=attractiveForce*dx/d;lay1.layoutForceY+=attractiveForce*dy/d}};var springLayout=function springLayout(graph,options){var layout=new SpringLayout(graph)};var manualLayout=function manualLayout(graph,options){var i,l,edge,edges=graph.edges();for(i=0,l=edges.length;i<l;i++){edge=edges[i];edge.layout()}};JSAV.ext.ds.layout.graph={_default:manualLayout,automatic:springLayout,manual:manualLayout};var dagreLayout=function(graph,options){if(!("dagre"in window)){console.error("You are trying to use the layered layout, please load dagre.js "+"(https://github.com/cpettitt/dagre)!");return}var opts=$.extend({},graph.options,options);var g=new dagre.Digraph;var nodes=graph.nodes();var nmap={};while(nodes.hasNext()){var node=nodes.next();nmap[node.id()]=node;g.addNode(node.id(),{width:node.bounds().width,height:node.bounds().height})}var edges=graph.edges();while(edges.hasNext()){var edge=edges.next();g.addEdge(null,edge.start().id(),edge.end().id())}var layout=dagre.layout().run(g);var maxX=-1,maxY=-1;layout.eachNode(function(u,value){if(!opts.boundsOnly){nmap[u].moveTo(value.x-value.width/2,value.y-value.height/2)}maxX=Math.max(value.x+value.width,maxX);maxY=Math.max(value.y+value.height,maxY)});var graphDims={width:maxX+5,height:maxY+5};if(!opts.boundsOnly){graph.css(graphDims);edges=graph.edges();while(edges.hasNext()){edge=edges.next();edge.layout()}}return $.extend({top:graph.position().top},graphDims)};JSAV.ext.ds.layout.graph.layered=dagreLayout;var GraphNode=function(container,value,options){this.jsav=container.jsav;this.container=container;this.options=$.extend(true,{visible:true,left:0,top:0},options);var el=this.options.nodeelement||$("<div><span class='jsavvalue'>"+this._valstring(value)+"</span></div>"),valtype=typeof value;if(valtype==="object"){valtype="string"}this.element=el;el.addClass("jsavnode jsavgraphnode").attr({"data-value":value,id:this.id(),"data-value-type":valtype}).data("node",this);if(this.options.autoResize){el.addClass("jsavautoresize")}this.container.element.append(el);JSAV.utils._helpers.handlePosition(this);JSAV.utils._helpers.handleVisibility(this,this.options)};JSAV.utils.extend(GraphNode,JSAV._types.ds.Node);var nodeproto=GraphNode.prototype;nodeproto.css=JSAV.utils._helpers.css;nodeproto._setcss=JSAV.anim(JSAV.utils._helpers._setcss);nodeproto.neighbors=function(){var edges,neighbors=[],edge,i,l;if(this.container.options.directed){edges=this.container._edges[this.container._nodes.indexOf(this)];for(i=0,l=edges.length;i<l;i++){neighbors.push(edges[i].end())}}else{edges=this.container.edges();for(i=0,l=edges.length;i<l;i++){edge=edges[i];if(edge.start()===this){neighbors.push(edge.end())}else if(edge.end()===this){neighbors.push(edge.start())}}}return JSAV.utils.iterable(neighbors)};nodeproto.edgeTo=function(node){return this.container.getEdge(this,node)};nodeproto.edgeFrom=function(node){return node.edgeTo(this)};nodeproto.equals=function(otherNode,options){if(!otherNode||this.value()!==otherNode.value()){return false}if(options&&"css"in options){var cssEquals=JSAV.utils._helpers.cssEquals(this,otherNode,options.css);if(!cssEquals){return false}}if(options&&"class"in options){var classEquals=JSAV.utils._helpers.classEquals(this,otherNode,options["class"]);if(!classEquals){return false}}var myNeighbors=this.neighbors().sort(Graph._nodeSortFunction),otherNeighbors=otherNode.neighbors().sort(Graph._nodeSortFunction),myNeighbor,otherNeighbor;if(myNeighbors.length!==otherNeighbors.length){return false}var i;for(i=myNeighbors.length;i--;){myNeighbor=myNeighbors[i];otherNeighbor=otherNeighbors[i];if(myNeighbor.value()!==otherNeighbor.value()){return false}if(!this.container.getEdge(this,myNeighbor).equals(otherNode.container.getEdge(otherNode,otherNeighbor),$.extend({},options,{dontCheckNodes:true}))){return false}}return true};var dstypes=JSAV._types.ds;dstypes.Graph=Graph;dstypes.GraphNode=GraphNode;JSAV.ext.ds.graph=function(options){return new Graph(this,$.extend(true,{visible:true,autoresize:true},options))}})(jQuery);(function($){"use strict";if(typeof JSAV==="undefined"){return}var getIndices=JSAV.utils._helpers.getIndices;var defaultOptions={style:"table",autoresize:true,center:true,visible:true};var Matrix=function(jsav,initialData,options){this.jsav=jsav;var i;if($.isArray(initialData)){this.options=$.extend({},defaultOptions,options);options=this.options}else if(typeof initialData==="object"){this.options=$.extend({},defaultOptions,initialData);options=this.options;var temparr=[];initialData=[];temparr.length=options.columns;for(i=options.rows;i--;){initialData.push(temparr)}}else{console.error("Invalid arguments for initializing a matrix!")}this.element=options.element?$(options.element):$("<div class='jsavmatrix' />").appendTo(jsav.canvas);if("id"in options){this.id(options.id,{record:false})}this.element.addClass("jsavmatrix"+options.style);var arrayOpts=$.extend({},options,{center:false,visible:false}),arrayElem;delete arrayOpts.id;delete arrayOpts.left;delete arrayOpts.top;delete arrayOpts.relativeTo;this._arrays=[];for(i=0;i<initialData.length;i++){arrayElem=$("<ol />");arrayOpts.element=arrayElem;this.element.append(arrayElem);this._arrays[i]=jsav.ds.array(initialData[i],arrayOpts);arrayElem.css("display","block")}this.options=$.extend(true,{},options);JSAV.utils._helpers.handlePosition(this);this.layout();JSAV.utils._helpers.handleVisibility(this,this.options)};JSAV.utils.extend(Matrix,JSAV._types.ds.JSAVDataStructure);var matrixproto=Matrix.prototype;matrixproto.swap=function(row1,col1,row2,col2,options){this.jsav.effects.swapValues(this._arrays[row1],col1,this._arrays[row2],col2,options);return this};matrixproto.state=function(newState){var _arrays=this._arrays,i,l;if(newState){for(i=0,l=_arrays.length;i<l;i++){_arrays[i].state(newState[i])}return this}else{var state=[];for(i=0,l=_arrays.length;i<l;i++){state.push(_arrays[i].state())}return state}};matrixproto.layout=function(options){var dimensions,i,l=this._arrays.length,maxWidth=-1;if(this.options.center){this.element.addClass("jsavcenter")}for(i=0;i<l;i++){dimensions=this._arrays[i].layout(options);maxWidth=Math.max(maxWidth,dimensions.width)}this.element.width(maxWidth+"px")};matrixproto.equals=function(other,options){var i,l,_arrays,_other;if($.isArray(other)){for(i=other.length;i--;){if(!this._arrays[i].equals(other[i],options)){return false}}}else if(other.constructor===Matrix){_arrays=this._arrays;_other=other._arrays;if(_other.length!==_arrays.length){return false}for(i=_other.length;i--;){if(!_arrays[i].equals(_other[i],options)){return false}}}else{console.error("Unknown type of object for comparing with matrix:",other);return false}return true};var arrayFunctions=["highlight","unhighlight","isHighlight","css","value","addClass","hasClass","removeClass","toggleClass"];var arrayFunctionWrapper=function(funcname){return function(){var arrIndex=arguments[0];if(typeof arrIndex!=="number"){return}var array=this._arrays[arrIndex];return array[funcname].apply(array,[].slice.call(arguments,1))}};for(var i=arrayFunctions.length;i--;){matrixproto[arrayFunctions[i]]=arrayFunctionWrapper(arrayFunctions[i])}var events=["click","dblclick","mousedown","mousemove","mouseup","mouseenter","mouseleave"];var eventhandler=function(eventType){return function(data,handler){var self=this;this.element.on(eventType,".jsavindex",function(e){var targetArray=$(this).parent();var row=self.element.find(".jsavarray").index(targetArray);var col=targetArray.find(".jsavindex").index(this);self.jsav.logEvent({type:"jsav-matrix-"+eventType,matrixid:self.id(),row:row,column:col});if($.isFunction(data)){data.call(self,row,col,e)}else if($.isFunction(handler)){var params=$.isArray(data)?data.slice(0):[data];params.unshift(col);params.unshift(row);params.push(e);handler.apply(self,params)}});return this}};for(i=events.length;i--;){matrixproto[events[i]]=eventhandler(events[i])}matrixproto.on=function(eventName,data,handler){eventhandler(eventName).call(this,data,handler);return this};JSAV._types.ds.Matrix=Matrix;JSAV.ext.ds.matrix=function(initialData,options){return new Matrix(this,initialData,options)}})(jQuery);(function($){"use strict";if(typeof JSAV==="undefined"){return}var getIndices=JSAV.utils._helpers.getIndices;var Variable=function(jsav,value,options){this.jsav=jsav;this.options=$.extend({visible:false,type:typeof value},options);this.element=$('<div class="jsavvariable">'+'<span class="jsavvarlabel"></span> <span class="jsavvalue">'+'<span class="jsavvaluelabel jsavvarvalue">'+value+"</span></span></div>");this.element.find(".jsavvarvalue").attr("data-value",value);this.element.data("var",this);if(this.options.before){this.element.insertBefore(this.options.before.element)}else if(this.options.after){this.element.insertAfter(this.options.after.element)}else{$(this.jsav.canvas).append(this.element)}if(this.options.label){this.element.find(".jsavvarlabel").html(this.options.label)}if(this.options.name){this.element.attr("data-varname",this.options.name)}JSAV.utils._helpers.handlePosition(this);JSAV.utils._helpers.handleVisibility(this,this.options)};JSAV.utils.extend(Variable,JSAV._types.JSAVObject);var varproto=Variable.prototype;varproto._toggleVisible=JSAV.anim(JSAV.ext.effects._toggleVisible);varproto.show=JSAV.ext.effects.show;varproto.hide=JSAV.ext.effects.hide;JSAV.utils._events._addEventSupport(varproto,{selector:".jsavvalue",logEventPrefix:"jsav-var-",dataField:"var"});varproto._setValue=JSAV.anim(function(newValue,options){var oldValue=this.value();this.element.find(".jsavvarvalue").html(newValue);this.element.find(".jsavvarvalue").attr("data-value",newValue);return[oldValue,options]});varproto.value=function(newValue,options){if(typeof newValue==="undefined"){var val=this.element.find(".jsavvarvalue").attr("data-value");return JSAV.utils.value2type(val,this.options.type)}else{this._setValue(newValue,options);return this}};varproto.state=function(newstate){if(newstate){this.options.type=newstate.t;this.value(newstate.v,{record:false});JSAV.utils._helpers.setElementClasses(this.element,newstate.cls||[]);this.element.attr("style",newstate.style||"")}else{var state={t:this.options.type,v:this.value()},cls=JSAV.utils._helpers.elementClasses(this.element),style=this.element.attr("style");if(style){state.style=style}if(cls.length>0){state.cls=cls}return state}};varproto.equals=function(otherVariable,options){if(!otherVariable||typeof otherVariable!=="object"||this.value()!==otherVariable.value()){return false}if(options&&"css"in options){var cssEquals=JSAV.utils._helpers.cssEquals(this,otherVariable,options.css);if(!cssEquals){return false}}if(options&&"class"in options){var classEquals=JSAV.utils._helpers.classEquals(this,otherVariable,options["class"]);if(!classEquals){return false}}return true};varproto.css=JSAV.utils._helpers.css;varproto._setcss=JSAV.anim(JSAV.utils._helpers._setcss);varproto.addClass=JSAV.utils._helpers.addClass;varproto.removeClass=JSAV.utils._helpers.removeClass;varproto.hasClass=JSAV.utils._helpers.hasClass;varproto.toggleClass=JSAV.anim(JSAV.utils._helpers._toggleClass);varproto.highlight=function(options){this.addClass("jsavhighlight",options)};varproto.unhighlight=function(options){this.removeClass("jsavhighlight",options)};varproto.isHighlight=function(){return this.hasClass("jsavhighlight")};JSAV._types.Variable=Variable;JSAV.ext.variable=function(value,options){return new Variable(this,value,options)};var Pointer=function(jsav,name,options){this.jsav=jsav;var defaultOptions={visible:true,follow:true,anchor:"left top",myAnchor:"left bottom",left:0,top:"-20px"};this.options=$.extend(defaultOptions,options);this.element=$('<div class="jsavpointer"><div class="jsavlabel">'+name+"</div>"+'<div class="jsavpointerarea"></div></div>');if(this.options.before){this.element.insertBefore(this.options.before.element)}else if(this.options.after){this.element.insertAfter(this.options.after.element)}else if(this.options.container){this.options.container.append(this.element)}else{$(this.jsav.canvas).append(this.element)}if(typeof this.options.targetIndex!=="undefined"){this.options.relativeTo=this.options.relativeTo.index(this.options.targetIndex);delete this.options.targetIndex;delete this.options.relativeIndex}else if(typeof this.options.relativeIndex!=="undefined"){this.options.relativeTo=this.options.relativeTo.index(this.options.relativeIndex);delete this.options.relativeIndex}if(!this.options.fixed){this.options.follow=true;var pointer=this;var arrowPointerListener=function(dleft,dtop){pointer._pointerLeftSum+=dleft;pointer._pointerTopSum+=dtop};this._arrowPointerCallback=arrowPointerListener}JSAV.utils._helpers.setRelativePositioning(this,$.extend({},this.options,{callback:this._arrowPointerCallback}));JSAV.utils._helpers.handleVisibility(this,this.options);this._target=this.options.relativeTo;if(this._target){this._createArrow()}};JSAV.utils.extend(Pointer,JSAV._types.Label);var pointerproto=Pointer.prototype;pointerproto._setArrowTargetFollower=function(){this._targetLeftSum=0;this._targetTopSum=0;var pointer=this;if(!this._arrowUpdateRelativeListener){var arrowUpdateRelativeListener=function(){if(!pointer.isVisible()){return}pointer._translateArrowPoints(pointer._pointerLeftSum,pointer._pointerTopSum,pointer._targetLeftSum,pointer._targetTopSum);pointer._targetLeftSum=0;pointer._targetTopSum=0;pointer._pointerLeftSum=0;pointer._pointerTopSum=0};this._arrowUpdateRelativeListener=arrowUpdateRelativeListener;pointer.jsav.container.on("jsav-updaterelative",arrowUpdateRelativeListener)}var arrowTargetListener=function(dleft,dtop){pointer._targetLeftSum+=dleft;pointer._targetTopSum+=dtop};JSAV.utils._helpers._setRelativeFollowUpdater(this.arrow,this._target,{callback:arrowTargetListener,autotranslate:false})};pointerproto._translateArrowPoints=function(startDiffX,startDiffY,endDiffX,endDiffY){var curPoints=this.arrow.points();curPoints[0][0]+=startDiffX;curPoints[0][1]+=startDiffY;curPoints[1][0]+=endDiffX;curPoints[1][1]+=endDiffY;this.arrow.movePoints([[0,curPoints[0][0],curPoints[0][1]],[1,curPoints[1][0],curPoints[1][1]]])};pointerproto._createArrow=function(options){var arrowPoints=this._arrowPoints();var arrow=this.jsav.g.line(arrowPoints[0][1],arrowPoints[0][2],arrowPoints[1][1],arrowPoints[1][2],{"arrow-end":"classic-wide","arrow-start":"oval-medium-medium","stroke-width":2,opacity:0});if(this.isVisible()){arrow.show()}this._pointerLeftSum=0;this._pointerTopSum=0;this.arrow=arrow;this._setArrowTargetFollower()};pointerproto._setTarget=JSAV.anim(function(newTarget,options){var oldTarget=this.target();this._target=newTarget;return[oldTarget]});pointerproto._arrowPoints=function(newLeft,newTop,options){if(typeof newLeft==="object"){options=newLeft;newLeft=null;newTop=null}var opts=$.extend({},this.options,options),myBounds=this.bounds();var targetPoint=this._calculateArrowTargetPosition(this._target,opts),newPoints=[[0,(newLeft||myBounds.left)+myBounds.width/2+1,(newTop||myBounds.top)+myBounds.height-5],[1,targetPoint[0],targetPoint[1]]];return newPoints};pointerproto._calculateArrowTargetPosition=function(target,opts){var myBounds=this.bounds();if(this._target===null){return[myBounds.left+myBounds.width/2+5,myBounds.top+myBounds.height+5]}var horzPercentMapping={left:0,center:50,right:100},vertPercentMapping={top:0,center:50,bottom:100};var arrowHorzAnchor=50,arrowVertAnchor=0,arrowAnchor=opts.arrowAnchor||this.options.arrowAnchor;if(arrowAnchor){var anchor=arrowAnchor.split(" ");if(anchor.length===1){arrowHorzAnchor=arrowVertAnchor=parseInt(anchor[0],10)}else{arrowHorzAnchor=horzPercentMapping[anchor[0]];if(typeof arrowHorzAnchor!=="number"){arrowHorzAnchor=parseInt(anchor[0],10)}arrowVertAnchor=vertPercentMapping[anchor[1]];if(typeof arrowVertAnchor!=="number"){arrowVertAnchor=parseInt(anchor[1],10)}}}var targetElem=target.element,targetOffset=targetElem.offset(),canvasOffset=this.jsav.canvas.offset(),targetBounds={width:targetElem.outerWidth(),height:targetElem.outerHeight(),left:targetOffset.left-canvasOffset.left,top:targetOffset.top-canvasOffset.top};return[targetBounds.left+targetBounds.width*arrowHorzAnchor/100,targetBounds.top+targetBounds.height*arrowVertAnchor/100]};pointerproto.target=function(newTarget,options){if(typeof newTarget==="undefined"){return this._target}else{var opts=$.extend({},options);if(typeof opts.targetIndex!=="undefined"){newTarget=newTarget.index(opts.targetIndex);delete opts.targetIndex;delete opts.relativeIndex}else if(typeof opts.relativeIndex!=="undefined"){newTarget=newTarget.index(opts.relativeIndex);delete opts.relativeIndex}this._setTarget(newTarget,opts);if(newTarget===null){if(this.arrow){this.arrow.hide()}this.addClass("jsavnullpointer");return this}else{this.removeClass("jsavnullpointer")}if(!this.arrow){this._createArrow(opts)}else if(!this.arrow.isVisible()){this.arrow.show()}this._pointerLeftSum=0;this._pointerTopSum=0;if(!this.options.fixed){var newPos=JSAV.utils._helpers.setRelativePositioning(this,$.extend({},this.options,opts,{relativeTo:newTarget,callback:this._arrowPointerCallback}))}this._setArrowTargetFollower();var newTargetArrowPoint=this._calculateArrowTargetPosition(newTarget,opts);var currTargetPoint=this.arrow.points()[1];this._targetLeftSum+=newTargetArrowPoint[0]-currTargetPoint[0];this._targetTopSum+=newTargetArrowPoint[1]-currTargetPoint[1];return this}};pointerproto._orighide=pointerproto.hide;pointerproto.hide=function(options){this._orighide(options);if(this.arrow){this.arrow.hide()}};pointerproto._origshow=pointerproto.show;pointerproto.show=function(options){this._origshow(options);if(this.arrow){this.arrow.show()}};pointerproto.equals=function(otherPointer,options){if(!otherPointer||!otherPointer instanceof Pointer){return false}if(options&&"css"in options){var cssEquals=JSAV.utils._helpers.cssEquals(this,otherPointer,options.css);if(!cssEquals){return false}}if(options&&"class"in options){var classEquals=JSAV.utils._helpers.classEquals(this,otherPointer,options["class"]);if(!classEquals){return false}}return this.target().equals(otherPointer.target(),options)};JSAV.ext.pointer=function(name,target,options){return new Pointer(this,name,$.extend({},options,{relativeTo:target}))};JSAV._types.Pointer=Pointer;var trimRightRegexp=/\s+$/,trimLeftRegexp=/^\s*\n/;var Code=function(jsav,codelines,options){this.jsav=jsav;if(typeof codelines==="undefined"){codelines=[]}else if(typeof codelines==="string"){codelines=codelines.split("\n")}else if(typeof codelines==="object"&&!$.isArray(codelines)){options=codelines;$.ajax({url:options.url,async:false,mimeType:"text/plain",success:function(data){var code=data,tmp;if(options.startAfter){tmp=code.split(options.startAfter);code=tmp[tmp.length-1]}if(options.endBefore){code=code.split(options.endBefore)[0]}code=code.replace(trimRightRegexp,"").replace(trimLeftRegexp,"");codelines=code.split("\n")}})}this.options=$.extend({visible:true,lineNumbers:true,htmlEscape:true,center:true},options);var elem=this.options.lineNumbers?"ol":"ul";this.element=this.options.element||$("<"+elem+' class="jsavcode"></'+elem+">");if(this.options.before){this.element.insertBefore(this.options.before.element)}else if(this.options.after){this.element.insertAfter(this.options.after.element)}else{$(this.jsav.canvas).append(this.element)}var clElems=$();for(var i=0,l=codelines.length;i<l;i++){clElems=clElems.add(createCodeLine(codelines[i],this))}this.element.append(clElems);JSAV.utils._helpers.handlePosition(this);JSAV.utils._helpers.handleVisibility(this,this.options);if(this.options.center&&!this.options.left&&!this.options.right&&!this.options.top&&!this.options.bottom){var prevDisplay=this.element.css("display");this.element.css("display","inline-block");this.element.css("width",this.element.outerWidth());this.element.css("display",prevDisplay);this.element.addClass("jsavcenter")}};var createCodeLine=function(code,container){var clElem=$('<li class="jsavcodeline">');if(container.options.htmlEscape){clElem.text(code)}else{clElem.html(code)}return clElem};JSAV.utils.extend(Code,JSAV._types.JSAVObject);var codeproto=Code.prototype;codeproto._toggleVisible=JSAV.anim(JSAV.ext.effects._toggleVisible);codeproto.addCodeLine=JSAV.anim(function(newLine){this.element.append(createCodeLine(newLine,this))});function getCodeLineElements(self,linenum){if(typeof linenum==="string"){if(self.options.tags&&typeof self.options.tags[linenum]!=="undefined"){linenum=self.options.tags[linenum]}else{linenum=undefined}}var indices;if(linenum){if(typeof linenum==="number"){indices=linenum-1}else if($.isArray(linenum)){indices=[];for(var i=0;i<linenum.length;i++){indices[i]=linenum[i]-1}}else if($.isFunction(linenum)){indices=function(ind){return linenum(ind+1)}}}return getIndices($(self.element).find("li.jsavcodeline"),indices)}codeproto.highlight=function(linenum,options){return this.addClass(linenum,"jsavhighlight")};codeproto.unhighlight=function(linenum,options){return this.removeClass(linenum,"jsavhighlight")};codeproto.isHighlight=function(linenum){return this.hasClass(linenum,"jsavhighlight")};codeproto.toggleClass=JSAV.anim(function(linenum,className,options){var $elems=getCodeLineElements(this,linenum);if(this.jsav._shouldAnimate()){this.jsav.effects._toggleClass($elems,className,options)}else{$elems.toggleClass(className)}return[linenum,className]});codeproto.addClass=function(linenum,className,options){var $elems=getCodeLineElements(this,linenum);if(!$elems.hasClass(className)){return this.toggleClass(linenum,className,options)}else{return this}};codeproto.removeClass=function(linenum,className,options){var $elems=getCodeLineElements(this,linenum);if($elems.hasClass(className)){return this.toggleClass(linenum,className,options)}else{return this}};codeproto.hasClass=function(linenum,className){var $elems=getCodeLineElements(this,linenum);return $elems.hasClass(className)};codeproto._setcss=JSAV.anim(function(indices,cssprops,options){var $elems=getCodeLineElements(this,indices);if(this.jsav._shouldAnimate()){this.jsav.effects.transition($elems,cssprops,options)}else{$elems.css(cssprops)}return this});codeproto.setCurrentLine=function(linenum,options){var $curr=this.element.find("li.jsavcurrentline"),currlinenum=this.element.find("li.jsavcodeline").index($curr)+1,$prev=this.element.find("li.jsavpreviousline"),prevlinenum=this.element.find("li.jsavcodeline").index($prev)+1;if(typeof linenum==="string"){if(this.options.tags&&typeof this.options.tags[linenum]!=="undefined"){linenum=this.options.tags[linenum]}else{linenum=0}}if(linenum===0){if(currlinenum!==0){this.toggleClass(currlinenum,"jsavcurrentline")}if(prevlinenum!==0){this.toggleClass(prevlinenum,"jsavpreviousline")}}else if(prevlinenum===0&&currlinenum===0){this.toggleClass(linenum,"jsavcurrentline")}else if(prevlinenum===0&&currlinenum!==0&&linenum!==currlinenum){this.toggleClass(currlinenum,"jsavpreviousline jsavcurrentline",options);this.toggleClass(linenum,"jsavcurrentline")}else if(prevlinenum!==0&&currlinenum!==0&&linenum!==currlinenum&&linenum!==prevlinenum&&prevlinenum!==currlinenum){this.toggleClass(prevlinenum,"jsavpreviousline",options);this.toggleClass(currlinenum,"jsavpreviousline jsavcurrentline",options);this.toggleClass(linenum,"jsavcurrentline",options)}else if(prevlinenum===linenum&&currlinenum===linenum){}else if(prevlinenum!==0&&currlinenum!==0&&linenum===prevlinenum){this.toggleClass(prevlinenum,"jsavpreviousline jsavcurrentline",options);this.toggleClass(currlinenum,"jsavpreviousline jsavcurrentline",options)}else if(prevlinenum!==0&&currlinenum!==0&&linenum===currlinenum){this.toggleClass(prevlinenum,"jsavpreviousline",options);this.toggleClass(currlinenum,"jsavpreviousline",options)}else if(prevlinenum!==0&&currlinenum!==0&&currlinenum===prevlinenum){this.toggleClass(prevlinenum,"jsavcurrentline",options);this.toggleClass(linenum,"jsavcurrentline",options)}return this};codeproto.css=function(linenum,cssprop,options){var $elems=getCodeLineElements(this,linenum);if(typeof cssprop==="string"){return $elems.css(cssprop)}else if(typeof linenum==="string"&&typeof cssprop==="undefined"){return this.element.css(linenum)}else{if($.isFunction(linenum)){var all_elems=$(this.element).find("li.jsavcodeline"),sel_indices=[];for(var i=0;i<$elems.size();i++){sel_indices.push(all_elems.index($elems[i])+1)}linenum=sel_indices}return this._setcss(linenum,cssprop,options)}};codeproto.show=function(linenum,options){if((typeof linenum==="undefined"||typeof linenum==="object")&&!$.isArray(linenum)&&this.element.filter(":visible").size()===0){return this._toggleVisible(linenum)}else{return this.removeClass(linenum,"jsavhiddencode",options)}};codeproto.hide=function(linenum,options){if((typeof linenum==="undefined"||typeof linenum==="object")&&!$.isArray(linenum)&&this.element.filter(":visible").size()===1){return this._toggleVisible(linenum)}else{return this.addClass(linenum,"jsavhiddencode",options)}};codeproto.state=function(newState){if(typeof newState==="undefined"){return{html:this.element.html()}}else{this.element.html(newState.html)}};JSAV._types.Code=Code;JSAV.ext.code=function(codelines,options){return new Code(this,codelines,options)}})(jQuery);(function($){"use strict";if(typeof JSAV==="undefined"){
return}var speedChoices=[5e3,3e3,1500,1e3,500,400,300,200,100,50];var getSpeedChoice=function(speedVal){var curval=speedChoices.length-1;while(curval&&speedChoices[curval]<speedVal){curval--}return curval+1};var speedSetting=function(settings){return function(){var translate;if(settings.jsav){translate=settings.jsav._translate}else{var lang="en";if(window.JSAV_OPTIONS&&window.JSAV_OPTIONS.lang&&typeof JSAV._translations[window.JSAV_OPTIONS.lang]==="object"){lang=window.JSAV_OPTIONS.lang}translate=JSAV.utils.getInterpreter(JSAV._translations,lang)}var curSpeed=JSAV.ext.SPEED;var rangeSupported=!!$.support.inputTypeRange;var curval=getSpeedChoice(curSpeed);var $elem=$('<div class="jsavrow">'+translate("animationSpeed")+(rangeSupported?" "+translate("(slowFast)"):"")+': <input type="range" min="1" max="10" step="1" size="30" value="'+curval+'"/> '+(rangeSupported?"":"<button>"+translate("save")+'</button><div class="jsavhelp">'+translate("valueBetween1And10"))+"</div>");var speedChangeHandler=function(){var speed=parseInt($(this).val(),10);if(isNaN(speed)||speed<1||speed>10){return}speed=speedChoices[speed-1];curSpeed=speed;JSAV.ext.SPEED=speed;$(document).trigger("jsav-speed-change",speed);if(typeof localStorage!=="undefined"&&localStorage){localStorage.setItem("jsav-speed",speed)}};var $inputElem=$elem.find("input").val(curval);if(rangeSupported){$inputElem.change(speedChangeHandler)}else{$elem.find("button").click(function(){speedChangeHandler.call($inputElem);var savedElem=$("<span>"+translate("saved")+"</span>");setTimeout(function(){savedElem.fadeOut()},1e3);$(this).after(savedElem)})}return $elem}};var createInputComponent=function(varname,options){var label,opts=$.extend({type:"text"},options),input=$('<input id="jsavsettings-'+varname+'" type="'+opts.type+'"/>');if("label"in opts){label=$('<label for="jsavsettings-'+varname+'">'+opts.label+"</label>")}if("value"in opts){input.val(opts.value)}for(var attr in opts){if(["label","value","type"].indexOf(attr)===-1){input.attr(attr,opts[attr])}}return $('<div class="jsavrow"/>').append(label).append(input)};var createSelectComponent=function(varname,options){var label,select=$('<select id="jsavsettings-'+varname+'" />');if("label"in options){label=$('<label for="jsavsettings-'+varname+'">'+options.label+"</label>")}var opts=options.options;for(var key in opts){if(opts.hasOwnProperty(key)){select.append('<option value="'+key+'">'+opts[key]+"</option>")}}if("value"in options){select.val(options.value)}var toCheck=["label","value","options","type"];for(var attr in options){if($.inArray(attr,toCheck)===-1){select.attr(attr,options[attr])}}return $('<div class="jsavrow"/>').append(label).append(select)};var Settings=function(elem){this.components=[];this.add(speedSetting(this));var that=this;if(elem){$(elem).click(function(e){e.preventDefault();that.show(e)})}},sproto=Settings.prototype;sproto.show=function(evt){var $cont=$("<div class='jsavsettings'></div>");for(var i=0;i<this.components.length;i++){$cont.append(this.components[i])}$cont.append("<span class='jsavversion'>"+JSAV.version()+"</span>");var translate;if(this.jsav){translate=this.jsav._translate}else{var lang="en";if(window.JSAV_OPTIONS&&window.JSAV_OPTIONS.lang&&typeof JSAV._translations[window.JSAV_OPTIONS.lang]==="object"){lang=window.JSAV_OPTIONS.lang}translate=JSAV.utils.getInterpreter(JSAV._translations,lang)}var title=translate("settings");var dialogPosition=function($dialog){var $button=$(evt.target),buttonPos=$button.offset(),$win=$(window),winWidth=$win.width(),winHeight=$win.height(),scrollTop=$win.scrollTop(),scrollLeft=$win.scrollLeft();var leftOfCenter=buttonPos.left-scrollLeft<winWidth/2,aboveMiddle=buttonPos.top-scrollTop<winHeight/2;$dialog.addClass("arrow-"+(aboveMiddle?"top":"bottom")+"-"+(leftOfCenter?"left":"right"));$dialog.css({top:aboveMiddle?buttonPos.top+$button.outerHeight()+8:buttonPos.top-$dialog.height()-8,left:leftOfCenter?buttonPos.left+$button.outerWidth()/2-8:buttonPos.left-$dialog.width()+$button.outerWidth()/2+8})};this.dialog=JSAV.utils.dialog($cont,{title:title,dialogClass:"jsavsettings-dialog",positionCallback:dialogPosition,width:"500px"})};sproto.close=function(){if(this.dialog){this.dialog.close()}};sproto.add=function(create,options){if($.isFunction(create)){this.components.push(create)}else{if(!("type"in options)){return}var elem,func;if(options.type==="select"){func=createSelectComponent}else{func=createInputComponent}elem=func(create,options);this.components.push(elem);return elem.find("input, select")}};JSAV.utils.Settings=Settings;JSAV.init(function(){if(this.options.settings){this.settings=this.options.settings}else{this.settings=new Settings($(this.container).find(".jsavsettings").show())}this.settings.jsav=this})})(jQuery);(function($){"use strict";var BLOCKED_ATTRIBUTES=["correct","comment","points"];var createUUID=JSAV.utils.createUUID;var questionSetting=function(jsav){return function(){var idPrefix="jsav"+jsav.id()+"ShowQuestions";var $elem=$('<div class="jsavrow">Show Questions: '+'<input id="'+idPrefix+'Yes" type="radio" value="true" name="jsav-questions" />'+'<label for="'+idPrefix+'Yes">Yes</label>'+'<input  id="'+idPrefix+'No" type="radio" value="false" name="jsav-questions" />'+'<label for="'+idPrefix+'No">No</label>'+"</div>");if(jsav.options.showQuestions){$elem.find("#"+idPrefix+"Yes").prop("checked",true)}else{$elem.find("#"+idPrefix+"No").prop("checked",true)}$elem.find("input").on("change",function(){jsav.options.showQuestions=$(this).val()==="true"});return $elem}};var createInputComponent=function(label,itemtype,options){var labelElem=$('<label for="'+options.id+'">'+label+"</label>"),input=$('<input id="'+options.id+'" type="'+itemtype+'"/>');$.each(options,function(key,value){if(BLOCKED_ATTRIBUTES.indexOf(key)===-1){input.attr(key,value)}});return $('<div class="jsavrow"/>').append(input).append(labelElem)};var feedbackFunction=function($elems){var cbs=$elems.find('[type="checkbox"]'),that=this,correct=true;if(cbs.size()===0){cbs=$elems.find('[type="radio"]')}var answers=[],answer;cbs.each(function(index,item){var qi=that.choiceById(item.id);var $item=$(item);answer={label:qi.label,selected:!!$item.prop("checked"),type:$item.attr("type"),correct:true};if(!!$item.prop("checked")!==!!qi.options.correct){correct=false;answer.correct=false}answers.push(answer)});$elems.filter(".jsavfeedback").html(correct?this.jsav._translate("questionCorrect"):this.jsav._translate("questionIncorrect")).removeClass("jsavcorrect jsavincorrect").addClass(correct?"jsavcorrect":"jsavincorrect");$elems.filter('[type="submit"]').remove();return{correct:correct,answers:answers}};var qTypes={};qTypes.TF={init:function(){this.name=createUUID();this.choices[0]=new QuestionItem(this.options.falseLabel||"False","radio",{name:this.name,correct:!this.options.correct});this.choices[1]=new QuestionItem(this.options.trueLabel||"True","radio",{name:this.name,correct:!!this.options.correct});this.correctChoice=function(correctVal){if(correctVal){this.choices[1].correct=true}else{this.choices[0].correct=true}}},feedback:feedbackFunction};qTypes.MC={init:function(){this.name=createUUID()},addChoice:function(label,options){this.choices.push(new QuestionItem(label,"radio",$.extend({name:this.name},options)));return this},feedback:feedbackFunction};qTypes.MS={addChoice:function(label,options){this.choices.push(new QuestionItem(label,"checkbox",$.extend({},options)));return this},feedback:feedbackFunction};var QuestionItem=function(label,itemtype,options){this.label=label;this.itemtype=itemtype;this.options=$.extend({},options);if(!("id"in this.options)){this.options.id=createUUID()}this.correct=this.options.correct||false};QuestionItem.prototype.elem=function(){return createInputComponent(this.label,this.itemtype,this.options)};var Question=function(jsav,qtype,questionText,options){this.jsav=jsav;this.asked=false;this.choices=[];this.questionText=questionText;this.maxPoints=1;this.achievedPoints=-1;this.qtype=qtype.toUpperCase();this.options=options;var funcs=qTypes[this.qtype];var that=this;$.each(funcs,function(fName,f){that[fName]=f});this.init()};var qproto=Question.prototype;qproto.id=function(newId){if(typeof newId!=="undefined"){this.id=newId}else{return this.id}};qproto.show=JSAV.anim(function(){if(this.asked||!this.jsav._shouldAnimate()||!this.jsav.options.showQuestions){return}this.jsav.disableControls();this.asked=true;var $elems=$(),that=this,i;$elems=$elems.add($('<div class="jsavfeedback" > </div>'));var order=[];for(i=this.choices.length;i--;){order.push(i)}for(i=5*order.length;i--;){var rand1=JSAV.utils.rand.numKey(0,order.length+1),rand2=JSAV.utils.rand.numKey(0,order.length+1),tmp=order[rand1];order[rand1]=order[rand2];order[rand1]=tmp}for(i=0;i<this.choices.length;i++){$elems=$elems.add(this.choices[order[i]].elem())}var close=$('<input type="button" value="'+this.jsav._translate("questionClose")+'" />').click(function(){that.dialog.close()});close.css("display","none");$elems=$elems.add(close);var submit=$('<input type="submit" value="'+this.jsav._translate("questionCheck")+'" />').click(function(){var logData=that.feedback($elems);logData.question=that.questionText;logData.type="jsav-question-answer";if(that.options.id){logData.questionId=that.options.id}that.jsav.logEvent(logData);if(!that.jsav.options.questionResubmissionAllowed){submit.remove();close.show()}});$elems=$elems.add(submit);var closeCallback=function(){var logData={type:"jsav-question-close",question:that.questionText};that.jsav.enableControls();if(that.options.id){logData.questionId=that.options.id}that.jsav.logEvent(logData)};var dialogClass=this.jsav.options.questionDialogClass||"";this.dialog=JSAV.utils.dialog($elems,{title:this.questionText,dialogRootElement:this.jsav.options.questionDialogBase,closeCallback:closeCallback,closeOnClick:false,dialogClass:dialogClass});this.dialog.filter(".jsavdialog").addClass("jsavquestiondialog");var logChoices=[];for(i=0;i<this.choices.length;i++){var c=this.choices[i];logChoices.push({label:c.label,correct:c.correct})}var logData={type:"jsav-question-show",question:this.questionText,questionType:this.qtype,choices:logChoices};if(this.options.id){logData.questionId=this.options.id}this.jsav.logEvent(logData);return $elems});qproto.choiceById=function(qiId){for(var i=this.choices.length;i--;){if(this.choices[i].options.id===qiId){return this.choices[i]}}return null};qproto.state=function(){};var noop=function(){};$.each(["init","feedback","addChoice"],function(index,val){qproto[val]=noop});var QuestionFrame=function(jsav,url,options){this.jsav=jsav;this.url=url;this.options=options;this._showed=false};var qfproto=QuestionFrame.prototype;qfproto._createElement=function(){var $iframe=$("<iframe src='"+this.url+"'></iframe>");$iframe.prop("seamless",true);if(this.options.attr){$iframe.attr(this.options.attr)}$iframe.addClass("jsavquestionframe");return $iframe};qfproto.show=JSAV.anim(function(){if(this._showed||!this.jsav._shouldAnimate()||!this.jsav.options.showQuestions){return}this._showed=true;var $iframe=this.options.element||this._createElement();var opts=$.extend({closeOnClick:false},this.options);delete opts.attr;var that=this;opts.closeCallback=function(){var logData={type:"jsav-question-closeiframe",question:that.questionText};if(that.options.id){logData.questionId=that.options.id}that.jsav.logEvent(logData)};JSAV.utils.dialog($iframe,opts);var logData={type:"jsav-question-showiframe",url:this.url};if(opts.id){logData.questionId=opts.id}this.jsav.logEvent(logData)});qfproto.state=function(){};JSAV.ext.question=function(qtype,questionText,options){if(!this._questionSetting&&this.settings){this._questionSetting=true;this.settings.add(questionSetting(this))}var logData={type:"jsav-question-created",question:questionText};this.logEvent(logData);if(qtype==="IFRAME"){return new QuestionFrame(this,questionText,options)}else{return new Question(this,qtype,questionText,$.extend({},options))}};JSAV.ext.resetQuestionAnswers=function(){this.begin();for(var i=0;i<this._redo.length;i++){var stepOperations=this._redo[i].operations;for(var j=0;j<stepOperations.length;j++){var obj=stepOperations[j].obj;if(obj&&obj instanceof Question){obj.asked=false}}}};JSAV.init(function(){if(typeof this.options.showQuestions==="undefined"){this.options.showQuestions=true}this.container.bind({"jsav-question-reset":function(){this.resetQuestionAnswers()}.bind(this)})})})(jQuery);(function($){"use strict";if(typeof JSAV==="undefined"){return}var gradeStepFilterFunction=function(step){return step.options.grade};var Exercise=function(jsav,options){this.jsav=jsav;this.options=jQuery.extend({reset:function(){},controls:null,feedback:"atend",feedbackSelectable:false,fixmode:"undo",fixmodeSelectable:false,grader:"default",resetButtonTitle:this.jsav._translate("resetButtonTitle"),undoButtonTitle:this.jsav._translate("undoButtonTitle"),modelButtonTitle:this.jsav._translate("modelButtonTitle"),gradeButtonTitle:this.jsav._translate("gradeButtonTitle")},window.JSAV_EXERCISE_OPTIONS,options);var cont=$(this.options.controls),self=this;if(cont.size()===0){cont=this.jsav.container.find(".jsavexercisecontrols")}var resetHandler=function(){self.jsav.logEvent({type:"jsav-exercise-reset"});self.reset()};var modelHandler=function(){cont.addClass("active");self.jsav.logEvent({type:"jsav-exercise-model-open"});self.showModelanswer();cont.removeClass("active")};this.jsav.container.bind({"jsav-exercise-reset":resetHandler,"jsav-exercise-model":modelHandler});if(cont.size()){var $reset=$('<input type="button" name="reset" value="'+this.options.resetButtonTitle+'" />').click(resetHandler),$model=$('<input type="button" name="answer" value="'+this.options.modelButtonTitle+'" />').click(modelHandler),$action=$('<span class="actionIndicator"></span>');if(this.options.feedback!=="continuous"){var $grade=$('<input type="button" name="grade" value="'+this.options.gradeButtonTitle+'" />').click(function(){cont.addClass("active");self.showGrade();cont.removeClass("active");self.jsav.logEvent({type:"jsav-exercise-grade",score:$.extend({},self.score)})}),$undo=$('<input type="button" name="undo" value="'+this.options.undoButtonTitle+'" />"').click(function(){self.jsav.logEvent({type:"jsav-exercise-undo"});self.undo()});cont.append($undo,$reset,$model,$grade,$action)}else{cont.append($reset,$model,$action)}$action.position({of:cont.children().last(),at:"right center",my:"left+5 center-2"})}if(this.options.feedbackSelectable){this.feedback=this.jsav.settings.add("feedback",{type:"select",options:{continuous:this.jsav._translate("continuous"),atend:this.jsav._translate("atend")},label:this.jsav._translate("feedbackLabel"),value:this.options.feedback})}if(this.options.fixmodeSelectable){this.fixmode=this.jsav.settings.add("fixmode",{type:"select",options:{undo:this.jsav._translate("undo"),fix:this.jsav._translate("fix")},label:this.jsav._translate("fixLabel"),value:this.options.fixmode})}var $jsavscore=this.jsav.container.find(".jsavscore");if($jsavscore.size()===1&&$jsavscore.children().size()===0&&this.options.feedback==="continuous"){$jsavscore.html(this.jsav._translate("scoreLabel")+' <span class="jsavcurrentscore"></span> / '+'<span class="jsavmaxscore" ></span>, <span class="jsavamidone">'+this.jsav._translate("remainingLabel")+' <span class="jsavpointsleft"></span></span>, '+this.jsav._translate("lostLabel")+' <span class="jsavpointslost" ></span>');this._defaultscoretext=true}if(this.options.showGrade&&$.isFunction(this.options.showGrade)){this.showGrade=this.options.showGrade}var exer=this;jsav.gradeableStep=function(){exer.gradeableStep.apply(exer,arguments)}};Exercise.GradeStepFilterFunction=gradeStepFilterFunction;var allEqual=function(initial,model,compare){if($.isArray(initial)){if(!compare){compare=[]}for(var i=0;i<initial.length;i++){if(!model[i].equals(initial[i],compare[i])){return false}}return true}else{return model.equals(initial,compare)}};var graders={default:function(){var studentSteps=0,correct=true,forwStudent=true,forwModel=true,modelAv=this.modelav,studentAv=this.jsav,modelTotal=modelAv.totalSteps(),studentTotal=studentAv.totalSteps();this.score.correct=0;this.score.student=0;while(correct&&forwStudent&&forwModel&&modelAv.currentStep()<=modelTotal&&studentAv.currentStep()<=studentTotal){forwStudent=studentAv.forward(gradeStepFilterFunction);forwModel=modelAv.forward(gradeStepFilterFunction);if(forwStudent){studentSteps++}correct=false;if(forwModel){if(forwModel&&forwStudent){if(allEqual(this.initialStructures,this.modelStructures,this.options.compare)){correct=true;this.score.correct++}}}}forwStudent=true;while(forwStudent&&studentAv.currentStep()<studentTotal){forwStudent=studentAv.forward(gradeStepFilterFunction);if(forwStudent){studentSteps++}}this.score.student=studentSteps},"default-continuous":function(){var modelAv=this.modelav,studentAv=this.jsav,forwModel;if(modelAv.currentStep()<modelAv.totalSteps()&&studentAv.currentStep()<=studentAv.totalSteps()){forwModel=modelAv.forward(gradeStepFilterFunction);this.score.student++;if(forwModel){if(allEqual(this.initialStructures,this.modelStructures,this.options.compare)){this.score.correct++}}}studentAv.forward()},finalStep:function(){this.score.correct=0;this.score.student=1;this.score.total=1;this.modelav.end();this.jsav.end();if(allEqual(this.initialStructures,this.modelStructures,this.options.compare)){this.score.correct=1}},finder:function(){var studentSteps=0,cont=true,forwStudent=true,forwModel=true,modelAv=this.modelav,studentAv=this.jsav,modelTotal=modelAv.totalSteps(),studentTotal=studentAv.totalSteps();this.score.correct=0;this.score.student=0;while(forwModel&&cont&&modelAv.currentStep()<=modelTotal&&studentAv.currentStep()<=studentTotal){forwModel=modelAv.forward(gradeStepFilterFunction);if(forwModel){forwStudent=true;while(forwStudent&&!allEqual(this.initialStructures,this.modelStructures,this.options.compare)&&studentAv.currentStep()<=studentTotal){forwStudent=studentAv.forward()}if(allEqual(this.initialStructures,this.modelStructures,this.options.compare)){this.score.correct++}else{cont=false}}}}};graders["finalStep-continuous"]=graders.finalStep;var exerproto=Exercise.prototype;exerproto._updateScore=function(){if(this.options.feedback==="continuous"){if(!this.modelav){this.modelanswer();this.grade()}var container=this.jsav.container,score=this.score;if(this._defaultscoretext){container.find(".jsavamidone").html(score.total===score.correct?this.jsav._translate("doneLabel"):this.jsav._translate("remainingLabel")+" <span class='jsavpointsleft'></span>")}var undo=score.undo;if(this._undoneSteps[this.jsav.currentStep()]){undo=undo-1}container.find(".jsavcurrentscore").text(score.correct-undo);container.find(".jsavcurrentmaxscore").text(score.correct+score.fix+score.undo);container.find(".jsavmaxscore").text(score.total);container.find(".jsavpointsleft").text(score.total-score.correct-score.fix||this.jsav._translate("doneLabel"));container.find(".jsavpointslost").text(score.fix||score.undo||0)}};exerproto.grade=function(continuousMode){if(!this.modelav){this.modelanswer()}var origStep=this.jsav.currentStep(),origModelStep=this.modelav.currentStep();if(!continuousMode){this.jsav.begin();this.modelav.begin()}var prevFx=$.fx.off||false;$.fx.off=true;if($.isFunction(this.options.grader)){this.options.grader.call(this)}else{graders[this.options.grader+(continuousMode?"-continuous":"")].call(this)}if(!continuousMode){this.jsav.jumpToStep(origStep);this.modelav.jumpToStep(origModelStep)}$.fx.off=prevFx;return this.score};exerproto.showGrade=function(){this.grade();var grade=this.score,msg=this.jsav._translate("yourScore")+" "+grade.correct+" / "+grade.total;if(grade.fix>0){msg+="\n"+this.jsav._translate("fixedSteps")+" "+grade.fix}window.alert(msg)};exerproto.modelanswer=function(returnToStep){if(this.modelDialog){this.modelDialog.remove()}var model=this.options.model,modelav,self=this,modelOpts=$.extend({title:this.jsav._translate("modelWindowTitle"),closeOnClick:false,modal:false,closeCallback:function(){self.jsav.logEvent({type:"jsav-exercise-model-close"});if(typeof returnToStep==="number"){modelav.jumpToStep(returnToStep)}}},this.options.modelDialog);if(modelOpts.dialogClass){modelOpts.dialogClass+=" jsavmodelpreparing"}else{modelOpts.dialogClass="jsavmodelpreparing"}var modelLogHandler=function(eventData){eventData.av=self.jsav.id();eventData.type=eventData.type.replace("jsav-","jsav-exercise-model-");$("body").trigger("jsav-log-event",eventData)};if($.isFunction(model)){modelav=new JSAV($("<div><span class='jsavcounter'/><div class='jsavcontrols'/><p class='jsavoutput jsavline'></p></div>").addClass("jsavmodelanswer"),{logEvent:modelLogHandler});modelav.gradeableStep=function(){this.stepOption("grade",true);this.step()};this.modelDialog=JSAV.utils.dialog(modelav.container,modelOpts);this.modelStructures=model(modelav);modelav.recorded();var oldFx=$.fx.off||false;$.fx.off=true;var forwModel=true,modelTotal=modelav.totalSteps(),totalSteps=0;while(forwModel&&modelav.currentStep()<=modelTotal){forwModel=modelav.forward(gradeStepFilterFunction);if(forwModel){totalSteps++}}$.fx.off=oldFx;modelav.begin();this.modelDialog.hide();this.score.total=totalSteps;this.modelav=modelav}};exerproto.showModelanswer=function(){var prevPosition=this.modelav?this.modelav.currentStep():0;this.modelanswer(prevPosition);this.modelav.begin();this.modelDialog.removeClass("jsavmodelpreparing");this.modelDialog.show()};exerproto.reset=function(){this.jsav.clearAnimation();this.score={total:0,correct:0,undo:0,fix:0,student:0};this._undoneSteps=[];this.jsav.RECORD=true;this.initialStructures=this.options.reset();this.jsav.displayInit();this.jsav.recorded();if(this.modelav){this.modelav.container.remove();this.modelav=undefined;this.modelStructures=undefined}this.jsav._undo=[];this._updateScore();this.jsav.logEvent({type:"jsav-exercise-init",exercise:this})};exerproto.undo=function(){var oldFx=$.fx.off||false;$.fx.off=true;this.jsav.backward();this.jsav.backward();var undoGraders=["default","finder","finalStep"];if(undoGraders.indexOf(this.options.grader)!==-1&&this.jsav.backward(gradeStepFilterFunction)){this.jsav.forward();this.jsav.step({updateRelative:false})}else{this.jsav.begin()}this.jsav._redo=[];$.fx.off=oldFx};var moveModelBackward=function(exer){exer.modelav.backward();if(exer.modelav.backward(gradeStepFilterFunction)){exer.modelav.forward()}};exerproto.gradeableStep=function(){var prevFx=$.fx.off||false;$.fx.off=true;if(this._fixing){if(this.options.debug){console.error("exercise.gradeableStep() shouldn't be called in fix function")}return}this.jsav.stepOption("grade",true);this.jsav.step();var that=this;if(this.feedback&&this.feedback.val()==="continuous"||!this.feedback&&this.options.feedback==="continuous"){var doContinuousGrading=function(){var grade=that.grade(true);if(grade.student===grade.correct){that.jsav.logEvent({type:"jsav-exercise-grade-change",score:$.extend({},grade)});that._updateScore();return}if(grade.correct===grade.total){return}var fixmode=that.fixmode?that.fixmode.val():that.options.fixmode;if(fixmode!=="none"){that.undo();that.score.student--}if(fixmode==="fix"&&$.isFunction(that.options.fix)){that._fixing=true;var modelAv=that.modelav,studentAv=that.jsav;that.fix(that.modelStructures);delete that._fixing;that.score.fix++;that.jsav.stepOption("grade",true);that.jsav.step();if(that.options.debug&&!allEqual(that.initialStructures,that.modelStructures,that.options.compare)){console.error("The fix function did not work as expected, the structures aren't equal")}that.jsav.logEvent({type:"jsav-exercise-step-fixed",score:$.extend({},grade)});window.alert(that.jsav._translate("fixedPopup"))}else if(fixmode==="fix"){if(!that._undoneSteps[that.jsav.currentStep()]){that.score.undo++;that._undoneSteps[that.jsav.currentStep()]=true}that.jsav.logEvent({type:"jsav-exercise-step-undone",score:$.extend({},grade)});moveModelBackward(that);window.alert(that.jsav._translate("fixFailedPopup"))}else if(fixmode==="none"){}else{if(!that._undoneSteps[that.jsav.currentStep()]){that.score.undo++;that._undoneSteps[that.jsav.currentStep()]=true}that.jsav.logEvent({type:"jsav-exercise-step-undone",score:$.extend({},grade)});moveModelBackward(that);window.alert(that.jsav._translate("undonePopup"))}that._updateScore()};that.jsav._clearPlaying(function(){that.jsav.logEvent({type:"jsav-exercise-gradeable-step"});doContinuousGrading();$.fx.off=prevFx})}else{this.jsav._clearPlaying(function(){that.jsav.logEvent({type:"jsav-exercise-gradeable-step"})});$.fx.off=prevFx}};exerproto.fix=function(){var fix=this.options.fix;if($.isFunction(fix)){var prevFx=$.fx.off||false;$.fx.off=true;fix(this.modelStructures);$.fx.off=prevFx}};exerproto._jsondump=function(){var jsav=this.jsav,states=[],forw=true,initial=this.initialStructures,origStep=jsav.currentStep(),oldFx=$.fx.off||false;$.fx.off=true;var getstate=function(){if($.isArray(initial)){var state=[];for(var i=0,l=initial.length;i<l;i++){state.push(initial[i].state())}return state}else{return initial.state()}};jsav.begin();while(forw){states.push(getstate());forw=jsav.forward()}this.jsav.jumpToStep(origStep);$.fx.off=oldFx;return JSON.stringify(states)};JSAV._types.Exercise=Exercise;JSAV.ext.exercise=function(model,reset,options){var opts=$.extend({model:model,reset:reset},options);return new Exercise(this,opts)}})(jQuery);(function(){if(typeof JSAV==="undefined"){return}var theVERSION="v1.0.1-32-g1a8c59b";JSAV.version=function(){return theVERSION}})();
